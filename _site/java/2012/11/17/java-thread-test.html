<!DOCTYPE html>
<html>
	
	    <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
    <meta content="java线程相关测试" name="description">
  
  
    <meta name="keywords" content="java线程相关测试,线程,java,kinglyjn">
  
  <meta name="author" content="KinglyJn">

  <title>
    
        KinglyJn|java线程相关测试
    
  </title>
  <!-- favicon -->
  <link rel="shortcut icon" href="static/img/favicon.ico">


  <!-- Third-party CSS -->
  <link href="/bower_components/normalize-css/normalize.min.css" rel="stylesheet">
  <link href="/bower_components/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="/bower_components/animate.css/animate.min.css" rel="stylesheet">
  <link href="/bower_components/components-font-awesome/css/font-awesome.min.css" rel="stylesheet">
  <link href="/static/font-mfizz/font-mfizz.css" rel="stylesheet">
  <!-- <link href="/bower_components/toastr/toastr.min.css" rel="stylesheet"> -->
  <link href="/bower_components/jquery.gritter/css/jquery.gritter.css" rel="stylesheet">
  <link rel="stylesheet" href="/search/css/cb-search.css">

  <!-- Custom styles for this template -->
  <link href="/static/css/style.min.css" rel="stylesheet">
  <link href="/static/css/pygments.css" rel="stylesheet">

  <!-- Scripts -->
  <script src="/bower_components/jquery/dist/jquery.min.js"></script>
  <script src="/search/js/bootstrap3-typeahead.min.js"></script>

  <!-- cb-search -->
  <script src="/search/js/cb-search.js"></script>
  <script>
    $(function(){
        $("pre").css('display','block');
    });
  </script>
  <!-- Mainly scripts -->
  <script src="/bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
  <script src="/bower_components/metisMenu/dist/metisMenu.min.js"></script>
  <script src="/bower_components/jquery-slimscroll/jquery.slimscroll.min.js"></script>

  <!-- Peity -->
  <script src="/bower_components/peity/jquery.peity.min.js"></script>

  <script src="/bower_components/PACE/pace.min.js"></script>
  <script src="/bower_components/wow/dist/wow.min.js"></script>
  <!-- Custom and plugin javascript -->
  <script src="/static/js/inspinia.js"></script>

  <!-- Rickshaw -->
  <script src="/bower_components/rickshaw/vendor/d3.v3.js"></script>
  <script src="/bower_components/rickshaw/rickshaw.min.js"></script>


  <!-- jPages -->
  <script src="/static/js/jPages.js"></script>
  <script src="/static/js/js.js"></script>
  <script type="text/javascript">
        $(function(){
          /* initiate the plugin */
          $("div.pag-holder").jPages({
              containerID  : "pag-itemContainer",
              perPage      : 10,  /* num of items per page */
              startPage    : 1,
              startRange   : 1,
              midRange     : 3,
              endRange     : 1
          });

          $("div.pag-jump button").click(function(){
            var page = parseInt($("div.pag-jump input").val());
            $("div.pag-holder").jPages(page);
          });

          $("div.pag-jump input").on("keypress", function(){
            var e=e||window.event;
            if (e.keyCode == 13) {
                var page = parseInt($("div.pag-jump input").val());
                $("div.pag-holder").jPages(page);
            } 
          });
      });
  </script>

<!-- GrowingIO -->

  <script>
    var _vds = _vds || [];
    window._vds = _vds;
    (function(){
      _vds.push(['setAccountId', 'a49d4901c7853da9']);
      (function() {
        var vds = document.createElement('script');
        vds.type='text/javascript';
        vds.async = true;
        vds.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'dn-growing.qbox.me/vds.js';
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(vds, s);
      })();
    })();
  </script>


</head>

	


<body id="page-top" class="landing-page">

	
	    

<!--修复手机端横轴方向左右滑动BUG-->
<style type="text/css">
    .landing-page .row {
        margin-left: 0px;
        margin-right: 0px;
    }
</style>

<div class="search-tool"
      style="position: fixed; top: 0px ; bottom: 0px; left: 0px; right:  0px; opacity: 0.95; background-color: #111111; z-index: 9999; display: none;">
    <input type="text" class="form-control search-content" id="search-content" style="position: fixed; top: 60px" placeholder="Search Blog">

    <div style="position: fixed; top: 16px; right: 16px; z-index: 9999;">
        <img src="/search/img/cb-close.png" id="close-btn"/>
    </div>
</div>

<div style="position: fixed; right: 16px; bottom: 20px; z-index: 9999;">
    <img src="/search/img/cb-search.png"  id="search-btn"  title="Double click Ctrl"/>
</div>

<div class="navbar-wrapper">
        <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
            <div class="container">
                <div class="navbar-header page-scroll">
                    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="/">KinglyJn</a>
                </div>
                <div id="navbar" class="navbar-collapse collapse">
                    <ul class="nav navbar-nav navbar-right">
                        <li><a class="page-scroll" href="/blog/"></a></li>
                        
                            
                            <li>
                            
                            <a class="page-scroll" href="/blog/">Blog</a></li>
                        
                            
                            <li>
                            
                            <a class="page-scroll" href="/linux/">Linux</a></li>
                        
                            
                            <li>
                            
                            <a class="page-scroll" href="/cloud/">Cloud</a></li>
                        
                            
                            <li>
                            
                            <a class="page-scroll" href="/java/">Java</a></li>
                        
                            
                            <li>
                            
                            <a class="page-scroll" href="/c/">C</a></li>
                        
                            
                            <li>
                            
                            <a class="page-scroll" href="/php/">PHP</a></li>
                        
                            
                            <li>
                            
                            <a class="page-scroll" href="/db/">DB</a></li>
                        
                            
                            <li>
                            
                            <a class="page-scroll" href="/htmlx/">HTMLX</a></li>
                        
                            
                            <li>
                            
                            <a class="page-scroll" href="/life/">Life</a></li>
                        
                            
                            <li>
                            
                            <a class="page-scroll" href="/art/">Art</a></li>
                        
                            
                            <li>
                            
                            <a class="page-scroll" href="/other/">Other</a></li>
                        
                    </ul>
                </div>
            </div>
        </nav>
</div>
<div id="inSlider" class="carousel carousel-fade" data-ride="carousel">
    <div style="position:absolute;float:left;left:25%;z-index:15;width:50%;margin-bottom:18%;bottom:0;text-align:center;list-style:none;">
        <span style="color:white;font-size:24px;">以平实之心写作</span><br>
        <span style="color:white;font-size:13px;">writing with simple heart ♬. </span>
    </div>
    <!--
    <ol class="carousel-indicators">
        <li data-target="#inSlider" data-slide-to="0" class="active"></li>
        <li data-target="#inSlider" data-slide-to="1"></li>
    </ol>
    -->
    <div class="carousel-inner" role="listbox">
        <div class="item active">
            <div class="container">
                <div class="carousel-caption">
                </div>
                <div class="carousel-image wow zoomIn">
                    <!-- <img src="static/img/landing/laptop.png" alt="laptop"/> -->
                </div>
            </div>
            <!-- Set background for slide in css -->
            <div class="header-back blog-one"></div>
        </div>
        <!--
        <div class="item">
            <div class="container">
                <div class="carousel-caption blank">
                </div>
            </div>
            Set background for slide in css
            <div class="header-back two"></div>
        </div>
        -->
    </div>
    <!--
    <a class="left carousel-control" href="#inSlider" role="button" data-slide="prev">
        <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
        <span class="sr-only">Previous</span>
    </a>
    <a class="right carousel-control" href="#inSlider" role="button" data-slide="next">
        <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
        <span class="sr-only">Next</span>
    </a>
    -->
</div>


	

    <div class="wrapper wrapper-content  animated fadeInRight article">
    <div class="row">
        <div class="col-lg-10 col-lg-offset-1">
            <div class="ibox">
                <div class="ibox-content">
                    <div class="pull-right">
                    	
                        	<button class="btn btn-white btn-xs" type="button">Java</button>
                        
                    </div>
                    <div class="text-center article-title" style="margin-bottom:50px;">
                        <h1>
                            java线程相关测试
                        </h1>
                        <a href="http://www.keyllo.com/studio/">
                            <span class="text-muted"><i class="fa fa-user"></i> KinglyJn</span>
                        </a>
                        &nbsp;&nbsp;&nbsp;&nbsp;
                        <span class="text-muted"><i class="fa fa-clock-o"></i> 2012-11-17</span>
                    </div>
                    	<h3 id="基本线程">基本线程</h3>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">threadtest</span><span class="o">;</span>

<span class="cm">/**
 * 基本线程
 * @author zhangqingli
 *
 */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">BaseThread01</span> <span class="o">{</span>
	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
			<span class="n">Calculator01</span> <span class="n">c</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Calculator01</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
			<span class="k">new</span> <span class="nf">Thread</span><span class="o">(</span><span class="n">c</span><span class="o">).</span><span class="na">start</span><span class="o">();</span>
		<span class="o">}</span>
	<span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">Calculator01</span> <span class="kd">implements</span> <span class="n">Runnable</span> <span class="o">{</span>
	<span class="kd">private</span> <span class="kt">int</span> <span class="n">number</span><span class="o">;</span>

	<span class="kd">public</span> <span class="nf">Calculator01</span><span class="o">(</span><span class="kt">int</span> <span class="n">number</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">number</span> <span class="o">=</span> <span class="n">number</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
			<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getName</span><span class="o">()</span> <span class="o">+</span> <span class="s">": "</span> <span class="o">+</span> <span class="n">number</span> <span class="o">+</span> <span class="s">": "</span> <span class="o">+</span> <span class="n">i</span><span class="o">+</span><span class="s">"*"</span><span class="o">+</span><span class="n">number</span><span class="o">+</span><span class="s">"="</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="n">number</span><span class="o">);</span>
		<span class="o">}</span>
	<span class="o">}</span>
<span class="o">}</span>	


<span class="c1">//测试结果</span>
<span class="n">Thread</span><span class="o">-</span><span class="mi">0</span><span class="o">:</span> <span class="mi">1</span><span class="o">:</span> <span class="mi">1</span><span class="o">*</span><span class="mi">1</span><span class="o">=</span><span class="mi">1</span>
<span class="n">Thread</span><span class="o">-</span><span class="mi">4</span><span class="o">:</span> <span class="mi">5</span><span class="o">:</span> <span class="mi">1</span><span class="o">*</span><span class="mi">5</span><span class="o">=</span><span class="mi">5</span>
<span class="n">Thread</span><span class="o">-</span><span class="mi">5</span><span class="o">:</span> <span class="mi">6</span><span class="o">:</span> <span class="mi">1</span><span class="o">*</span><span class="mi">6</span><span class="o">=</span><span class="mi">6</span>
<span class="n">Thread</span><span class="o">-</span><span class="mi">3</span><span class="o">:</span> <span class="mi">4</span><span class="o">:</span> <span class="mi">1</span><span class="o">*</span><span class="mi">4</span><span class="o">=</span><span class="mi">4</span>
<span class="n">Thread</span><span class="o">-</span><span class="mi">6</span><span class="o">:</span> <span class="mi">7</span><span class="o">:</span> <span class="mi">1</span><span class="o">*</span><span class="mi">7</span><span class="o">=</span><span class="mi">7</span>
<span class="n">Thread</span><span class="o">-</span><span class="mi">6</span><span class="o">:</span> <span class="mi">7</span><span class="o">:</span> <span class="mi">2</span><span class="o">*</span><span class="mi">7</span><span class="o">=</span><span class="mi">14</span>
<span class="o">...</span>
<span class="o">...</span>
<span class="n">Thread</span><span class="o">-</span><span class="mi">8</span><span class="o">:</span> <span class="mi">9</span><span class="o">:</span> <span class="mi">9</span><span class="o">*</span><span class="mi">9</span><span class="o">=</span><span class="mi">81</span>
<span class="o">...</span>
<span class="n">Thread</span><span class="o">-</span><span class="mi">1</span><span class="o">:</span> <span class="mi">2</span><span class="o">:</span> <span class="mi">8</span><span class="o">*</span><span class="mi">2</span><span class="o">=</span><span class="mi">16</span>
<span class="n">Thread</span><span class="o">-</span><span class="mi">0</span><span class="o">:</span> <span class="mi">1</span><span class="o">:</span> <span class="mi">9</span><span class="o">*</span><span class="mi">1</span><span class="o">=</span><span class="mi">9</span>
<span class="n">Thread</span><span class="o">-</span><span class="mi">1</span><span class="o">:</span> <span class="mi">2</span><span class="o">:</span> <span class="mi">9</span><span class="o">*</span><span class="mi">2</span><span class="o">=</span><span class="mi">18</span>
</code></pre>
</div>
<p><br /><br /></p>

<h3 id="获取和设置线程信息">获取和设置线程信息</h3>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">threadtest</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.FileWriter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.PrintWriter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.lang.Thread.State</span><span class="o">;</span>

<span class="cm">/**
 * 获取和设置线程信息
 * ID: 每个线程的独特标识。 
 * Name: 线程的名称。 
 * Priority: 线程对象的优先级。优先级别在1-10之间，1是最低级，10是最高级。不建议改变它们的优先级，但是你想的话也是可以的。 
 * Status: 线程的状态。在Java中，线程只能有这6种中的一种状态： new, runnable, blocked, waiting, time waiting, terminated.
 */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ThreadInfo02</span> <span class="o">{</span>
	
	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
		<span class="c1">//</span>
		<span class="n">Thread</span><span class="o">[]</span> <span class="n">threads</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Thread</span><span class="o">[</span><span class="mi">10</span><span class="o">];</span>
		<span class="n">Thread</span><span class="o">.</span><span class="na">State</span> <span class="n">status</span><span class="o">[]</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Thread</span><span class="o">.</span><span class="na">State</span><span class="o">[</span><span class="mi">10</span><span class="o">];</span>
		<span class="c1">//</span>
		<span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">10</span><span class="o">;</span> <span class="n">i</span><span class="o">++){</span>
		   <span class="n">threads</span><span class="o">[</span><span class="n">i</span><span class="o">]=</span><span class="k">new</span> <span class="n">Thread</span><span class="o">(</span><span class="k">new</span> <span class="n">Calculator02</span><span class="o">(</span><span class="n">i</span><span class="o">));</span>
		   <span class="k">if</span> <span class="o">((</span><span class="n">i</span><span class="o">%</span><span class="mi">2</span><span class="o">)==</span><span class="mi">0</span><span class="o">){</span>
		      <span class="n">threads</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">setPriority</span><span class="o">(</span><span class="n">Thread</span><span class="o">.</span><span class="na">MAX_PRIORITY</span><span class="o">);</span>
		   <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
		      <span class="n">threads</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">setPriority</span><span class="o">(</span><span class="n">Thread</span><span class="o">.</span><span class="na">MIN_PRIORITY</span><span class="o">);</span>
		   <span class="o">}</span>
		   <span class="n">threads</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">setName</span><span class="o">(</span><span class="s">"Thread "</span><span class="o">+</span><span class="n">i</span><span class="o">);</span>
		<span class="o">}</span>
		<span class="c1">//</span>
		<span class="n">PrintWriter</span> <span class="n">pw</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PrintWriter</span><span class="o">(</span><span class="k">new</span> <span class="n">FileWriter</span><span class="o">(</span><span class="s">"/Users/zhangqingli/Desktop/log.txt"</span><span class="o">));</span>
		<span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">10</span><span class="o">;</span> <span class="n">i</span><span class="o">++){</span>
		   <span class="n">pw</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Main : Status of Thread "</span><span class="o">+</span><span class="n">i</span><span class="o">+</span><span class="s">" : "</span> <span class="o">+</span><span class="n">threads</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">getState</span><span class="o">());</span>
		   <span class="n">pw</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>
		   <span class="n">status</span><span class="o">[</span><span class="n">i</span><span class="o">]=</span><span class="n">threads</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">getState</span><span class="o">();</span>
		<span class="o">}</span>
		<span class="c1">//</span>
		<span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
			<span class="n">threads</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">start</span><span class="o">();</span>
		<span class="o">}</span>
		
		<span class="c1">//</span>
		<span class="kt">boolean</span> <span class="n">finish</span><span class="o">=</span><span class="kc">false</span><span class="o">;</span>
		<span class="k">while</span> <span class="o">(!</span><span class="n">finish</span><span class="o">)</span> <span class="o">{</span>
		   <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">10</span><span class="o">;</span> <span class="n">i</span><span class="o">++){</span>
		      <span class="k">if</span> <span class="o">(</span><span class="n">threads</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">getState</span><span class="o">()!=</span><span class="n">status</span><span class="o">[</span><span class="n">i</span><span class="o">])</span> <span class="o">{</span>
		          <span class="n">writeThreadInfo</span><span class="o">(</span><span class="n">pw</span><span class="o">,</span> <span class="n">threads</span><span class="o">[</span><span class="n">i</span><span class="o">],</span> <span class="n">status</span><span class="o">[</span><span class="n">i</span><span class="o">]);</span>
		          <span class="n">status</span><span class="o">[</span><span class="n">i</span><span class="o">]=</span><span class="n">threads</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">getState</span><span class="o">();</span>
		      <span class="o">}</span>
		   <span class="o">}</span>
		   <span class="c1">//</span>
		   <span class="n">finish</span><span class="o">=</span><span class="kc">true</span><span class="o">;</span>
		   <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">10</span><span class="o">;</span> <span class="n">i</span><span class="o">++){</span>
		      <span class="n">finish</span><span class="o">=</span><span class="n">finish</span> <span class="o">&amp;&amp;</span> <span class="o">(</span><span class="n">threads</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">getState</span><span class="o">()==</span><span class="n">State</span><span class="o">.</span><span class="na">TERMINATED</span><span class="o">);</span>
		   <span class="o">}</span>
		<span class="o">}</span>
	<span class="o">}</span>
	
	<span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">writeThreadInfo</span><span class="o">(</span><span class="n">PrintWriter</span> <span class="n">pw</span><span class="o">,</span> <span class="n">Thread</span> <span class="n">thread</span><span class="o">,</span> <span class="n">Thread</span><span class="o">.</span><span class="na">State</span> <span class="n">state</span><span class="o">)</span> <span class="o">{</span>
	   <span class="n">pw</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"Main : Id %d - %s\n"</span><span class="o">,</span><span class="n">thread</span><span class="o">.</span><span class="na">getId</span><span class="o">(),</span><span class="n">thread</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
	   <span class="n">pw</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"Main : Priority: %d\n"</span><span class="o">,</span><span class="n">thread</span><span class="o">.</span><span class="na">getPriority</span><span class="o">());</span>
	   <span class="n">pw</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"Main : Old State: %s\n"</span><span class="o">,</span><span class="n">state</span><span class="o">);</span>
	   <span class="n">pw</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"Main : New State: %s\n"</span><span class="o">,</span><span class="n">thread</span><span class="o">.</span><span class="na">getState</span><span class="o">());</span>
	   <span class="n">pw</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"Main : ************************************\n"</span><span class="o">);</span>
	   <span class="n">pw</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>
	<span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">Calculator02</span> <span class="kd">implements</span> <span class="n">Runnable</span> <span class="o">{</span>
	<span class="kd">private</span> <span class="kt">int</span> <span class="n">number</span><span class="o">;</span>
	
	<span class="kd">public</span> <span class="nf">Calculator02</span><span class="o">(</span><span class="kt">int</span> <span class="n">number</span><span class="o">)</span> <span class="o">{</span>
	   <span class="k">this</span><span class="o">.</span><span class="na">number</span><span class="o">=</span><span class="n">number</span><span class="o">;</span>
	<span class="o">}</span>
	
	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;=</span><span class="mi">10</span><span class="o">;</span> <span class="n">i</span><span class="o">++){</span>
			<span class="k">try</span> <span class="o">{</span>
				<span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">3000</span><span class="o">);</span>
			<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
				<span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
			<span class="o">}</span>
		   <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"%s: %d * %d = %d\n"</span><span class="o">,</span> <span class="n">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getName</span><span class="o">(),</span> <span class="n">number</span><span class="o">,</span> <span class="n">i</span><span class="o">,</span> <span class="n">i</span><span class="o">*</span><span class="n">number</span><span class="o">);</span>
		<span class="o">}</span>
	<span class="o">}</span>
<span class="o">}</span>

<span class="c1">//执行结果</span>
<span class="n">Thread</span> <span class="mi">1</span><span class="o">:</span> <span class="mi">1</span> <span class="o">*</span> <span class="mi">1</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">Thread</span> <span class="mi">0</span><span class="o">:</span> <span class="mi">0</span> <span class="o">*</span> <span class="mi">1</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">Thread</span> <span class="mi">3</span><span class="o">:</span> <span class="mi">3</span> <span class="o">*</span> <span class="mi">1</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">Thread</span> <span class="mi">2</span><span class="o">:</span> <span class="mi">2</span> <span class="o">*</span> <span class="mi">1</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">Thread</span> <span class="mi">4</span><span class="o">:</span> <span class="mi">4</span> <span class="o">*</span> <span class="mi">1</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">Thread</span> <span class="mi">6</span><span class="o">:</span> <span class="mi">6</span> <span class="o">*</span> <span class="mi">1</span> <span class="o">=</span> <span class="mi">6</span>
<span class="n">Thread</span> <span class="mi">7</span><span class="o">:</span> <span class="mi">7</span> <span class="o">*</span> <span class="mi">1</span> <span class="o">=</span> <span class="mi">7</span>
<span class="n">Thread</span> <span class="mi">9</span><span class="o">:</span> <span class="mi">9</span> <span class="o">*</span> <span class="mi">1</span> <span class="o">=</span> <span class="mi">9</span>
<span class="n">Thread</span> <span class="mi">5</span><span class="o">:</span> <span class="mi">5</span> <span class="o">*</span> <span class="mi">1</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">Thread</span> <span class="mi">8</span><span class="o">:</span> <span class="mi">8</span> <span class="o">*</span> <span class="mi">1</span> <span class="o">=</span> <span class="mi">8</span>
<span class="o">...</span>
<span class="n">Thread</span> <span class="mi">4</span><span class="o">:</span> <span class="mi">4</span> <span class="o">*</span> <span class="mi">9</span> <span class="o">=</span> <span class="mi">36</span>
<span class="n">Thread</span> <span class="mi">9</span><span class="o">:</span> <span class="mi">9</span> <span class="o">*</span> <span class="mi">9</span> <span class="o">=</span> <span class="mi">81</span>
<span class="n">Thread</span> <span class="mi">3</span><span class="o">:</span> <span class="mi">3</span> <span class="o">*</span> <span class="mi">9</span> <span class="o">=</span> <span class="mi">27</span>
<span class="o">...</span>


<span class="n">log</span><span class="o">.</span><span class="na">txt</span>
<span class="n">Main</span> <span class="o">:</span> <span class="n">Status</span> <span class="n">of</span> <span class="n">Thread</span> <span class="mi">0</span> <span class="o">:</span> <span class="n">NEW</span>
<span class="n">Main</span> <span class="o">:</span> <span class="n">Status</span> <span class="n">of</span> <span class="n">Thread</span> <span class="mi">1</span> <span class="o">:</span> <span class="n">NEW</span>
<span class="n">Main</span> <span class="o">:</span> <span class="n">Status</span> <span class="n">of</span> <span class="n">Thread</span> <span class="mi">2</span> <span class="o">:</span> <span class="n">NEW</span>
<span class="n">Main</span> <span class="o">:</span> <span class="n">Status</span> <span class="n">of</span> <span class="n">Thread</span> <span class="mi">3</span> <span class="o">:</span> <span class="n">NEW</span>
<span class="n">Main</span> <span class="o">:</span> <span class="n">Status</span> <span class="n">of</span> <span class="n">Thread</span> <span class="mi">4</span> <span class="o">:</span> <span class="n">NEW</span>
<span class="n">Main</span> <span class="o">:</span> <span class="n">Status</span> <span class="n">of</span> <span class="n">Thread</span> <span class="mi">5</span> <span class="o">:</span> <span class="n">NEW</span>
<span class="n">Main</span> <span class="o">:</span> <span class="n">Status</span> <span class="n">of</span> <span class="n">Thread</span> <span class="mi">6</span> <span class="o">:</span> <span class="n">NEW</span>
<span class="n">Main</span> <span class="o">:</span> <span class="n">Status</span> <span class="n">of</span> <span class="n">Thread</span> <span class="mi">7</span> <span class="o">:</span> <span class="n">NEW</span>
<span class="n">Main</span> <span class="o">:</span> <span class="n">Status</span> <span class="n">of</span> <span class="n">Thread</span> <span class="mi">8</span> <span class="o">:</span> <span class="n">NEW</span>
<span class="n">Main</span> <span class="o">:</span> <span class="n">Status</span> <span class="n">of</span> <span class="n">Thread</span> <span class="mi">9</span> <span class="o">:</span> <span class="n">NEW</span>
<span class="n">Main</span> <span class="o">:</span> <span class="n">Id</span> <span class="mi">8</span> <span class="o">-</span> <span class="n">Thread</span> <span class="mi">0</span>
<span class="n">Main</span> <span class="o">:</span> <span class="nl">Priority:</span> <span class="mi">10</span>
<span class="n">Main</span> <span class="o">:</span> <span class="n">Old</span> <span class="nl">State:</span> <span class="n">NEW</span>
<span class="n">Main</span> <span class="o">:</span> <span class="n">New</span> <span class="nl">State:</span> <span class="n">TIMED_WAITING</span>
<span class="n">Main</span> <span class="o">:</span> <span class="o">************************************</span>
<span class="n">Main</span> <span class="o">:</span> <span class="n">Id</span> <span class="mi">9</span> <span class="o">-</span> <span class="n">Thread</span> <span class="mi">1</span>
<span class="n">Main</span> <span class="o">:</span> <span class="nl">Priority:</span> <span class="mi">1</span>
<span class="n">Main</span> <span class="o">:</span> <span class="n">Old</span> <span class="nl">State:</span> <span class="n">NEW</span>
<span class="n">Main</span> <span class="o">:</span> <span class="n">New</span> <span class="nl">State:</span> <span class="n">TIMED_WAITING</span>
<span class="n">Main</span> <span class="o">:</span> <span class="o">************************************</span>
<span class="o">...</span>
<span class="n">Main</span> <span class="o">:</span> <span class="o">************************************</span>
<span class="n">Main</span> <span class="o">:</span> <span class="n">Id</span> <span class="mi">15</span> <span class="o">-</span> <span class="n">Thread</span> <span class="mi">7</span>
<span class="n">Main</span> <span class="o">:</span> <span class="nl">Priority:</span> <span class="mi">1</span>
<span class="n">Main</span> <span class="o">:</span> <span class="n">Old</span> <span class="nl">State:</span> <span class="n">TIMED_WAITING</span>
<span class="n">Main</span> <span class="o">:</span> <span class="n">New</span> <span class="nl">State:</span> <span class="n">RUNNABLE</span>
<span class="n">Main</span> <span class="o">:</span> <span class="o">************************************</span>
<span class="n">Main</span> <span class="o">:</span> <span class="n">Id</span> <span class="mi">16</span> <span class="o">-</span> <span class="n">Thread</span> <span class="mi">8</span>
<span class="n">Main</span> <span class="o">:</span> <span class="nl">Priority:</span> <span class="mi">10</span>
<span class="n">Main</span> <span class="o">:</span> <span class="n">Old</span> <span class="nl">State:</span> <span class="n">RUNNABLE</span>
<span class="n">Main</span> <span class="o">:</span> <span class="n">New</span> <span class="nl">State:</span> <span class="n">TIMED_WAITING</span>
<span class="n">Main</span> <span class="o">:</span> <span class="o">************************************</span>
<span class="n">Main</span> <span class="o">:</span> <span class="n">Id</span> <span class="mi">9</span> <span class="o">-</span> <span class="n">Thread</span> <span class="mi">1</span>
<span class="n">Main</span> <span class="o">:</span> <span class="nl">Priority:</span> <span class="mi">1</span>
<span class="n">Main</span> <span class="o">:</span> <span class="n">Old</span> <span class="nl">State:</span> <span class="n">BLOCKED</span>
<span class="n">Main</span> <span class="o">:</span> <span class="n">New</span> <span class="nl">State:</span> <span class="n">TIMED_WAITING</span>
<span class="n">Main</span> <span class="o">:</span> <span class="o">************************************</span>
<span class="o">...</span>
</code></pre>
</div>
<p><br /><br /></p>

<h3 id="线程的中断">线程的中断</h3>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">threadtest</span><span class="o">;</span>
<span class="cm">/**
 * 线程的中断
 * 1. java中提供 thread.interrupt() 和 thread.isInterrupted() 来控制线程的中断，不过可能会出现难以预料的结果，一般不用这种方法
 * 2. 线程的中断我们一般自己写程序判断和控制
 */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ThreadInterrupt03</span> <span class="o">{</span>
	
	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
		<span class="n">PrimeGenerator03</span> <span class="n">pg</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PrimeGenerator03</span><span class="o">();</span>
		<span class="n">Thread</span> <span class="n">t</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Thread</span><span class="o">(</span><span class="n">pg</span><span class="o">);</span>
		<span class="n">t</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
		
		<span class="c1">//等待5秒，然后中断PrimeGenerator线程</span>
		<span class="k">try</span> <span class="o">{</span>
			<span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">5000</span><span class="o">);</span>
		<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
			<span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
		<span class="o">}</span>
		<span class="n">pg</span><span class="o">.</span><span class="na">interrupted</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
	<span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">PrimeGenerator03</span> <span class="kd">implements</span> <span class="n">Runnable</span> <span class="o">{</span>
	<span class="kd">volatile</span> <span class="kt">boolean</span> <span class="n">interrupted</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
	
	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
		<span class="kt">long</span> <span class="n">num</span> <span class="o">=</span> <span class="mi">1L</span><span class="o">;</span>
		<span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
			<span class="k">if</span> <span class="o">(</span><span class="n">isPrime</span><span class="o">(</span><span class="n">num</span><span class="o">))</span> <span class="o">{</span>
				<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"Num %d is Prime\n"</span><span class="o">,</span> <span class="n">num</span><span class="o">);</span>
			<span class="o">}</span>
			
			<span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">interrupted</span><span class="o">)</span> <span class="o">{</span>
				<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"The Prime Generator has been Interrupted\n"</span><span class="o">);</span>
				<span class="k">return</span><span class="o">;</span>
			<span class="o">}</span>
			<span class="n">num</span><span class="o">++;</span>
			
			<span class="k">try</span> <span class="o">{</span>
				<span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">500</span><span class="o">);</span>
			<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
				<span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
			<span class="o">}</span>
		<span class="o">}</span>
	<span class="o">}</span>
	<span class="kd">private</span> <span class="kt">boolean</span> <span class="nf">isPrime</span><span class="o">(</span><span class="kt">long</span> <span class="n">num</span><span class="o">)</span> <span class="o">{</span> <span class="c1">//判断一个数是否是质数</span>
		<span class="k">if</span> <span class="o">(</span><span class="n">num</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="o">)</span> <span class="o">{</span>
			<span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
		<span class="o">}</span> 
		<span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">2</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">num</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
			<span class="k">if</span> <span class="o">(</span><span class="n">num</span><span class="o">%</span><span class="n">i</span><span class="o">==</span><span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
				<span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
			<span class="o">}</span>
		<span class="o">}</span>
		<span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
	<span class="o">}</span>
	
<span class="o">}</span>

<span class="c1">//执行结果</span>
<span class="n">Num</span> <span class="mi">1</span> <span class="n">is</span> <span class="n">Prime</span>
<span class="n">Num</span> <span class="mi">2</span> <span class="n">is</span> <span class="n">Prime</span>
<span class="n">Num</span> <span class="mi">3</span> <span class="n">is</span> <span class="n">Prime</span>
<span class="n">Num</span> <span class="mi">5</span> <span class="n">is</span> <span class="n">Prime</span>
<span class="n">Num</span> <span class="mi">7</span> <span class="n">is</span> <span class="n">Prime</span>
<span class="n">Num</span> <span class="mi">11</span> <span class="n">is</span> <span class="n">Prime</span>
<span class="n">The</span> <span class="n">Prime</span> <span class="n">Generator</span> <span class="n">has</span> <span class="n">been</span> <span class="n">Interrupted</span>
</code></pre>
</div>
<p><br /><br /></p>

<h3 id="线程的睡眠与恢复">线程的睡眠与恢复</h3>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">threadtest</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.TimeUnit</span><span class="o">;</span>

<span class="cm">/**
 * 线程的睡眠与恢复
 * @author zhangqingli
 *
 */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ThreadSleep04</span> <span class="o">{</span>
	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">new</span> <span class="nf">Thread</span><span class="o">(</span><span class="k">new</span> <span class="n">FileClock04</span><span class="o">()).</span><span class="na">start</span><span class="o">();</span>
	<span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">FileClock04</span> <span class="kd">implements</span> <span class="n">Runnable</span> <span class="o">{</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
			<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="k">new</span> <span class="n">Date</span><span class="o">());</span>
			<span class="k">try</span> <span class="o">{</span>
				<span class="n">TimeUnit</span><span class="o">.</span><span class="na">SECONDS</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span> <span class="c1">//1s钟睡一次 等价于Thread.sleep</span>
			<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
				<span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
			<span class="o">}</span> 
		<span class="o">}</span>
	<span class="o">}</span>
<span class="o">}</span>

<span class="c1">// 执行结果</span>
<span class="n">Tue</span> <span class="n">Mar</span> <span class="mi">21</span> <span class="mi">12</span><span class="o">:</span><span class="mi">56</span><span class="o">:</span><span class="mi">38</span> <span class="n">CST</span> <span class="mi">2017</span>
<span class="n">Tue</span> <span class="n">Mar</span> <span class="mi">21</span> <span class="mi">12</span><span class="o">:</span><span class="mi">56</span><span class="o">:</span><span class="mi">39</span> <span class="n">CST</span> <span class="mi">2017</span>
<span class="n">Tue</span> <span class="n">Mar</span> <span class="mi">21</span> <span class="mi">12</span><span class="o">:</span><span class="mi">56</span><span class="o">:</span><span class="mi">40</span> <span class="n">CST</span> <span class="mi">2017</span>
<span class="n">Tue</span> <span class="n">Mar</span> <span class="mi">21</span> <span class="mi">12</span><span class="o">:</span><span class="mi">56</span><span class="o">:</span><span class="mi">41</span> <span class="n">CST</span> <span class="mi">2017</span>
<span class="n">Tue</span> <span class="n">Mar</span> <span class="mi">21</span> <span class="mi">12</span><span class="o">:</span><span class="mi">56</span><span class="o">:</span><span class="mi">42</span> <span class="n">CST</span> <span class="mi">2017</span>
<span class="n">Tue</span> <span class="n">Mar</span> <span class="mi">21</span> <span class="mi">12</span><span class="o">:</span><span class="mi">56</span><span class="o">:</span><span class="mi">43</span> <span class="n">CST</span> <span class="mi">2017</span>
<span class="n">Tue</span> <span class="n">Mar</span> <span class="mi">21</span> <span class="mi">12</span><span class="o">:</span><span class="mi">56</span><span class="o">:</span><span class="mi">44</span> <span class="n">CST</span> <span class="mi">2017</span>
<span class="n">Tue</span> <span class="n">Mar</span> <span class="mi">21</span> <span class="mi">12</span><span class="o">:</span><span class="mi">56</span><span class="o">:</span><span class="mi">45</span> <span class="n">CST</span> <span class="mi">2017</span>
<span class="n">Tue</span> <span class="n">Mar</span> <span class="mi">21</span> <span class="mi">12</span><span class="o">:</span><span class="mi">56</span><span class="o">:</span><span class="mi">46</span> <span class="n">CST</span> <span class="mi">2017</span>
<span class="n">Tue</span> <span class="n">Mar</span> <span class="mi">21</span> <span class="mi">12</span><span class="o">:</span><span class="mi">56</span><span class="o">:</span><span class="mi">47</span> <span class="n">CST</span> <span class="mi">2017</span>
</code></pre>
</div>
<p><br /><br /></p>

<h3 id="线程的插入">线程的插入</h3>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">threadtest</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.TimeUnit</span><span class="o">;</span>

<span class="cm">/**
 * 线程的插入 
 * thread.join(): 在当前线程中调用该方法时，当前线程会被暂停，直到调用join方法的线程执行完毕！
 * 
 */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ThreadJoin05</span> <span class="o">{</span>
	<span class="c1">//</span>
	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
		<span class="n">Thread</span> <span class="n">t1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Thread</span><span class="o">(</span><span class="k">new</span> <span class="n">DataSourceLoader05</span><span class="o">());</span>
		<span class="n">Thread</span> <span class="n">t2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Thread</span><span class="o">(</span><span class="k">new</span> <span class="n">NetworkConnectionsLoader</span><span class="o">());</span>
		<span class="n">t1</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
		<span class="n">t2</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
		
		<span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
			<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"["</span><span class="o">+</span> <span class="n">i</span> <span class="o">+</span><span class="s">"] "</span> <span class="o">+</span> <span class="n">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getName</span><span class="o">());</span>
			<span class="k">if</span> <span class="o">(</span><span class="n">i</span><span class="o">==</span><span class="mi">5</span><span class="o">)</span> <span class="o">{</span>
				<span class="k">try</span> <span class="o">{</span>
					<span class="n">t1</span><span class="o">.</span><span class="na">join</span><span class="o">();</span>
					<span class="n">t2</span><span class="o">.</span><span class="na">join</span><span class="o">();</span>
				<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
					<span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
				<span class="o">}</span>
			<span class="o">}</span>
			<span class="k">try</span> <span class="o">{</span>
				<span class="n">TimeUnit</span><span class="o">.</span><span class="na">SECONDS</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
			<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
				<span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
			<span class="o">}</span>
		<span class="o">}</span>
	<span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">DataSourceLoader05</span> <span class="kd">implements</span> <span class="n">Runnable</span> <span class="o">{</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
		<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"["</span><span class="o">+</span> <span class="k">new</span> <span class="n">Date</span><span class="o">()</span> <span class="o">+</span><span class="s">"] datasource loading..."</span><span class="o">);</span>
		<span class="k">try</span> <span class="o">{</span>
			<span class="n">TimeUnit</span><span class="o">.</span><span class="na">SECONDS</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">10</span><span class="o">);</span> <span class="c1">//资源加载10s</span>
		<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
			<span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
		<span class="o">}</span>
		<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"["</span><span class="o">+</span> <span class="k">new</span> <span class="n">Date</span><span class="o">()</span> <span class="o">+</span><span class="s">"] datasource loading has finished!"</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span>


<span class="kd">class</span> <span class="nc">NetworkConnectionsLoader</span> <span class="kd">implements</span> <span class="n">Runnable</span> <span class="o">{</span>
	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
		<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"["</span><span class="o">+</span> <span class="k">new</span> <span class="n">Date</span><span class="o">()</span> <span class="o">+</span><span class="s">"] networkConnections loading..."</span><span class="o">);</span>
		<span class="k">try</span> <span class="o">{</span>
			<span class="n">TimeUnit</span><span class="o">.</span><span class="na">SECONDS</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">15</span><span class="o">);</span> <span class="c1">//资源加载15s</span>
		<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
			<span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
		<span class="o">}</span>
		<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"["</span><span class="o">+</span> <span class="k">new</span> <span class="n">Date</span><span class="o">()</span> <span class="o">+</span><span class="s">"] networkConnections loading has finished!"</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span>


<span class="c1">// 执行结果</span>
<span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="n">main</span>
<span class="o">[</span><span class="n">Tue</span> <span class="n">Mar</span> <span class="mi">21</span> <span class="mi">12</span><span class="o">:</span><span class="mi">58</span><span class="o">:</span><span class="mi">04</span> <span class="n">CST</span> <span class="mi">2017</span><span class="o">]</span> <span class="n">networkConnections</span> <span class="n">loading</span><span class="o">...</span>
<span class="o">[</span><span class="n">Tue</span> <span class="n">Mar</span> <span class="mi">21</span> <span class="mi">12</span><span class="o">:</span><span class="mi">58</span><span class="o">:</span><span class="mi">04</span> <span class="n">CST</span> <span class="mi">2017</span><span class="o">]</span> <span class="n">datasource</span> <span class="n">loading</span><span class="o">...</span>
<span class="o">[</span><span class="mi">1</span><span class="o">]</span> <span class="n">main</span>
<span class="o">[</span><span class="mi">2</span><span class="o">]</span> <span class="n">main</span>
<span class="o">[</span><span class="mi">3</span><span class="o">]</span> <span class="n">main</span>
<span class="o">[</span><span class="mi">4</span><span class="o">]</span> <span class="n">main</span>
<span class="o">[</span><span class="mi">5</span><span class="o">]</span> <span class="n">main</span>
<span class="o">[</span><span class="n">Tue</span> <span class="n">Mar</span> <span class="mi">21</span> <span class="mi">12</span><span class="o">:</span><span class="mi">58</span><span class="o">:</span><span class="mi">14</span> <span class="n">CST</span> <span class="mi">2017</span><span class="o">]</span> <span class="n">datasource</span> <span class="n">loading</span> <span class="n">has</span> <span class="n">finished</span><span class="o">!</span>
<span class="o">[</span><span class="n">Tue</span> <span class="n">Mar</span> <span class="mi">21</span> <span class="mi">12</span><span class="o">:</span><span class="mi">58</span><span class="o">:</span><span class="mi">19</span> <span class="n">CST</span> <span class="mi">2017</span><span class="o">]</span> <span class="n">networkConnections</span> <span class="n">loading</span> <span class="n">has</span> <span class="n">finished</span><span class="o">!</span>
<span class="o">[</span><span class="mi">6</span><span class="o">]</span> <span class="n">main</span>
<span class="o">[</span><span class="mi">7</span><span class="o">]</span> <span class="n">main</span>
<span class="o">[</span><span class="mi">8</span><span class="o">]</span> <span class="n">main</span>
<span class="o">[</span><span class="mi">9</span><span class="o">]</span> <span class="n">main</span>
</code></pre>
</div>
<p><br /><br /></p>

<h3 id="守护线程的创建的运行">守护线程的创建的运行</h3>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">threadtest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.ArrayDeque</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Deque</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.TimeUnit</span><span class="o">;</span>
<span class="cm">/**
 * 守护线程的创建和运行
 * Java有一种特别的线程叫做守护线程。这种线程的优先级非常低，通常在程序里没有其他线程运行时才会执行它。
 * 当进程中不存在非守护线程了，则守护线程自动销毁。典型的守护线程就是垃圾回收线程，当进程中没有非守护
 * 线程了，则垃圾回收线程也就没有存在的必要了，自动销毁。用个比较通俗的比喻来解释一下守护线程，就是：
 * 任何一个守护线程都是整个JVM非守护线程的“保姆”。
 * 
 * 根据这些特点，守护线程通常用于在同一程序里给普通线程（也叫使用者线程）提供服务。
 * 它们通常无限循环的等待服务请求或执行线程任务。它们不能做重要的任务，因为我们不
 * 知道什么时候会被分配到CPU时间片，并且只要没有其他线程在运行，它们可能随时被终止。
 * JAVA中最典型的这种类型代表就是垃圾回收器。
 * 
 * 在这个测试中, 我们将学习如何创建一个守护线程，开发一个用2个线程的例子；
 * 我们的使用线程会写事件到queue, 守护线程会清除queue里10秒前创建的事件。
 */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ThreadDaemon06</span> <span class="o">{</span>
	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
		<span class="c1">//工作线程向双队列中写事件</span>
		<span class="n">Deque</span><span class="o">&lt;</span><span class="n">Event</span><span class="o">&gt;</span> <span class="n">deque</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayDeque</span><span class="o">&lt;</span><span class="n">Event</span><span class="o">&gt;();</span>
		<span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
			<span class="k">new</span> <span class="nf">Thread</span><span class="o">(</span><span class="k">new</span> <span class="n">WriterTask</span><span class="o">(</span><span class="n">deque</span><span class="o">)).</span><span class="na">start</span><span class="o">();</span>
		<span class="o">}</span>
		<span class="c1">//守护线程清除10s之前的时间</span>
		<span class="n">CleanerTask</span> <span class="n">cleanerTask</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CleanerTask</span><span class="o">(</span><span class="n">deque</span><span class="o">);</span>
		<span class="n">cleanerTask</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
	<span class="o">}</span>
<span class="o">}</span>


<span class="kd">class</span> <span class="nc">Event</span> <span class="o">{</span>
	<span class="n">Date</span> <span class="n">date</span><span class="o">;</span>
	<span class="n">String</span> <span class="n">event</span><span class="o">;</span>

	<span class="kd">public</span> <span class="nf">Event</span><span class="o">(</span><span class="n">Date</span> <span class="n">date</span><span class="o">,</span> <span class="n">String</span> <span class="n">event</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">date</span> <span class="o">=</span> <span class="n">date</span><span class="o">;</span>
		<span class="k">this</span><span class="o">.</span><span class="na">event</span> <span class="o">=</span> <span class="n">event</span><span class="o">;</span>
	<span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">WriterTask</span> <span class="kd">implements</span> <span class="n">Runnable</span> <span class="o">{</span>
	<span class="kd">private</span> <span class="n">Deque</span><span class="o">&lt;</span><span class="n">Event</span><span class="o">&gt;</span> <span class="n">deque</span><span class="o">;</span> <span class="c1">//双向队列，可实现栈的数据结构</span>
	
	<span class="kd">public</span> <span class="nf">WriterTask</span><span class="o">(</span><span class="n">Deque</span><span class="o">&lt;</span><span class="n">Event</span><span class="o">&gt;</span> <span class="n">deque</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">deque</span> <span class="o">=</span> <span class="n">deque</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
			<span class="n">Event</span> <span class="n">event</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Event</span><span class="o">(</span><span class="k">new</span> <span class="n">Date</span><span class="o">(),</span> <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"The thread %s has generated an event"</span><span class="o">,</span> <span class="n">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getId</span><span class="o">()));</span>
			<span class="n">deque</span><span class="o">.</span><span class="na">addFirst</span><span class="o">(</span><span class="n">event</span><span class="o">);</span>
			<span class="k">try</span> <span class="o">{</span>
				<span class="n">TimeUnit</span><span class="o">.</span><span class="na">SECONDS</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
			<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
				<span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
			<span class="o">}</span>
		<span class="o">}</span>
	<span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">CleanerTask</span> <span class="kd">extends</span> <span class="n">Thread</span> <span class="o">{</span>
	<span class="kd">private</span> <span class="n">Deque</span><span class="o">&lt;</span><span class="n">Event</span><span class="o">&gt;</span> <span class="n">deque</span><span class="o">;</span>

	<span class="kd">public</span> <span class="nf">CleanerTask</span><span class="o">(</span><span class="n">Deque</span><span class="o">&lt;</span><span class="n">Event</span><span class="o">&gt;</span> <span class="n">deque</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">deque</span> <span class="o">=</span> <span class="n">deque</span><span class="o">;</span>
		<span class="c1">//设置为守护线程</span>
		<span class="c1">//只能在start()方法之前可以调用setDaemon()方法。因为一旦线程运行了，就不能修改守护状态。</span>
		<span class="kd">super</span><span class="o">.</span><span class="na">setDaemon</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
			<span class="n">Date</span> <span class="n">date</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Date</span><span class="o">();</span>
			<span class="n">clean</span><span class="o">(</span><span class="n">date</span><span class="o">);</span>
		<span class="o">}</span>
	<span class="o">}</span>

	<span class="c1">//它获取最后的事件，如果它在10秒前被创建，就删除它并查看下一个事件。</span>
	<span class="c1">//如果一个事件被删除，它会写一个事件信息和queue的新的大小，为了让你看到变化过程</span>
	<span class="kd">private</span> <span class="kt">void</span> <span class="nf">clean</span><span class="o">(</span><span class="n">Date</span> <span class="n">date</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">if</span> <span class="o">(</span><span class="n">deque</span><span class="o">.</span><span class="na">size</span><span class="o">()==</span><span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
			<span class="k">return</span><span class="o">;</span>
		<span class="o">}</span>
		<span class="kt">long</span> <span class="n">time</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
		<span class="kt">boolean</span> <span class="n">deleteFlag</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
		
		<span class="k">do</span> <span class="o">{</span>
			<span class="n">Event</span> <span class="n">event</span> <span class="o">=</span> <span class="n">deque</span><span class="o">.</span><span class="na">getLast</span><span class="o">();</span>
			<span class="n">time</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="na">getTime</span><span class="o">()</span> <span class="o">-</span> <span class="n">event</span><span class="o">.</span><span class="na">date</span><span class="o">.</span><span class="na">getTime</span><span class="o">();</span>
			<span class="k">if</span> <span class="o">(</span><span class="n">time</span> <span class="o">&gt;</span> <span class="mi">10000</span><span class="o">)</span> <span class="o">{</span>
				<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"Cleaner: %s\n"</span><span class="o">,</span> <span class="n">event</span><span class="o">.</span><span class="na">event</span><span class="o">);</span> 
				<span class="n">deque</span><span class="o">.</span><span class="na">removeLast</span><span class="o">();</span>
				<span class="n">deleteFlag</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
			<span class="o">}</span>
		<span class="o">}</span> <span class="k">while</span> <span class="o">(</span><span class="n">time</span> <span class="o">&gt;</span> <span class="mi">10000</span><span class="o">);</span>
		
		<span class="k">if</span> <span class="o">(</span><span class="n">deleteFlag</span><span class="o">)</span> <span class="o">{</span>
			<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"Cleaner: Size of the queue: %d\n"</span><span class="o">,</span> <span class="n">deque</span><span class="o">.</span><span class="na">size</span><span class="o">());</span>
		<span class="o">}</span>
	<span class="o">}</span>
<span class="o">}</span>


<span class="c1">// 运行结果</span>
<span class="o">...</span>
<span class="nl">Cleaner:</span> <span class="n">Size</span> <span class="n">of</span> <span class="n">the</span> <span class="nl">queue:</span> <span class="mi">19</span>
<span class="nl">Cleaner:</span> <span class="n">The</span> <span class="n">thread</span> <span class="mi">10</span> <span class="n">has</span> <span class="n">generated</span> <span class="n">an</span> <span class="n">event</span>
<span class="nl">Cleaner:</span> <span class="n">The</span> <span class="n">thread</span> <span class="mi">8</span> <span class="n">has</span> <span class="n">generated</span> <span class="n">an</span> <span class="n">event</span>
<span class="nl">Cleaner:</span> <span class="n">The</span> <span class="n">thread</span> <span class="mi">9</span> <span class="n">has</span> <span class="n">generated</span> <span class="n">an</span> <span class="n">event</span>
<span class="nl">Cleaner:</span> <span class="n">Size</span> <span class="n">of</span> <span class="n">the</span> <span class="nl">queue:</span> <span class="mi">19</span>
<span class="nl">Cleaner:</span> <span class="n">The</span> <span class="n">thread</span> <span class="mi">9</span> <span class="n">has</span> <span class="n">generated</span> <span class="n">an</span> <span class="n">event</span>
<span class="nl">Cleaner:</span> <span class="n">The</span> <span class="n">thread</span> <span class="mi">8</span> <span class="n">has</span> <span class="n">generated</span> <span class="n">an</span> <span class="n">event</span>
<span class="nl">Cleaner:</span> <span class="n">Size</span> <span class="n">of</span> <span class="n">the</span> <span class="nl">queue:</span> <span class="mi">18</span>
<span class="nl">Cleaner:</span> <span class="n">The</span> <span class="n">thread</span> <span class="mi">8</span> <span class="n">has</span> <span class="n">generated</span> <span class="n">an</span> <span class="n">event</span>
<span class="nl">Cleaner:</span> <span class="n">The</span> <span class="n">thread</span> <span class="mi">10</span> <span class="n">has</span> <span class="n">generated</span> <span class="n">an</span> <span class="n">event</span>
<span class="nl">Cleaner:</span> <span class="n">Size</span> <span class="n">of</span> <span class="n">the</span> <span class="nl">queue:</span> <span class="mi">19</span>
<span class="nl">Cleaner:</span> <span class="n">The</span> <span class="n">thread</span> <span class="mi">10</span> <span class="n">has</span> <span class="n">generated</span> <span class="n">an</span> <span class="n">event</span>
<span class="nl">Cleaner:</span> <span class="n">The</span> <span class="n">thread</span> <span class="mi">8</span> <span class="n">has</span> <span class="n">generated</span> <span class="n">an</span> <span class="n">event</span>
<span class="nl">Cleaner:</span> <span class="n">Size</span> <span class="n">of</span> <span class="n">the</span> <span class="nl">queue:</span> <span class="mi">19</span>
<span class="nl">Cleaner:</span> <span class="n">The</span> <span class="n">thread</span> <span class="mi">9</span> <span class="n">has</span> <span class="n">generated</span> <span class="n">an</span> <span class="n">event</span>
<span class="nl">Cleaner:</span> <span class="n">The</span> <span class="n">thread</span> <span class="mi">8</span> <span class="n">has</span> <span class="n">generated</span> <span class="n">an</span> <span class="n">event</span>
<span class="nl">Cleaner:</span> <span class="n">Size</span> <span class="n">of</span> <span class="n">the</span> <span class="nl">queue:</span> <span class="mi">18</span>
<span class="nl">Cleaner:</span> <span class="n">The</span> <span class="n">thread</span> <span class="mi">10</span> <span class="n">has</span> <span class="n">generated</span> <span class="n">an</span> <span class="n">event</span>
<span class="nl">Cleaner:</span> <span class="n">Size</span> <span class="n">of</span> <span class="n">the</span> <span class="nl">queue:</span> <span class="mi">19</span>
<span class="o">...</span>
</code></pre>
</div>
<p><br /><br /></p>

<h3 id="在线程里处理运行时异常未检查异常">在线程里处理运行时异常（未检查异常）</h3>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">threadtest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.lang.Thread.UncaughtExceptionHandler</span><span class="o">;</span>
<span class="cm">/**
 * 在线程里处理不受控制的异常
 * 
 * 当在一个线程里抛出一个异常，但是这个异常没有被捕获（这肯定是非检查异常），JVM 检查线程的相关方法是否有
 * 设置一个未捕捉异常的处理者 。如果有，JVM 使用Thread 对象和 Exception 作为参数调用此方法 。如果线程
 * 没有捕捉未捕获异常的处理者， 那么 JVM会把异常的 stack trace 写入操控台并结束任务。
 * 
 * Thread 类有其他相关方法可以处理未捕获的异常。静态方法 setDefaultUncaughtExceptionHandler() 
 * 为应用里的所有线程对象建立异常 handler 。当一个未捕捉的异常在线程里被抛出，JVM会寻找此异常的3种
 * 可能潜在的处理者（handler）。
 * 首先, 它寻找这个未捕捉的线程对象的异常handle，如我们在在这个指南中学习的。如果这个handle 不存在，
 * 那么JVM会在线程对象的ThreadGroup里寻找非捕捉异常的handler，如此例。如果此方法不存在，那么 JVM 
 * 会寻找默认非捕捉异常handle。如果没有一个handler存在, 那么 JVM会把异常的 stack trace 写入操控
 * 台并结束任务。
 * 
 */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TaskWithUncaughtException07</span> <span class="kd">implements</span> <span class="n">Runnable</span> <span class="o">{</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
			<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"["</span> <span class="o">+</span> <span class="n">i</span> <span class="o">+</span> <span class="s">"]"</span><span class="o">);</span>
			<span class="k">if</span> <span class="o">(</span><span class="n">i</span><span class="o">==</span><span class="mi">5</span><span class="o">)</span> <span class="o">{</span>
				<span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="s">"TTT"</span><span class="o">);</span> <span class="c1">//未检查异常（RuntimeException），这里没有将它捕获处理</span>
			<span class="o">}</span>
		<span class="o">}</span>
	<span class="o">}</span>
	
	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
		<span class="n">Thread</span> <span class="n">t</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Thread</span><span class="o">(</span><span class="k">new</span> <span class="n">TaskWithUncaughtException07</span><span class="o">());</span>
		
		<span class="c1">//为线程设置异常处理器</span>
		<span class="n">t</span><span class="o">.</span><span class="na">setUncaughtExceptionHandler</span><span class="o">(</span><span class="k">new</span> <span class="n">UncaughtExceptionHandler</span><span class="o">()</span> <span class="o">{</span>
			<span class="nd">@Override</span>
			<span class="kd">public</span> <span class="kt">void</span> <span class="nf">uncaughtException</span><span class="o">(</span><span class="n">Thread</span> <span class="n">t</span><span class="o">,</span> <span class="n">Throwable</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
				<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"---------------异常信息-----------------"</span><span class="o">);</span>
				<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Thread: "</span> <span class="o">+</span> <span class="n">t</span><span class="o">.</span><span class="na">getId</span><span class="o">()</span> <span class="o">+</span> <span class="s">" "</span> <span class="o">+</span> <span class="n">t</span><span class="o">.</span><span class="na">getState</span><span class="o">());</span>
				<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Exceprion: "</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getName</span><span class="o">()</span> <span class="o">+</span> <span class="s">" "</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
				<span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">);</span>
			<span class="o">}</span>
		<span class="o">});</span>
		
		<span class="n">t</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
	<span class="o">}</span>
<span class="o">}</span>


<span class="c1">// 运行结果：</span>
<span class="o">[</span><span class="mi">0</span><span class="o">]</span>
<span class="o">[</span><span class="mi">1</span><span class="o">]</span>
<span class="o">[</span><span class="mi">2</span><span class="o">]</span>
<span class="o">[</span><span class="mi">3</span><span class="o">]</span>
<span class="o">[</span><span class="mi">4</span><span class="o">]</span>
<span class="o">[</span><span class="mi">5</span><span class="o">]</span>
<span class="o">---------------</span><span class="err">异常信息</span><span class="o">-----------------</span>
<span class="nl">Thread:</span> <span class="mi">8</span> <span class="n">RUNNABLE</span>
<span class="nl">Exceprion:</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">NumberFormatException</span> <span class="n">For</span> <span class="n">input</span> <span class="nl">string:</span> <span class="s">"TTT"</span>
<span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">NumberFormatException</span><span class="o">:</span> <span class="n">For</span> <span class="n">input</span> <span class="nl">string:</span> <span class="s">"TTT"</span>
	<span class="n">at</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">NumberFormatException</span><span class="o">.</span><span class="na">forInputString</span><span class="o">(</span><span class="n">NumberFormatException</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">65</span><span class="o">)</span>
	<span class="n">at</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">Integer</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">492</span><span class="o">)</span>
	<span class="n">at</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">Integer</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">527</span><span class="o">)</span>
	<span class="n">at</span> <span class="n">threadtest</span><span class="o">.</span><span class="na">TaskWithUncaughtException07</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="n">TaskWithUncaughtException07</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">28</span><span class="o">)</span>
	<span class="n">at</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Thread</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="n">Thread</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">745</span><span class="o">)</span>
</code></pre>
</div>
<p><br /><br /></p>

<h3 id="使用本地线程变量">使用本地线程变量</h3>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">threadtest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.TimeUnit</span><span class="o">;</span>
<span class="cm">/**
 * 使用本地线程变量
 *
 */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ThreadLocalTest08</span> <span class="o">{</span>
	
	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
		<span class="c1">//Task task = new UnsafeTask();</span>
		<span class="n">Task</span> <span class="n">task</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SafeTask</span><span class="o">();</span>
		<span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
			<span class="k">new</span> <span class="nf">Thread</span><span class="o">(</span><span class="n">task</span><span class="o">).</span><span class="na">start</span><span class="o">();</span>
			<span class="c1">//</span>
			<span class="k">try</span> <span class="o">{</span> 
				<span class="n">TimeUnit</span><span class="o">.</span><span class="na">SECONDS</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">2</span><span class="o">);</span>
			<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
				<span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
			<span class="o">}</span>

		<span class="o">}</span>
	<span class="o">}</span>
	
<span class="o">}</span>


<span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">Task</span> <span class="kd">implements</span> <span class="n">Runnable</span> <span class="o">{}</span>

<span class="c1">//此类startDate为非本地线程变量</span>
<span class="c1">//如果你创建一个类对象，实现Runnable接口，然后多个Thread对象使用同样的Runnable对象，全部的线程都共享同样的属性。</span>
<span class="c1">//这意味着，如果你在一个线程里改变一个属性，全部的线程都会受到这个改变的影响。</span>
<span class="kd">class</span> <span class="nc">UnsafeTask</span> <span class="kd">extends</span> <span class="n">Task</span> <span class="kd">implements</span> <span class="n">Runnable</span> <span class="o">{</span>
	<span class="kd">private</span> <span class="n">Date</span> <span class="n">startDate</span><span class="o">;</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
		<span class="n">startDate</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Date</span><span class="o">();</span>
		<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"Starting Thread: %s : %s\n"</span><span class="o">,</span><span class="n">Thread</span><span class="o">.</span> <span class="nf">currentThread</span><span class="o">().</span><span class="na">getId</span><span class="o">(),</span><span class="n">startDate</span><span class="o">);</span>
		
		<span class="k">try</span> <span class="o">{</span>
			<span class="n">TimeUnit</span><span class="o">.</span><span class="na">SECONDS</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span><span class="n">Math</span><span class="o">.</span><span class="na">rint</span><span class="o">(</span><span class="n">Math</span><span class="o">.</span><span class="na">random</span><span class="o">()*</span><span class="mi">10</span><span class="o">));</span>
		<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
			<span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
		<span class="o">}</span>
		<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"Thread Finished: %s : %s\n"</span><span class="o">,</span><span class="n">Thread</span><span class="o">.</span> <span class="nf">currentThread</span><span class="o">().</span><span class="na">getId</span><span class="o">(),</span><span class="n">startDate</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span>

<span class="c1">//此类startDate为本地线程变量</span>
<span class="c1">//有时，你希望程序里的各个线程的属性不会被共享。 Java 并发 API提供了一个很清楚的机制叫本地线程变量。</span>
<span class="c1">//本地线程类还提供 remove() 方法，删除存储在线程本地变量里的值。</span>
<span class="c1">//另外，Java 并发 API 包括 InheritableThreadLocal 类提供线程创建线程的值的遗传性 。</span>
<span class="c1">//如果线程A有一个本地线程变量，然后它创建了另一个线程B，那么线程B将有与A相同的本地线程变量值。 </span>
<span class="c1">//你可以覆盖 childValue() 方法来初始子线程的本地线程变量的值。 它接收父线程的本地线程变量作为参数。</span>
<span class="kd">class</span> <span class="nc">SafeTask</span> <span class="kd">extends</span> <span class="n">Task</span> <span class="kd">implements</span> <span class="n">Runnable</span> <span class="o">{</span>
	<span class="kd">private</span> <span class="n">ThreadLocal</span><span class="o">&lt;</span><span class="n">Date</span><span class="o">&gt;</span> <span class="n">startDate</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ThreadLocal</span><span class="o">&lt;</span><span class="n">Date</span><span class="o">&gt;()</span> <span class="o">{</span>
		<span class="nd">@Override</span>
		<span class="kd">protected</span> <span class="n">Date</span> <span class="nf">initialValue</span><span class="o">()</span> <span class="o">{</span>
			<span class="k">return</span> <span class="k">new</span> <span class="nf">Date</span><span class="o">();</span>
		<span class="o">}</span>
	<span class="o">};</span>
	
	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
		<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"Starting Thread: %s : %s\n"</span><span class="o">,</span><span class="n">Thread</span><span class="o">.</span> <span class="nf">currentThread</span><span class="o">().</span><span class="na">getId</span><span class="o">(),</span><span class="n">startDate</span><span class="o">.</span><span class="na">get</span><span class="o">());</span>
		
		<span class="k">try</span> <span class="o">{</span>
			<span class="n">TimeUnit</span><span class="o">.</span><span class="na">SECONDS</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span><span class="n">Math</span><span class="o">.</span><span class="na">rint</span><span class="o">(</span><span class="n">Math</span><span class="o">.</span><span class="na">random</span><span class="o">()*</span><span class="mi">10</span><span class="o">));</span>
		<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
			<span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
		<span class="o">}</span>
		<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"Thread Finished: %s : %s\n"</span><span class="o">,</span><span class="n">Thread</span><span class="o">.</span> <span class="nf">currentThread</span><span class="o">().</span><span class="na">getId</span><span class="o">(),</span><span class="n">startDate</span><span class="o">.</span><span class="na">get</span><span class="o">());</span>
	<span class="o">}</span>
<span class="o">}</span>


<span class="c1">//使用UnsafeTask执行结果</span>
<span class="n">Starting</span> <span class="nl">Thread:</span> <span class="mi">8</span> <span class="o">:</span> <span class="n">Tue</span> <span class="n">Mar</span> <span class="mi">21</span> <span class="mi">14</span><span class="o">:</span><span class="mi">30</span><span class="o">:</span><span class="mi">31</span> <span class="n">CST</span> <span class="mi">2017</span>
<span class="n">Starting</span> <span class="nl">Thread:</span> <span class="mi">9</span> <span class="o">:</span> <span class="n">Tue</span> <span class="n">Mar</span> <span class="mi">21</span> <span class="mi">14</span><span class="o">:</span><span class="mi">30</span><span class="o">:</span><span class="mi">33</span> <span class="n">CST</span> <span class="mi">2017</span>
<span class="n">Starting</span> <span class="nl">Thread:</span> <span class="mi">10</span> <span class="o">:</span> <span class="n">Tue</span> <span class="n">Mar</span> <span class="mi">21</span> <span class="mi">14</span><span class="o">:</span><span class="mi">30</span><span class="o">:</span><span class="mi">35</span> <span class="n">CST</span> <span class="mi">2017</span>
<span class="n">Thread</span> <span class="nl">Finished:</span> <span class="mi">8</span> <span class="o">:</span> <span class="n">Tue</span> <span class="n">Mar</span> <span class="mi">21</span> <span class="mi">14</span><span class="o">:</span><span class="mi">30</span><span class="o">:</span><span class="mi">35</span> <span class="n">CST</span> <span class="mi">2017</span>
<span class="n">Starting</span> <span class="nl">Thread:</span> <span class="mi">11</span> <span class="o">:</span> <span class="n">Tue</span> <span class="n">Mar</span> <span class="mi">21</span> <span class="mi">14</span><span class="o">:</span><span class="mi">30</span><span class="o">:</span><span class="mi">37</span> <span class="n">CST</span> <span class="mi">2017</span>
<span class="n">Thread</span> <span class="nl">Finished:</span> <span class="mi">9</span> <span class="o">:</span> <span class="n">Tue</span> <span class="n">Mar</span> <span class="mi">21</span> <span class="mi">14</span><span class="o">:</span><span class="mi">30</span><span class="o">:</span><span class="mi">37</span> <span class="n">CST</span> <span class="mi">2017</span>
<span class="n">Thread</span> <span class="nl">Finished:</span> <span class="mi">10</span> <span class="o">:</span> <span class="n">Tue</span> <span class="n">Mar</span> <span class="mi">21</span> <span class="mi">14</span><span class="o">:</span><span class="mi">30</span><span class="o">:</span><span class="mi">37</span> <span class="n">CST</span> <span class="mi">2017</span>
<span class="n">Starting</span> <span class="nl">Thread:</span> <span class="mi">12</span> <span class="o">:</span> <span class="n">Tue</span> <span class="n">Mar</span> <span class="mi">21</span> <span class="mi">14</span><span class="o">:</span><span class="mi">30</span><span class="o">:</span><span class="mi">39</span> <span class="n">CST</span> <span class="mi">2017</span>
<span class="n">Thread</span> <span class="nl">Finished:</span> <span class="mi">11</span> <span class="o">:</span> <span class="n">Tue</span> <span class="n">Mar</span> <span class="mi">21</span> <span class="mi">14</span><span class="o">:</span><span class="mi">30</span><span class="o">:</span><span class="mi">39</span> <span class="n">CST</span> <span class="mi">2017</span>
<span class="n">Starting</span> <span class="nl">Thread:</span> <span class="mi">13</span> <span class="o">:</span> <span class="n">Tue</span> <span class="n">Mar</span> <span class="mi">21</span> <span class="mi">14</span><span class="o">:</span><span class="mi">30</span><span class="o">:</span><span class="mi">41</span> <span class="n">CST</span> <span class="mi">2017</span>
<span class="n">Starting</span> <span class="nl">Thread:</span> <span class="mi">14</span> <span class="o">:</span> <span class="n">Tue</span> <span class="n">Mar</span> <span class="mi">21</span> <span class="mi">14</span><span class="o">:</span><span class="mi">30</span><span class="o">:</span><span class="mi">43</span> <span class="n">CST</span> <span class="mi">2017</span>
<span class="n">Thread</span> <span class="nl">Finished:</span> <span class="mi">13</span> <span class="o">:</span> <span class="n">Tue</span> <span class="n">Mar</span> <span class="mi">21</span> <span class="mi">14</span><span class="o">:</span><span class="mi">30</span><span class="o">:</span><span class="mi">43</span> <span class="n">CST</span> <span class="mi">2017</span>
<span class="n">Starting</span> <span class="nl">Thread:</span> <span class="mi">15</span> <span class="o">:</span> <span class="n">Tue</span> <span class="n">Mar</span> <span class="mi">21</span> <span class="mi">14</span><span class="o">:</span><span class="mi">30</span><span class="o">:</span><span class="mi">45</span> <span class="n">CST</span> <span class="mi">2017</span>
<span class="n">Thread</span> <span class="nl">Finished:</span> <span class="mi">14</span> <span class="o">:</span> <span class="n">Tue</span> <span class="n">Mar</span> <span class="mi">21</span> <span class="mi">14</span><span class="o">:</span><span class="mi">30</span><span class="o">:</span><span class="mi">45</span> <span class="n">CST</span> <span class="mi">2017</span>
<span class="n">Starting</span> <span class="nl">Thread:</span> <span class="mi">16</span> <span class="o">:</span> <span class="n">Tue</span> <span class="n">Mar</span> <span class="mi">21</span> <span class="mi">14</span><span class="o">:</span><span class="mi">30</span><span class="o">:</span><span class="mi">47</span> <span class="n">CST</span> <span class="mi">2017</span>
<span class="n">Thread</span> <span class="nl">Finished:</span> <span class="mi">12</span> <span class="o">:</span> <span class="n">Tue</span> <span class="n">Mar</span> <span class="mi">21</span> <span class="mi">14</span><span class="o">:</span><span class="mi">30</span><span class="o">:</span><span class="mi">47</span> <span class="n">CST</span> <span class="mi">2017</span>
<span class="n">Starting</span> <span class="nl">Thread:</span> <span class="mi">17</span> <span class="o">:</span> <span class="n">Tue</span> <span class="n">Mar</span> <span class="mi">21</span> <span class="mi">14</span><span class="o">:</span><span class="mi">30</span><span class="o">:</span><span class="mi">49</span> <span class="n">CST</span> <span class="mi">2017</span>
<span class="n">Thread</span> <span class="nl">Finished:</span> <span class="mi">17</span> <span class="o">:</span> <span class="n">Tue</span> <span class="n">Mar</span> <span class="mi">21</span> <span class="mi">14</span><span class="o">:</span><span class="mi">30</span><span class="o">:</span><span class="mi">49</span> <span class="n">CST</span> <span class="mi">2017</span>
<span class="n">Thread</span> <span class="nl">Finished:</span> <span class="mi">15</span> <span class="o">:</span> <span class="n">Tue</span> <span class="n">Mar</span> <span class="mi">21</span> <span class="mi">14</span><span class="o">:</span><span class="mi">30</span><span class="o">:</span><span class="mi">49</span> <span class="n">CST</span> <span class="mi">2017</span>
<span class="n">Thread</span> <span class="nl">Finished:</span> <span class="mi">16</span> <span class="o">:</span> <span class="n">Tue</span> <span class="n">Mar</span> <span class="mi">21</span> <span class="mi">14</span><span class="o">:</span><span class="mi">30</span><span class="o">:</span><span class="mi">49</span> <span class="n">CST</span> <span class="mi">2017</span>

<span class="c1">//使用SafeTask执行结果</span>
<span class="n">Starting</span> <span class="nl">Thread:</span> <span class="mi">8</span> <span class="o">:</span> <span class="n">Tue</span> <span class="n">Mar</span> <span class="mi">21</span> <span class="mi">15</span><span class="o">:</span><span class="mi">11</span><span class="o">:</span><span class="mi">10</span> <span class="n">CST</span> <span class="mi">2017</span>
<span class="n">Starting</span> <span class="nl">Thread:</span> <span class="mi">9</span> <span class="o">:</span> <span class="n">Tue</span> <span class="n">Mar</span> <span class="mi">21</span> <span class="mi">15</span><span class="o">:</span><span class="mi">11</span><span class="o">:</span><span class="mi">12</span> <span class="n">CST</span> <span class="mi">2017</span>
<span class="n">Thread</span> <span class="nl">Finished:</span> <span class="mi">9</span> <span class="o">:</span> <span class="n">Tue</span> <span class="n">Mar</span> <span class="mi">21</span> <span class="mi">15</span><span class="o">:</span><span class="mi">11</span><span class="o">:</span><span class="mi">12</span> <span class="n">CST</span> <span class="mi">2017</span>
<span class="n">Starting</span> <span class="nl">Thread:</span> <span class="mi">10</span> <span class="o">:</span> <span class="n">Tue</span> <span class="n">Mar</span> <span class="mi">21</span> <span class="mi">15</span><span class="o">:</span><span class="mi">11</span><span class="o">:</span><span class="mi">14</span> <span class="n">CST</span> <span class="mi">2017</span>
<span class="n">Starting</span> <span class="nl">Thread:</span> <span class="mi">11</span> <span class="o">:</span> <span class="n">Tue</span> <span class="n">Mar</span> <span class="mi">21</span> <span class="mi">15</span><span class="o">:</span><span class="mi">11</span><span class="o">:</span><span class="mi">16</span> <span class="n">CST</span> <span class="mi">2017</span>
<span class="n">Thread</span> <span class="nl">Finished:</span> <span class="mi">11</span> <span class="o">:</span> <span class="n">Tue</span> <span class="n">Mar</span> <span class="mi">21</span> <span class="mi">15</span><span class="o">:</span><span class="mi">11</span><span class="o">:</span><span class="mi">16</span> <span class="n">CST</span> <span class="mi">2017</span>
<span class="n">Starting</span> <span class="nl">Thread:</span> <span class="mi">12</span> <span class="o">:</span> <span class="n">Tue</span> <span class="n">Mar</span> <span class="mi">21</span> <span class="mi">15</span><span class="o">:</span><span class="mi">11</span><span class="o">:</span><span class="mi">18</span> <span class="n">CST</span> <span class="mi">2017</span>
<span class="n">Thread</span> <span class="nl">Finished:</span> <span class="mi">10</span> <span class="o">:</span> <span class="n">Tue</span> <span class="n">Mar</span> <span class="mi">21</span> <span class="mi">15</span><span class="o">:</span><span class="mi">11</span><span class="o">:</span><span class="mi">14</span> <span class="n">CST</span> <span class="mi">2017</span>
<span class="n">Thread</span> <span class="nl">Finished:</span> <span class="mi">12</span> <span class="o">:</span> <span class="n">Tue</span> <span class="n">Mar</span> <span class="mi">21</span> <span class="mi">15</span><span class="o">:</span><span class="mi">11</span><span class="o">:</span><span class="mi">18</span> <span class="n">CST</span> <span class="mi">2017</span>
<span class="n">Thread</span> <span class="nl">Finished:</span> <span class="mi">8</span> <span class="o">:</span> <span class="n">Tue</span> <span class="n">Mar</span> <span class="mi">21</span> <span class="mi">15</span><span class="o">:</span><span class="mi">11</span><span class="o">:</span><span class="mi">10</span> <span class="n">CST</span> <span class="mi">2017</span>
<span class="n">Starting</span> <span class="nl">Thread:</span> <span class="mi">13</span> <span class="o">:</span> <span class="n">Tue</span> <span class="n">Mar</span> <span class="mi">21</span> <span class="mi">15</span><span class="o">:</span><span class="mi">11</span><span class="o">:</span><span class="mi">20</span> <span class="n">CST</span> <span class="mi">2017</span>
<span class="n">Starting</span> <span class="nl">Thread:</span> <span class="mi">14</span> <span class="o">:</span> <span class="n">Tue</span> <span class="n">Mar</span> <span class="mi">21</span> <span class="mi">15</span><span class="o">:</span><span class="mi">11</span><span class="o">:</span><span class="mi">22</span> <span class="n">CST</span> <span class="mi">2017</span>
<span class="n">Thread</span> <span class="nl">Finished:</span> <span class="mi">13</span> <span class="o">:</span> <span class="n">Tue</span> <span class="n">Mar</span> <span class="mi">21</span> <span class="mi">15</span><span class="o">:</span><span class="mi">11</span><span class="o">:</span><span class="mi">20</span> <span class="n">CST</span> <span class="mi">2017</span>
<span class="n">Starting</span> <span class="nl">Thread:</span> <span class="mi">15</span> <span class="o">:</span> <span class="n">Tue</span> <span class="n">Mar</span> <span class="mi">21</span> <span class="mi">15</span><span class="o">:</span><span class="mi">11</span><span class="o">:</span><span class="mi">24</span> <span class="n">CST</span> <span class="mi">2017</span>
<span class="n">Starting</span> <span class="nl">Thread:</span> <span class="mi">16</span> <span class="o">:</span> <span class="n">Tue</span> <span class="n">Mar</span> <span class="mi">21</span> <span class="mi">15</span><span class="o">:</span><span class="mi">11</span><span class="o">:</span><span class="mi">26</span> <span class="n">CST</span> <span class="mi">2017</span>
<span class="n">Thread</span> <span class="nl">Finished:</span> <span class="mi">15</span> <span class="o">:</span> <span class="n">Tue</span> <span class="n">Mar</span> <span class="mi">21</span> <span class="mi">15</span><span class="o">:</span><span class="mi">11</span><span class="o">:</span><span class="mi">24</span> <span class="n">CST</span> <span class="mi">2017</span>
<span class="n">Starting</span> <span class="nl">Thread:</span> <span class="mi">17</span> <span class="o">:</span> <span class="n">Tue</span> <span class="n">Mar</span> <span class="mi">21</span> <span class="mi">15</span><span class="o">:</span><span class="mi">11</span><span class="o">:</span><span class="mi">28</span> <span class="n">CST</span> <span class="mi">2017</span>
<span class="n">Thread</span> <span class="nl">Finished:</span> <span class="mi">14</span> <span class="o">:</span> <span class="n">Tue</span> <span class="n">Mar</span> <span class="mi">21</span> <span class="mi">15</span><span class="o">:</span><span class="mi">11</span><span class="o">:</span><span class="mi">22</span> <span class="n">CST</span> <span class="mi">2017</span>
<span class="n">Thread</span> <span class="nl">Finished:</span> <span class="mi">17</span> <span class="o">:</span> <span class="n">Tue</span> <span class="n">Mar</span> <span class="mi">21</span> <span class="mi">15</span><span class="o">:</span><span class="mi">11</span><span class="o">:</span><span class="mi">28</span> <span class="n">CST</span> <span class="mi">2017</span>
<span class="n">Thread</span> <span class="nl">Finished:</span> <span class="mi">16</span> <span class="o">:</span> <span class="n">Tue</span> <span class="n">Mar</span> <span class="mi">21</span> <span class="mi">15</span><span class="o">:</span><span class="mi">11</span><span class="o">:</span><span class="mi">26</span> <span class="n">CST</span> <span class="mi">2017</span>
</code></pre>
</div>
<p><br /><br /></p>

<h3 id="线程工厂">线程工厂</h3>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">threadtest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.ThreadFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.TimeUnit</span><span class="o">;</span>
<span class="cm">/**
 * 线程工厂
 * @author zhangqingli
 *
 */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyThreadFactory09</span> <span class="kd">implements</span> <span class="n">ThreadFactory</span> <span class="o">{</span>
	<span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
	<span class="kd">private</span> <span class="kt">int</span> <span class="n">threadNum</span><span class="o">;</span>
	<span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">status</span><span class="o">;</span>
	
	<span class="kd">public</span> <span class="nf">MyThreadFactory09</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
		<span class="k">this</span><span class="o">.</span><span class="na">threadNum</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
		<span class="n">status</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;();</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="n">Thread</span> <span class="nf">newThread</span><span class="o">(</span><span class="n">Runnable</span> <span class="n">r</span><span class="o">)</span> <span class="o">{</span>
		<span class="n">Thread</span> <span class="n">t</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Thread</span><span class="o">(</span><span class="n">r</span><span class="o">,</span> <span class="n">name</span><span class="o">+</span><span class="s">"-Thread-"</span><span class="o">+</span><span class="n">threadNum</span><span class="o">);</span>
		<span class="n">threadNum</span><span class="o">++;</span>
		<span class="n">status</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"created thread %d with name %s on %s\n"</span><span class="o">,</span>
				<span class="n">t</span><span class="o">.</span><span class="na">getId</span><span class="o">(),</span><span class="n">t</span><span class="o">.</span><span class="na">getName</span><span class="o">(),</span><span class="k">new</span> <span class="n">Date</span><span class="o">()));</span>
		<span class="k">return</span> <span class="n">t</span><span class="o">;</span>
	<span class="o">}</span>
	
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">getStatus</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">status</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
	<span class="o">}</span>
	
	
	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
		<span class="n">MyThreadFactory09</span> <span class="n">tf</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MyThreadFactory09</span><span class="o">(</span><span class="s">"MyThreadFactory"</span><span class="o">);</span>
		<span class="n">MyTask</span> <span class="n">task</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MyTask</span><span class="o">();</span>
		<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Starting the Threads\n"</span><span class="o">);</span>
		<span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
			<span class="n">tf</span><span class="o">.</span><span class="na">newThread</span><span class="o">(</span><span class="n">task</span><span class="o">).</span><span class="na">start</span><span class="o">();</span>
		<span class="o">}</span>
		
		<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"Factory stats:\n"</span><span class="o">);</span> 
		<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"%s\n"</span><span class="o">,</span><span class="n">tf</span><span class="o">.</span><span class="na">getStatus</span><span class="o">());</span>
	<span class="o">}</span>
<span class="o">}</span>


<span class="kd">class</span> <span class="nc">MyTask</span> <span class="kd">implements</span> <span class="n">Runnable</span> <span class="o">{</span>
	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">try</span> <span class="o">{</span>
			<span class="n">TimeUnit</span><span class="o">.</span><span class="na">SECONDS</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
		<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
			<span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
		<span class="o">}</span>
	<span class="o">}</span>
	
<span class="o">}</span>


<span class="c1">//执行结果</span>
<span class="n">Starting</span> <span class="n">the</span> <span class="n">Threads</span>

<span class="n">Factory</span> <span class="nl">stats:</span>
<span class="o">[</span><span class="n">created</span> <span class="n">thread</span> <span class="mi">8</span> <span class="n">with</span> <span class="n">name</span> <span class="n">MyThreadFactory</span><span class="o">-</span><span class="n">Thread</span><span class="o">-</span><span class="mi">0</span> <span class="n">on</span> <span class="n">Tue</span> <span class="n">Mar</span> <span class="mi">21</span> <span class="mi">15</span><span class="o">:</span><span class="mi">16</span><span class="o">:</span><span class="mi">41</span> <span class="n">CST</span> <span class="mi">2017</span>
<span class="o">,</span> <span class="n">created</span> <span class="n">thread</span> <span class="mi">9</span> <span class="n">with</span> <span class="n">name</span> <span class="n">MyThreadFactory</span><span class="o">-</span><span class="n">Thread</span><span class="o">-</span><span class="mi">1</span> <span class="n">on</span> <span class="n">Tue</span> <span class="n">Mar</span> <span class="mi">21</span> <span class="mi">15</span><span class="o">:</span><span class="mi">16</span><span class="o">:</span><span class="mi">41</span> <span class="n">CST</span> <span class="mi">2017</span>
<span class="o">,</span> <span class="n">created</span> <span class="n">thread</span> <span class="mi">10</span> <span class="n">with</span> <span class="n">name</span> <span class="n">MyThreadFactory</span><span class="o">-</span><span class="n">Thread</span><span class="o">-</span><span class="mi">2</span> <span class="n">on</span> <span class="n">Tue</span> <span class="n">Mar</span> <span class="mi">21</span> <span class="mi">15</span><span class="o">:</span><span class="mi">16</span><span class="o">:</span><span class="mi">41</span> <span class="n">CST</span> <span class="mi">2017</span>
<span class="o">,</span> <span class="n">created</span> <span class="n">thread</span> <span class="mi">11</span> <span class="n">with</span> <span class="n">name</span> <span class="n">MyThreadFactory</span><span class="o">-</span><span class="n">Thread</span><span class="o">-</span><span class="mi">3</span> <span class="n">on</span> <span class="n">Tue</span> <span class="n">Mar</span> <span class="mi">21</span> <span class="mi">15</span><span class="o">:</span><span class="mi">16</span><span class="o">:</span><span class="mi">41</span> <span class="n">CST</span> <span class="mi">2017</span>
<span class="o">,</span> <span class="n">created</span> <span class="n">thread</span> <span class="mi">12</span> <span class="n">with</span> <span class="n">name</span> <span class="n">MyThreadFactory</span><span class="o">-</span><span class="n">Thread</span><span class="o">-</span><span class="mi">4</span> <span class="n">on</span> <span class="n">Tue</span> <span class="n">Mar</span> <span class="mi">21</span> <span class="mi">15</span><span class="o">:</span><span class="mi">16</span><span class="o">:</span><span class="mi">41</span> <span class="n">CST</span> <span class="mi">2017</span>
<span class="o">,</span> <span class="n">created</span> <span class="n">thread</span> <span class="mi">13</span> <span class="n">with</span> <span class="n">name</span> <span class="n">MyThreadFactory</span><span class="o">-</span><span class="n">Thread</span><span class="o">-</span><span class="mi">5</span> <span class="n">on</span> <span class="n">Tue</span> <span class="n">Mar</span> <span class="mi">21</span> <span class="mi">15</span><span class="o">:</span><span class="mi">16</span><span class="o">:</span><span class="mi">41</span> <span class="n">CST</span> <span class="mi">2017</span>
<span class="o">,</span> <span class="n">created</span> <span class="n">thread</span> <span class="mi">14</span> <span class="n">with</span> <span class="n">name</span> <span class="n">MyThreadFactory</span><span class="o">-</span><span class="n">Thread</span><span class="o">-</span><span class="mi">6</span> <span class="n">on</span> <span class="n">Tue</span> <span class="n">Mar</span> <span class="mi">21</span> <span class="mi">15</span><span class="o">:</span><span class="mi">16</span><span class="o">:</span><span class="mi">41</span> <span class="n">CST</span> <span class="mi">2017</span>
<span class="o">,</span> <span class="n">created</span> <span class="n">thread</span> <span class="mi">15</span> <span class="n">with</span> <span class="n">name</span> <span class="n">MyThreadFactory</span><span class="o">-</span><span class="n">Thread</span><span class="o">-</span><span class="mi">7</span> <span class="n">on</span> <span class="n">Tue</span> <span class="n">Mar</span> <span class="mi">21</span> <span class="mi">15</span><span class="o">:</span><span class="mi">16</span><span class="o">:</span><span class="mi">41</span> <span class="n">CST</span> <span class="mi">2017</span>
<span class="o">,</span> <span class="n">created</span> <span class="n">thread</span> <span class="mi">16</span> <span class="n">with</span> <span class="n">name</span> <span class="n">MyThreadFactory</span><span class="o">-</span><span class="n">Thread</span><span class="o">-</span><span class="mi">8</span> <span class="n">on</span> <span class="n">Tue</span> <span class="n">Mar</span> <span class="mi">21</span> <span class="mi">15</span><span class="o">:</span><span class="mi">16</span><span class="o">:</span><span class="mi">41</span> <span class="n">CST</span> <span class="mi">2017</span>
<span class="o">,</span> <span class="n">created</span> <span class="n">thread</span> <span class="mi">17</span> <span class="n">with</span> <span class="n">name</span> <span class="n">MyThreadFactory</span><span class="o">-</span><span class="n">Thread</span><span class="o">-</span><span class="mi">9</span> <span class="n">on</span> <span class="n">Tue</span> <span class="n">Mar</span> <span class="mi">21</span> <span class="mi">15</span><span class="o">:</span><span class="mi">16</span><span class="o">:</span><span class="mi">41</span> <span class="n">CST</span> <span class="mi">2017</span>
<span class="o">]</span>
</code></pre>
</div>
<p><br /><br /></p>

<h3 id="安全共享数居安全同步数据">安全共享数居（安全同步数据）</h3>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">threadtest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Random</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.TimeUnit</span><span class="o">;</span>
<span class="cm">/**
 * 安全共享数居（安全同步数据）
 * 只有操作公共资源的原子操作，才是需要加锁的，如果不是就没有加锁的必要。
 */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SynchronizedTest10</span> <span class="kd">implements</span> <span class="n">Runnable</span> <span class="o">{</span>
	<span class="kd">private</span> <span class="kt">int</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">10</span><span class="o">;</span>
	
	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">while</span> <span class="o">(</span><span class="n">count</span><span class="o">&gt;</span><span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
			<span class="c1">//一个原子操作</span>
			<span class="kd">synchronized</span> <span class="o">(</span><span class="n">SynchronizedTest10</span><span class="o">.</span><span class="na">class</span><span class="o">)</span> <span class="o">{</span>
				<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getName</span><span class="o">()</span> <span class="o">+</span> <span class="s">": "</span> <span class="o">+</span> <span class="n">count</span><span class="o">);</span>
				<span class="n">count</span><span class="o">--;</span>
			<span class="o">}</span>
			
			<span class="k">try</span> <span class="o">{</span>
				<span class="n">TimeUnit</span><span class="o">.</span><span class="na">SECONDS</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="k">new</span> <span class="n">Random</span><span class="o">().</span><span class="na">nextInt</span><span class="o">(</span><span class="mi">3</span><span class="o">));</span>
			<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
				<span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
			<span class="o">}</span>
		<span class="o">}</span>
	<span class="o">}</span>
	
	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
		<span class="n">SynchronizedTest10</span> <span class="n">s</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SynchronizedTest10</span><span class="o">();</span>
		
		<span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
			<span class="k">new</span> <span class="nf">Thread</span><span class="o">(</span><span class="n">s</span><span class="o">).</span><span class="na">start</span><span class="o">();</span>
		<span class="o">}</span>
	<span class="o">}</span>
<span class="o">}</span>


<span class="c1">//加锁执行结果：</span>
<span class="n">Thread</span><span class="o">-</span><span class="mi">0</span><span class="o">:</span> <span class="mi">10</span>
<span class="n">Thread</span><span class="o">-</span><span class="mi">2</span><span class="o">:</span> <span class="mi">9</span>
<span class="n">Thread</span><span class="o">-</span><span class="mi">1</span><span class="o">:</span> <span class="mi">8</span>
<span class="n">Thread</span><span class="o">-</span><span class="mi">1</span><span class="o">:</span> <span class="mi">7</span>
<span class="n">Thread</span><span class="o">-</span><span class="mi">1</span><span class="o">:</span> <span class="mi">6</span>
<span class="n">Thread</span><span class="o">-</span><span class="mi">0</span><span class="o">:</span> <span class="mi">5</span>
<span class="n">Thread</span><span class="o">-</span><span class="mi">2</span><span class="o">:</span> <span class="mi">4</span>
<span class="n">Thread</span><span class="o">-</span><span class="mi">1</span><span class="o">:</span> <span class="mi">3</span>
<span class="n">Thread</span><span class="o">-</span><span class="mi">2</span><span class="o">:</span> <span class="mi">2</span>
<span class="n">Thread</span><span class="o">-</span><span class="mi">0</span><span class="o">:</span> <span class="mi">1</span>

<span class="c1">//不加锁执行结果：</span>
<span class="n">Thread</span><span class="o">-</span><span class="mi">0</span><span class="o">:</span> <span class="mi">10</span>
<span class="n">Thread</span><span class="o">-</span><span class="mi">2</span><span class="o">:</span> <span class="mi">10</span>
<span class="n">Thread</span><span class="o">-</span><span class="mi">1</span><span class="o">:</span> <span class="mi">10</span>
<span class="n">Thread</span><span class="o">-</span><span class="mi">0</span><span class="o">:</span> <span class="mi">7</span>
<span class="n">Thread</span><span class="o">-</span><span class="mi">0</span><span class="o">:</span> <span class="mi">6</span>
<span class="n">Thread</span><span class="o">-</span><span class="mi">2</span><span class="o">:</span> <span class="mi">5</span>
<span class="n">Thread</span><span class="o">-</span><span class="mi">1</span><span class="o">:</span> <span class="mi">5</span>
<span class="n">Thread</span><span class="o">-</span><span class="mi">1</span><span class="o">:</span> <span class="mi">3</span>
<span class="n">Thread</span><span class="o">-</span><span class="mi">0</span><span class="o">:</span> <span class="mi">2</span>
<span class="n">Thread</span><span class="o">-</span><span class="mi">2</span><span class="o">:</span> <span class="mi">1</span>
</code></pre>
</div>
<p><br /><br /></p>

<h3 id="多个对象多个锁">多个对象多个锁</h3>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">threadtest</span><span class="o">;</span>
<span class="cm">/**
 * 多个对象多个锁
 */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SynchronizedTest11</span> <span class="o">{</span>
	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
		<span class="cm">/*
		LoginServlet loginServlet = new LoginServlet();
		new Thread(new LoginTask(loginServlet, "a")).start();
		new Thread(new LoginTask(loginServlet, "b")).start();
		//执行结果
		login success!
		username: a
		login fail!
		username: b
		*/</span>
		
		<span class="n">LoginServlet</span> <span class="n">loginServlet01</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LoginServlet</span><span class="o">();</span>
		<span class="n">LoginServlet</span> <span class="n">loginServlet02</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LoginServlet</span><span class="o">();</span>
		<span class="k">new</span> <span class="nf">Thread</span><span class="o">(</span><span class="k">new</span> <span class="n">LoginTask</span><span class="o">(</span><span class="n">loginServlet01</span><span class="o">,</span> <span class="s">"a"</span><span class="o">)).</span><span class="na">start</span><span class="o">();</span>
		<span class="k">new</span> <span class="nf">Thread</span><span class="o">(</span><span class="k">new</span> <span class="n">LoginTask</span><span class="o">(</span><span class="n">loginServlet02</span><span class="o">,</span> <span class="s">"b"</span><span class="o">)).</span><span class="na">start</span><span class="o">();</span>
		<span class="c1">//执行结果</span>
		<span class="c1">//login success!</span>
		<span class="c1">//login fail!</span>
		<span class="c1">//username: b</span>
		<span class="c1">//username: a</span>
		<span class="c1">//[分析]</span>
		<span class="c1">//两个线程分别访问同一个类的两个不同实例的相同名称的同步方法，效果是以异步方式执行的。</span>
		<span class="c1">//本类由于是创建了两个业务对象，在系统中产生了两个锁，所以运行的结果是异步的。</span>
		<span class="c1">//[注]</span>
		<span class="c1">//如果把loginServlet的login方法改成synchronized static类型的，那么这个方法的锁</span>
		<span class="c1">//类型就是类对象LoginServlet.class，由于它在JVM中只有一份，因此在该例中执行的效果</span>
		<span class="c1">//仍是同步的。</span>
	<span class="o">}</span>
<span class="o">}</span>


<span class="kd">class</span> <span class="nc">LoginTask</span> <span class="kd">implements</span> <span class="n">Runnable</span> <span class="o">{</span>
	<span class="kd">private</span> <span class="n">LoginServlet</span> <span class="n">loginServlet</span><span class="o">;</span>
	<span class="kd">private</span> <span class="n">String</span> <span class="n">username</span><span class="o">;</span>
	
	<span class="kd">public</span> <span class="nf">LoginTask</span><span class="o">(</span><span class="n">LoginServlet</span> <span class="n">loginServlet</span><span class="o">,</span> <span class="n">String</span> <span class="n">username</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">loginServlet</span> <span class="o">=</span> <span class="n">loginServlet</span><span class="o">;</span>
		<span class="k">this</span><span class="o">.</span><span class="na">username</span> <span class="o">=</span> <span class="n">username</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
		<span class="n">loginServlet</span><span class="o">.</span><span class="na">login</span><span class="o">(</span><span class="n">username</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">LoginServlet</span> <span class="o">{</span>
	<span class="kd">public</span> <span class="kd">synchronized</span> <span class="kt">void</span> <span class="nf">login</span><span class="o">(</span><span class="n">String</span> <span class="n">username</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">try</span> <span class="o">{</span>
			<span class="k">if</span> <span class="o">(</span><span class="s">"a"</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">username</span><span class="o">))</span> <span class="o">{</span>
				<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"login success!"</span><span class="o">);</span>
				<span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">2000</span><span class="o">);</span>
			<span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
				<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"login fail!"</span><span class="o">);</span>
			<span class="o">}</span>
			<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"username: "</span> <span class="o">+</span> <span class="n">username</span><span class="o">);</span>
		<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
			<span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
		<span class="o">}</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>
<p><br /><br /></p>

<h3 id="可重入锁">可重入锁</h3>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">threadtest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.TimeUnit</span><span class="o">;</span>
<span class="cm">/**
 * 可重入锁
 * 可重入锁的概念是：自己可以再次获取自己的内部锁，比如线程A获得了某个对象锁，此时
 * 它的这个对象锁还没有释放，当它再次想获取这个对象锁的时候是可以获取的。
 * 
 * 父子可重入锁
 * 当存在父子类继承关系时，子类完全可以通过可重入锁调用父类的同步方法。
 * 下面的就是一个父子可重入锁的演示。
 *
 */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SynchronizedTest12</span> <span class="o">{</span>
	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
		<span class="n">B</span> <span class="n">b</span> <span class="o">=</span> <span class="k">new</span> <span class="n">B</span><span class="o">();</span>
		<span class="k">new</span> <span class="nf">Thread</span><span class="o">(</span><span class="k">new</span> <span class="n">MyThread</span><span class="o">(</span><span class="n">b</span><span class="o">)).</span><span class="na">start</span><span class="o">();</span>
		<span class="k">new</span> <span class="nf">Thread</span><span class="o">(</span><span class="k">new</span> <span class="n">MyThread</span><span class="o">(</span><span class="n">b</span><span class="o">)).</span><span class="na">start</span><span class="o">();</span>
		<span class="c1">//执行结果</span>
		<span class="c1">//Thread: 8: b.bbb</span>
		<span class="c1">//Thread: 8: a.aaa</span>
		<span class="c1">//Thread: 9: b.bbb</span>
		<span class="c1">//Thread: 9: a.aaa</span>
	<span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">A</span> <span class="o">{</span>
	<span class="kd">public</span> <span class="kd">synchronized</span> <span class="kt">void</span> <span class="nf">aaa</span><span class="o">()</span> <span class="o">{</span>
		<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Thread: "</span> <span class="o">+</span> <span class="n">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getId</span><span class="o">()</span> <span class="o">+</span> <span class="s">": a.aaa"</span><span class="o">);</span>
		<span class="k">try</span> <span class="o">{</span>
			<span class="n">TimeUnit</span><span class="o">.</span><span class="na">SECONDS</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
		<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
			<span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
		<span class="o">}</span>
	<span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">B</span> <span class="kd">extends</span> <span class="n">A</span> <span class="o">{</span>
	<span class="kd">public</span> <span class="kd">synchronized</span> <span class="kt">void</span> <span class="nf">bbb</span><span class="o">()</span> <span class="o">{</span>
		<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Thread: "</span> <span class="o">+</span> <span class="n">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getId</span><span class="o">()</span> <span class="o">+</span> <span class="s">": b.bbb"</span><span class="o">);</span>
		<span class="k">try</span> <span class="o">{</span>
			<span class="n">TimeUnit</span><span class="o">.</span><span class="na">SECONDS</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
		<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
			<span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
		<span class="o">}</span>
		<span class="kd">super</span><span class="o">.</span><span class="na">aaa</span><span class="o">();</span>
	<span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">MyThread</span> <span class="kd">implements</span> <span class="n">Runnable</span> <span class="o">{</span>
	<span class="kd">private</span> <span class="n">B</span> <span class="n">b</span><span class="o">;</span>
	
	<span class="kd">public</span> <span class="nf">MyThread</span><span class="o">(</span><span class="n">B</span> <span class="n">b</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">b</span> <span class="o">=</span> <span class="n">b</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
		<span class="n">b</span><span class="o">.</span><span class="na">bbb</span><span class="o">();</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>
<p><br /><br /></p>

<h3 id="volatile关键字">volatile关键字</h3>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">threadtest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.TimeUnit</span><span class="o">;</span>
<span class="cm">/**
 * 1. volatile关键字解决的是数据在多个线程之间的可见性（不保证被操作数据的原子一致性），
 *    而synchronized关键字解决的是操作的原子性，而且synchronized除了保证数据操作的
 *    原子性，也将线程工作内存中的私有变量与主内存中的公共变量同步。
 * 
 * 2. 主内存（=物理内存），线程工作内存（=CPU高速缓存）
 * 	  被volatile修饰的变量保证了数据在多个不同线程之间的同步性，原理如下：
 * 	  volatile修饰符使被它修饰的变量对应的CPU高速缓存区（L1、L2）失效，
 * 	  当volatile变量在线程A中被修改后，线程A会将其工作内存中的被修改
 *    后的volatile变量写入主内存中，然后发送信号通知其他线程从主内存中
 *    同步最新的值到工作内存，这样就保证了线程间变量数据的可见性。
 *    
 */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">VolatileTest13</span> <span class="o">{</span>
	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
		<span class="n">MyTask02</span> <span class="n">task</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MyTask02</span><span class="o">();</span>
		<span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
			<span class="k">new</span> <span class="nf">Thread</span><span class="o">(</span><span class="n">task</span><span class="o">).</span><span class="na">start</span><span class="o">();</span>
		<span class="o">}</span>
		<span class="c1">//</span>
		<span class="k">try</span> <span class="o">{</span>
			<span class="n">TimeUnit</span><span class="o">.</span><span class="na">SECONDS</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">5</span><span class="o">);</span>
		<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
			<span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
		<span class="o">}</span>
		<span class="c1">//</span>
		<span class="n">task</span><span class="o">.</span><span class="na">setInterrupted</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">MyTask02</span> <span class="kd">implements</span> <span class="n">Runnable</span> <span class="o">{</span>
	<span class="kd">private</span> <span class="kd">volatile</span> <span class="kt">boolean</span> <span class="n">isInterrupted</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
	
	<span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isInterrupted</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">isInterrupted</span><span class="o">;</span>
	<span class="o">}</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setInterrupted</span><span class="o">(</span><span class="kt">boolean</span> <span class="n">isInterrupted</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">isInterrupted</span> <span class="o">=</span> <span class="n">isInterrupted</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
			<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Thread: "</span> <span class="o">+</span> <span class="n">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getId</span><span class="o">()</span> <span class="o">+</span> <span class="s">" running!"</span><span class="o">);</span>
			<span class="k">if</span> <span class="o">(</span><span class="n">isInterrupted</span><span class="o">)</span> <span class="o">{</span>
				<span class="k">break</span><span class="o">;</span>
			<span class="o">}</span>
		<span class="o">}</span>
		<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Thread: "</span> <span class="o">+</span> <span class="n">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getId</span><span class="o">()</span> <span class="o">+</span> <span class="s">" end!"</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>
<p><br /><br /></p>

<p>###</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">threadtest</span><span class="o">;</span>
<span class="cm">/**
 * 验证volatile不具有操作原子性
 *
 */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">VolatileTest14</span> <span class="o">{</span>
	
	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
	
		<span class="n">MyThread03</span> <span class="n">thread03</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MyThread03</span><span class="o">();</span>
		
		<span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
			<span class="k">new</span> <span class="nf">Thread</span><span class="o">(</span><span class="n">thread03</span><span class="o">).</span><span class="na">start</span><span class="o">();</span>
		<span class="o">}</span>
	<span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">MyThread03</span> <span class="kd">implements</span> <span class="n">Runnable</span> <span class="o">{</span>
	<span class="kd">public</span> <span class="kd">volatile</span> <span class="kt">int</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>

	<span class="kd">public</span> <span class="kd">synchronized</span> <span class="kt">void</span> <span class="nf">incr</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">try</span> <span class="o">{</span>
			<span class="n">count</span><span class="o">++;</span>
			<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getId</span><span class="o">()</span> <span class="o">+</span> <span class="s">": "</span> <span class="o">+</span> <span class="n">count</span><span class="o">);</span>
			<span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">1000</span><span class="o">);</span>
		<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
			<span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
		<span class="o">}</span>
	<span class="o">}</span>
	
	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
		<span class="n">incr</span><span class="o">();</span>
	<span class="o">}</span>
<span class="o">}</span>


<span class="c1">//加锁执行结果：</span>
<span class="mi">8</span><span class="o">:</span> <span class="mi">1</span>
<span class="mi">17</span><span class="o">:</span> <span class="mi">2</span>
<span class="mi">16</span><span class="o">:</span> <span class="mi">3</span>
<span class="mi">15</span><span class="o">:</span> <span class="mi">4</span>
<span class="mi">14</span><span class="o">:</span> <span class="mi">5</span>
<span class="mi">13</span><span class="o">:</span> <span class="mi">6</span>
<span class="mi">12</span><span class="o">:</span> <span class="mi">7</span>
<span class="mi">11</span><span class="o">:</span> <span class="mi">8</span>
<span class="mi">10</span><span class="o">:</span> <span class="mi">9</span>
<span class="mi">9</span><span class="o">:</span> <span class="mi">10</span>

<span class="c1">//不加锁执行结果：</span>
<span class="mi">9</span><span class="o">:</span> <span class="mi">2</span>
<span class="mi">12</span><span class="o">:</span> <span class="mi">5</span>
<span class="mi">13</span><span class="o">:</span> <span class="mi">6</span>
<span class="mi">11</span><span class="o">:</span> <span class="mi">4</span>
<span class="mi">10</span><span class="o">:</span> <span class="mi">3</span>
<span class="mi">8</span><span class="o">:</span> <span class="mi">2</span>
<span class="mi">14</span><span class="o">:</span> <span class="mi">7</span>
<span class="mi">15</span><span class="o">:</span> <span class="mi">8</span>
<span class="mi">16</span><span class="o">:</span> <span class="mi">9</span>
<span class="mi">17</span><span class="o">:</span> <span class="mi">10</span>
</code></pre>
</div>
<p><br /><br /></p>


                    <hr>
                    <div class="row">
                        <div class="col-md-6">
                                <h5 style="display: inline;">Tags:</h5>
                                
                                    <button class="btn btn-white btn-xs" type="button">java</button>
                                
                        </div>
                        
                        <!--
                        <div class="col-md-6">
                            <div class="small text-right">
                                <div>    
                                    <i class="fa fa-comments-o"> </i> 
                                    <span class="ds-comments">0</span>条评论
                                </div>
                                <div>
                                    <i class="fa fa-share-alt"> </i> 
                                    <span class="ds-shares">0</span>条转发
                                </div>  
                            </div>
                        </div>
                        -->
                    </div>
                    <br>
                    <div class="row">
                        <div class="col-lg-12">
                            <!-- donate -->
                            
                                <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#myModal2">
    Donate
</button>
<div class="modal inmodal" id="myModal2" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content animated flipInY">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title">Donate Me</h4>
                <small class="font-bold">Thanks for your support!</small>
            </div>
            <div class="modal-body">
                <div class="tabbable" id="tabs-960227">
                    <ul class="nav nav-tabs">
                        <li class="active">
                            <a href="#panel-405278" data-toggle="tab">Alipay</a>
                        </li>
                        <li>
                            <a href="#panel-874705" data-toggle="tab">Wechat</a>
                        </li>
                    </ul>
                    <div class="tab-content">
                        <div class="tab-pane active" id="panel-405278">
                            <div class="text-center">
                                <img src="/static/img/pay/alipay.png"" height="250" width="250">
                            </div>    
                        </div>
                        <div class="tab-pane" id="panel-874705">
                            <div class="text-center">
                                <img src="/static/img/pay/wechat.png"" height="250" width="250">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-white" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

                            
                            <br>
                            <!-- share -->
                            
                                
<!--分享-->
<div class="row" style="margin-top:30px;">
	<h2>Share:</h2>
    <div class="social-share" style="margin-left:-5px;"data-sites="wechat,qq,qzone,weibo"></div> 
</div>
<link rel="stylesheet" href="/static/css/share.min.css">
<script src="/static/js/jquery.share.min.js"></script>
<script src="/static/js/embed.js"></script>

<script>
  var url = 'http://localhost:4000/java/2012/11/17/java-thread-test.html';
  var source = 'http://localhost:4000/java/2012/11/17/java-thread-test.html';
  var title = 'java线程相关测试';
  var excerpt = $("p:eq(0)").text();
  
  var imageUrl = 'http://localhost:4000/static/img/landing/header_one.jpg';
  var imgEle = $(".content_img:eq(0)");
  if (imgEle) {
    imageUrl = imgEle.attr("src");
  }

  var $config = {
      url: url, // 网址，默认使用 window.location.href
      source: source, // 来源（QQ空间会用到）, 默认读取head标签：<meta name="site" content="http://overtrue" />
      title: title, // 标题，默认读取 document.title 或者 <meta name="title" content="share.js" />
      description: excerpt, // 描述, 默认读取head标签：<meta name="description" content="PHP弱类型的实现原理分析" />
      image: imageUrl, // 图片, 默认取网页中第一个img标签
      sites: ['qzone', 'qq', 'weibo','wechat','douban'], // 启用的站点
      //disabled: ['google', 'facebook', 'twitter'], // 禁用的站点
      wechatQrcodeTitle: "微信扫一扫：分享", // 微信二维码提示文字
      wechatQrcodeHelper: '<p style="font-size:10px;">微信里点“发现”，扫一下</p><p style="font-size:10px;">二维码便可将本文分享至朋友圈。</p>',
   };
  $('.social-share').share($config);
</script>




                            
                            <br>
                            <!-- comment -->
                            <!--



-->

<!-- 多说评论框 start -->
<div class="row" style="margin-top:25px;"></div>
<div class="ds-thread" data-thread-key="/java/2012/11/17/java-thread-test.html" data-title="java线程相关测试" data-url="http://localhost:4000/java/2012/11/17/java-thread-test.html"></div>
<!-- 多说评论框 end -->
<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
<script type="text/javascript">
	var duoshuoQuery = {short_name:"kinglyjn"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		 || document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
</script>
<!-- 多说公共JS代码 end -->



                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>

</div>



	
	    <script src="/static/js/scroll.js"></script>

<!-- Baidu analytics -->


<!-- Google analytics -->

  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-73784599-1', 'auto');
    ga('send', 'pageview');

  </script>


<!--

-->

<!--

-->

<script async src="/static/js/count_page.js"></script>

	

</body>
</html>