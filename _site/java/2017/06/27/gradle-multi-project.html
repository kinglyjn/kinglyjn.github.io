<!DOCTYPE html>
<html>
	
	    <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
    <meta content="Gradle构建多模块项目" name="description">
  
  
    <meta name="keywords" content="Gradle,kinglyjn">
  
  <meta name="author" content="KinglyJn">

  <title>
    
        KinglyJn|Gradle构建多模块项目
    
  </title>
  <!-- favicon -->
  <link rel="shortcut icon" href="static/img/favicon.ico">


  <!-- Third-party CSS -->
  <link href="/bower_components/normalize-css/normalize.min.css" rel="stylesheet">
  <link href="/bower_components/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="/bower_components/animate.css/animate.min.css" rel="stylesheet">
  <link href="/bower_components/components-font-awesome/css/font-awesome.min.css" rel="stylesheet">
  <link href="/static/font-mfizz/font-mfizz.css" rel="stylesheet">
  <!-- <link href="/bower_components/toastr/toastr.min.css" rel="stylesheet"> -->
  <link href="/bower_components/jquery.gritter/css/jquery.gritter.css" rel="stylesheet">
  <link rel="stylesheet" href="/search/css/cb-search.css">

  <!-- Custom styles for this template -->
  <link href="/static/css/style.min.css" rel="stylesheet">
  <link href="/static/css/pygments.css" rel="stylesheet">

  <!-- Scripts -->
  <script src="/bower_components/jquery/dist/jquery.min.js"></script>
  <script src="/search/js/bootstrap3-typeahead.min.js"></script>

  <!-- cb-search -->
  <script src="/search/js/cb-search.js"></script>
  <script>
    $(function(){
        $("pre").css('display','block');
    });
  </script>
  <!-- Mainly scripts -->
  <script src="/bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
  <script src="/bower_components/metisMenu/dist/metisMenu.min.js"></script>
  <script src="/bower_components/jquery-slimscroll/jquery.slimscroll.min.js"></script>

  <!-- Peity -->
  <script src="/bower_components/peity/jquery.peity.min.js"></script>

  <script src="/bower_components/PACE/pace.min.js"></script>
  <script src="/bower_components/wow/dist/wow.min.js"></script>
  <!-- Custom and plugin javascript -->
  <script src="/static/js/inspinia.js"></script>

  <!-- Rickshaw -->
  <script src="/bower_components/rickshaw/vendor/d3.v3.js"></script>
  <script src="/bower_components/rickshaw/rickshaw.min.js"></script>


  <!-- jPages -->
  <script src="/static/js/jPages.js"></script>
  <script src="/static/js/js.js"></script>
  <script type="text/javascript">
        $(function(){
          /* initiate the plugin */
          $("div.pag-holder").jPages({
              containerID  : "pag-itemContainer",
              perPage      : 10,  /* num of items per page */
              startPage    : 1,
              startRange   : 1,
              midRange     : 3,
              endRange     : 1
          });

          $("div.pag-jump button").click(function(){
            var page = parseInt($("div.pag-jump input").val());
            $("div.pag-holder").jPages(page);
          });

          $("div.pag-jump input").on("keypress", function(){
            var e=e||window.event;
            if (e.keyCode == 13) {
                var page = parseInt($("div.pag-jump input").val());
                $("div.pag-holder").jPages(page);
            } 
          });
      });
  </script>

<!-- GrowingIO -->

  <script>
    var _vds = _vds || [];
    window._vds = _vds;
    (function(){
      _vds.push(['setAccountId', 'a49d4901c7853da9']);
      (function() {
        var vds = document.createElement('script');
        vds.type='text/javascript';
        vds.async = true;
        vds.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'dn-growing.qbox.me/vds.js';
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(vds, s);
      })();
    })();
  </script>


</head>

	


<body id="page-top" class="landing-page">

	
	    

<!--修复手机端横轴方向左右滑动BUG-->
<style type="text/css">
    .landing-page .row {
        margin-left: 0px;
        margin-right: 0px;
    }
</style>

<div class="search-tool"
      style="position: fixed; top: 0px ; bottom: 0px; left: 0px; right:  0px; opacity: 0.95; background-color: #111111; z-index: 9999; display: none;">
    <input type="text" class="form-control search-content" id="search-content" style="position: fixed; top: 60px" placeholder="Search Blog">

    <div style="position: fixed; top: 16px; right: 16px; z-index: 9999;">
        <img src="/search/img/cb-close.png" id="close-btn"/>
    </div>
</div>

<div style="position: fixed; right: 16px; bottom: 20px; z-index: 9999;">
    <img src="/search/img/cb-search.png"  id="search-btn"  title="Double click Ctrl"/>
</div>

<div class="navbar-wrapper">
        <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
            <div class="container">
                <div class="navbar-header page-scroll">
                    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="/">KinglyJn</a>
                </div>
                <div id="navbar" class="navbar-collapse collapse">
                    <ul class="nav navbar-nav navbar-right">
                        <li><a class="page-scroll" href="/blog/"></a></li>
                        
                            
                            <li>
                            
                            <a class="page-scroll" href="/blog/">Blog</a></li>
                        
                            
                            <li>
                            
                            <a class="page-scroll" href="/linux/">Linux</a></li>
                        
                            
                            <li>
                            
                            <a class="page-scroll" href="/cloud/">Cloud</a></li>
                        
                            
                            <li>
                            
                            <a class="page-scroll" href="/java/">Java</a></li>
                        
                            
                            <li>
                            
                            <a class="page-scroll" href="/c/">C</a></li>
                        
                            
                            <li>
                            
                            <a class="page-scroll" href="/php/">PHP</a></li>
                        
                            
                            <li>
                            
                            <a class="page-scroll" href="/db/">DB</a></li>
                        
                            
                            <li>
                            
                            <a class="page-scroll" href="/htmlx/">HTMLX</a></li>
                        
                            
                            <li>
                            
                            <a class="page-scroll" href="/life/">Life</a></li>
                        
                            
                            <li>
                            
                            <a class="page-scroll" href="/art/">Art</a></li>
                        
                            
                            <li>
                            
                            <a class="page-scroll" href="/other/">Other</a></li>
                        
                    </ul>
                </div>
            </div>
        </nav>
</div>
<div id="inSlider" class="carousel carousel-fade" data-ride="carousel">
    <div style="position:absolute;float:left;left:25%;z-index:15;width:50%;margin-bottom:18%;bottom:0;text-align:center;list-style:none;">
        <span style="color:white;font-size:24px;">以平实之心写作</span><br>
        <span style="color:white;font-size:13px;">writing with simple heart ♬. </span>
    </div>
    <!--
    <ol class="carousel-indicators">
        <li data-target="#inSlider" data-slide-to="0" class="active"></li>
        <li data-target="#inSlider" data-slide-to="1"></li>
    </ol>
    -->
    <div class="carousel-inner" role="listbox">
        <div class="item active">
            <div class="container">
                <div class="carousel-caption">
                </div>
                <div class="carousel-image wow zoomIn">
                    <!-- <img src="static/img/landing/laptop.png" alt="laptop"/> -->
                </div>
            </div>
            <!-- Set background for slide in css -->
            <div class="header-back blog-one"></div>
        </div>
        <!--
        <div class="item">
            <div class="container">
                <div class="carousel-caption blank">
                </div>
            </div>
            Set background for slide in css
            <div class="header-back two"></div>
        </div>
        -->
    </div>
    <!--
    <a class="left carousel-control" href="#inSlider" role="button" data-slide="prev">
        <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
        <span class="sr-only">Previous</span>
    </a>
    <a class="right carousel-control" href="#inSlider" role="button" data-slide="next">
        <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
        <span class="sr-only">Next</span>
    </a>
    -->
</div>


	

    <div class="wrapper wrapper-content  animated fadeInRight article">
    <div class="row">
        <div class="col-lg-10 col-lg-offset-1">
            <div class="ibox">
                <div class="ibox-content">
                    <div class="pull-right">
                    	
                        	<button class="btn btn-white btn-xs" type="button">Java</button>
                        
                    </div>
                    <div class="text-center article-title" style="margin-bottom:50px;">
                        <h1>
                            Gradle构建多模块项目
                        </h1>
                        <a href="http://www.keyllo.com/studio/">
                            <span class="text-muted"><i class="fa fa-user"></i> KinglyJn</span>
                        </a>
                        &nbsp;&nbsp;&nbsp;&nbsp;
                        <span class="text-muted"><i class="fa fa-clock-o"></i> 2017-06-27</span>
                    </div>
                    	<h3 id="首先我们先来看一个简单的单模块项目构建示例">首先我们先来看一个简单的单模块项目构建示例</h3>

<blockquote>
  <p>zdemo-gradle-simple</p>
</blockquote>

<p><br /></p>

<p>settings.gradle</p>

<div class="language-groovy highlighter-rouge"><pre class="highlight"><code><span class="n">rootProject</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="s1">'zdemo-gradle-simple'</span>
</code></pre>
</div>

<p><br /></p>

<p>build.gradle</p>

<div class="language-groovy highlighter-rouge"><pre class="highlight"><code><span class="cm">/*
 * 预定义一些类
 * 类可以直接定义在构建脚本中
 * 更好的方式是构建脚本与构建类分开，gradle默认将构建类放在 build/src/main/groovy 
 * 目录下，然后将编写的  *.groovy导入构建脚本即可
 * 另一种比较常用的方式是建立一个独立的项目来定义task，其他所有的项目均可引用这些task
 */</span>
<span class="kn">import</span> <span class="nn">version.ProjectVersion</span>
<span class="kn">import</span> <span class="nn">version.ReleaseVersionTask</span>
<span class="kn">import</span> <span class="nn">version.ReleaseVersionListener</span>


<span class="cm">/*
 * 预定义一些属性
 */</span>
<span class="n">ext</span> <span class="o">{</span>
	<span class="c1">//内部版本文件</span>
	<span class="n">versionFile</span> <span class="o">=</span> <span class="n">file</span><span class="o">(</span><span class="s1">'version.properties'</span><span class="o">)</span>
	
	<span class="c1">//依赖包版本</span>
	<span class="n">junitVersion</span> <span class="o">=</span> <span class="s2">"4.12"</span>
	<span class="n">springframeworkVersion</span> <span class="o">=</span> <span class="s2">"4.3.7.RELEASE"</span>
	<span class="n">slf4jVersion</span> <span class="o">=</span> <span class="s2">"1.7.24"</span>
	<span class="n">log4jVersion</span> <span class="o">=</span> <span class="s2">"1.2.17"</span>
<span class="o">}</span>

<span class="cm">/*
 * 预定义一些方法
 */</span>
<span class="n">ProjectVersion</span> <span class="nf">readVersion</span><span class="o">()</span> <span class="o">{</span>   <span class="c1">//以下为从配置文件version.properties中读取版本信息的脚本			</span>
	<span class="n">logger</span><span class="o">.</span><span class="na">quiet</span> <span class="s2">"reading the version file..."</span> <span class="c1">//注意无论什么时候执行gradle构建，gradle都会顺序运行 [初始化-&gt;配置-&gt;执行] 这三个生命周期阶段 </span>
	<span class="k">if</span> <span class="o">(!</span><span class="n">versionFile</span><span class="o">.</span><span class="na">exists</span><span class="o">())</span> <span class="o">{</span>
		<span class="k">throw</span> <span class="k">new</span> <span class="nf">GradleException</span><span class="o">(</span><span class="s2">"Required version file does not exists, $versionFile.path"</span><span class="o">)</span>
	<span class="o">}</span>
	<span class="n">Properties</span> <span class="n">props</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Properties</span><span class="o">();</span>
	<span class="n">versionFile</span><span class="o">.</span><span class="na">withInputStream</span> <span class="o">{</span> <span class="n">is</span> <span class="o">-&gt;</span>
		<span class="n">props</span><span class="o">.</span><span class="na">load</span><span class="o">(</span><span class="n">is</span><span class="o">)</span>
	<span class="o">}</span>
	<span class="k">new</span> <span class="nf">ProjectVersion</span><span class="o">(</span><span class="nl">major:</span><span class="n">props</span><span class="o">.</span><span class="na">major</span><span class="o">.</span><span class="na">toInteger</span><span class="o">(),</span> <span class="nl">minor:</span><span class="n">props</span><span class="o">.</span><span class="na">minor</span><span class="o">.</span><span class="na">toInteger</span><span class="o">(),</span> <span class="nl">release:</span><span class="n">props</span><span class="o">.</span><span class="na">release</span><span class="o">.</span><span class="na">toBoolean</span><span class="o">())</span>
<span class="o">}</span>



<span class="cm">/*
 * 配置插件
 */</span>
<span class="n">apply</span> <span class="nl">plugin:</span> <span class="s1">'java-library'</span>
<span class="n">apply</span> <span class="nl">plugin:</span> <span class="s1">'groovy'</span>
<span class="c1">//apply from: '../build-config/gradle-quality.gradle' //引入外部gradle文件</span>


<span class="cm">/*
 * 配置项目和插件的属性
 */</span>
<span class="n">description</span> <span class="o">=</span> <span class="s1">'Gradle项目模板 之 单项目示例'</span>
<span class="n">group</span> <span class="o">=</span> <span class="s1">'com.keyllo.demo'</span>
<span class="n">archivesBaseName</span> <span class="o">=</span> <span class="s1">'zdemo-gradle-simple'</span>
<span class="n">version</span> <span class="o">=</span> <span class="n">readVersion</span><span class="o">()</span>
<span class="n">sourceCompatibility</span> <span class="o">=</span> <span class="mf">1.8</span>
<span class="n">targetCompatibility</span> <span class="o">=</span> <span class="mf">1.8</span>



<span class="cm">/*
 * 配置一些默认类型的任务（默认类型为DefaultTask）
 */</span>
<span class="n">task</span> <span class="n">printVersion</span> <span class="o">{</span>
	<span class="n">group</span> <span class="o">=</span> <span class="s1">'other'</span> 	<span class="c1">//配置阶段执行的代码</span>
	<span class="n">description</span> <span class="o">=</span> <span class="s1">'打印项目版本'</span>
	<span class="c1">//dependsOn = ['task01', 'task02'] //将会在当前任务之前执行</span>
	<span class="c1">//finalizedBy = ['task03'] //将会在当前任务执行之后执行（不管当前任务是否抛出异常都会执行finalizedBy任务）</span>
	
	<span class="n">doLast</span> <span class="o">{</span> 			<span class="c1">//执行阶段执行的代码</span>
		<span class="n">logger</span><span class="o">.</span><span class="na">quiet</span> <span class="s2">"version: $version"</span>
	<span class="o">}</span>
<span class="o">}</span>

<span class="n">task</span> <span class="n">makeReleaseVersion</span> <span class="o">{</span>
	<span class="n">group</span> <span class="o">=</span> <span class="s1">'other'</span>
	<span class="n">description</span> <span class="o">=</span> <span class="s1">'修改项目版本为发布版本(运行这个任务将改变版本属性，并将新的版本值保存到属性文件中, inputs和outputs保证该任务只会被执行第一次)'</span>
	<span class="n">inputs</span><span class="o">.</span><span class="na">property</span><span class="o">(</span><span class="s1">'release'</span><span class="o">,</span> <span class="n">version</span><span class="o">.</span><span class="na">release</span><span class="o">)</span>
	<span class="n">outputs</span><span class="o">.</span><span class="na">file</span><span class="o">(</span><span class="n">versionFile</span><span class="o">)</span>
	
	<span class="n">doLast</span> <span class="o">{</span> <span class="c1">//这段代码需要在doLast中，否则若直接在task下（配置阶段会执行这些代码），每次执行其他任务版本就会变成发布版本</span>
		<span class="n">version</span><span class="o">.</span><span class="na">release</span> <span class="o">=</span> <span class="kc">true</span>
		<span class="n">ant</span><span class="o">.</span><span class="na">propertyfile</span><span class="o">(</span><span class="nl">file:</span><span class="n">versionFile</span><span class="o">)</span> <span class="o">{</span>
			<span class="n">entry</span><span class="o">(</span><span class="nl">key:</span><span class="s1">'release'</span><span class="o">,</span> <span class="nl">type:</span><span class="s1">'string'</span><span class="o">,</span> <span class="nl">operation:</span> <span class="s1">'='</span><span class="o">,</span> <span class="nl">value:</span><span class="s1">'true'</span><span class="o">)</span>
		<span class="o">}</span>
		<span class="n">println</span> <span class="s2">"make project version release done!"</span>
	<span class="o">}</span>
<span class="o">}</span>

<span class="n">task</span> <span class="nf">makeReleaseVersion2</span><span class="o">(</span><span class="nl">type:</span><span class="n">ReleaseVersionTask</span><span class="o">)</span> <span class="o">{</span> <span class="c1">//自定义task，与makeReleaseVersion具有相同的功能</span>
	<span class="n">release</span> <span class="o">=</span> <span class="n">version</span><span class="o">.</span><span class="na">release</span>
	<span class="n">destFile</span> <span class="o">=</span> <span class="n">versionFile</span>
<span class="o">}</span>

<span class="n">task</span> <span class="nf">createDistribution</span><span class="o">(</span><span class="nl">type:</span><span class="n">Zip</span><span class="o">)</span> <span class="o">{</span>
	<span class="n">group</span> <span class="o">=</span> <span class="s1">'other'</span>
	<span class="n">description</span> <span class="o">=</span> <span class="s1">'创建发布版本'</span>
	<span class="n">dependsOn</span> <span class="o">=</span> <span class="o">[</span><span class="s1">'makeReleaseVersion'</span><span class="o">]</span>
	
	<span class="n">from</span> <span class="n">jar</span><span class="o">.</span><span class="na">outputs</span><span class="o">.</span><span class="na">files</span>			<span class="c1">//隐式调用 jar task 的输出（对于web项目使用war.outputs.files）</span>
	<span class="n">from</span><span class="o">(</span><span class="n">sourceSets</span><span class="o">*.</span><span class="na">allSource</span><span class="o">)</span> <span class="o">{</span>	<span class="c1">//把源文件放到zip文件的src目录下</span>
		<span class="n">into</span> <span class="s1">'src'</span>
	<span class="o">}</span>
	<span class="n">from</span><span class="o">(</span><span class="n">rootDir</span><span class="o">)</span> <span class="o">{</span>					<span class="c1">//为zip文件夹添加版本文件</span>
		<span class="n">include</span> <span class="n">versionFile</span><span class="o">.</span><span class="na">name</span>
	<span class="o">}</span>
<span class="o">}</span>

<span class="n">task</span> <span class="nf">backupReleaseDistribution</span><span class="o">(</span><span class="nl">type:</span><span class="n">Copy</span><span class="o">)</span> <span class="o">{</span>
	<span class="n">group</span> <span class="o">=</span> <span class="s1">'other'</span>
	<span class="n">description</span> <span class="o">=</span> <span class="s1">'备份发布版本到 backup 文件夹'</span>
	
	<span class="n">from</span> <span class="n">createDistribution</span><span class="o">.</span><span class="na">outputs</span><span class="o">.</span><span class="na">files</span>	<span class="c1">//隐式调用createDistribution的输出(该任务会依赖推断出需要先执行createDistribution任务)</span>
	<span class="n">into</span> <span class="s2">"$buildDir/backup"</span>
<span class="o">}</span>

<span class="n">task</span> <span class="n">release</span> <span class="o">{</span>
	<span class="n">group</span> <span class="o">=</span> <span class="s1">'other'</span>
	<span class="n">description</span> <span class="o">=</span> <span class="s1">'发布版本'</span>
	<span class="n">dependsOn</span> <span class="o">=</span> <span class="o">[</span><span class="s1">'backupReleaseDistribution'</span><span class="o">]</span>
	
	<span class="n">doLast</span> <span class="o">{</span>
		<span class="n">logger</span><span class="o">.</span><span class="na">quiet</span> <span class="s2">"released project: $project.name"</span>
	<span class="o">}</span>
<span class="o">}</span>

<span class="cm">/*
gradle.taskGraph.whenReady { TaskExecutionGraph taskGraph -&gt; //通过生命周期钩子[hook]实现版本发布的功能[project.getGradle--&gt;gradle.getTaskGraph--&gt;taskExecutionGraph.whenReady]
	if (taskGraph.hasTask(release)) { //查看执行图中是否包含 task release
		version.release = true
		ant.propertyfile(file:versionFile) {
			entry(key:'release', type:'string', operation:'=', value:'true')
		}
	}
}
*/</span>

<span class="cm">/*
def releaseVersionListener = new ReleaseVersionListener()   	//通过生命周期监听器实现版本发布的功能
gradle.taskGraph.addTaskExecutionGraphListener(releaseVersionListener) //注册监听器到task执行图
*/</span>

<span class="n">tasks</span><span class="o">.</span><span class="na">addRule</span><span class="o">(</span><span class="s2">"Pattern: increment&lt;Vtype&gt;Version - Increments the project major or minor version."</span><span class="o">)</span> <span class="o">{</span> <span class="n">String</span> <span class="n">taskName</span> <span class="o">-&gt;</span>
	<span class="k">if</span> <span class="o">(</span><span class="n">taskName</span><span class="o">.</span><span class="na">startsWith</span><span class="o">(</span><span class="s1">'increment'</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="n">taskName</span><span class="o">.</span><span class="na">endsWith</span><span class="o">(</span><span class="s1">'Version'</span><span class="o">))</span> <span class="o">{</span>
		<span class="n">task</span><span class="o">(</span><span class="n">taskName</span><span class="o">)</span> <span class="o">{</span> <span class="c1">//规则命名任务（规则命名任务即使通过插件声明分组了，它也将永远显示在Rules分组下）</span>
			<span class="n">doLast</span> <span class="o">{</span>	 <span class="c1">//shell示例：gradle tasks --all  |  gradle task incrementMajorVersion</span>
				<span class="n">String</span> <span class="n">vtype</span> <span class="o">=</span> <span class="o">(</span><span class="n">taskName</span><span class="o">-</span><span class="s1">'increment'</span><span class="o">-</span><span class="s1">'Version'</span><span class="o">).</span><span class="na">toLowerCase</span><span class="o">()</span>
				<span class="n">String</span> <span class="n">currentVersion</span> <span class="o">=</span> <span class="n">version</span><span class="o">.</span><span class="na">toString</span><span class="o">()</span>
				<span class="k">switch</span><span class="o">(</span><span class="n">vtype</span><span class="o">)</span> <span class="o">{</span> 
					<span class="k">case</span> <span class="s1">'major'</span><span class="o">:</span>
						<span class="o">++</span><span class="n">version</span><span class="o">.</span><span class="na">major</span>
						<span class="k">break</span>
					<span class="k">case</span> <span class="s1">'minor'</span><span class="o">:</span>
						<span class="o">++</span><span class="n">version</span><span class="o">.</span><span class="na">minor</span>
						<span class="k">break</span>
					<span class="nl">default:</span>
						<span class="k">throw</span> <span class="k">new</span> <span class="nf">GradleException</span><span class="o">(</span><span class="s2">"Invalid version type $vtype, allowed types:['Major','Minor']"</span><span class="o">)</span>
				<span class="o">}</span>
				<span class="n">String</span> <span class="n">newVersion</span> <span class="o">=</span> <span class="n">version</span><span class="o">.</span><span class="na">toString</span><span class="o">()</span>
				<span class="n">logger</span><span class="o">.</span><span class="na">info</span> <span class="s2">"Incrementing $vtype project version: $currentVersion -&gt; $newVersion"</span>
				<span class="n">ant</span><span class="o">.</span><span class="na">propertyfile</span><span class="o">(</span><span class="nl">file:</span><span class="n">versionFile</span><span class="o">)</span> <span class="o">{</span>
					<span class="n">entry</span><span class="o">(</span><span class="nl">key:</span><span class="n">vtype</span><span class="o">,</span> <span class="nl">type:</span><span class="s1">'int'</span><span class="o">,</span> <span class="nl">operation:</span><span class="s1">'+'</span><span class="o">,</span> <span class="nl">value:</span><span class="mi">1</span><span class="o">)</span>
				<span class="o">}</span>
			<span class="o">}</span>
		<span class="o">}</span>
	<span class="o">}</span>
<span class="o">}</span>

<span class="mi">2</span><span class="o">.</span><span class="na">times</span> <span class="o">{</span><span class="n">counter</span> <span class="o">-&gt;</span> 
	<span class="n">task</span> <span class="s2">"dycTask$counter"</span> <span class="o">{</span> <span class="c1">//完全动态任务（可以设置分组等信息）</span>
		<span class="n">group</span> <span class="o">=</span> <span class="s1">'other'</span>
		<span class="n">description</span> <span class="o">=</span> <span class="s1">'动态任务示例'</span>
		
		<span class="n">doLast</span> <span class="o">{</span>
			<span class="n">println</span> <span class="s2">"-----dycTask$counter-----"</span>
		<span class="o">}</span>
	<span class="o">}</span>
<span class="o">}</span>



<span class="cm">/*
 * 配置依赖仓库
 */</span>
<span class="n">repositories</span> <span class="o">{</span>
	<span class="n">mavenLocal</span><span class="o">()</span>
    <span class="n">mavenCentral</span><span class="o">()</span>
	<span class="n">jcenter</span><span class="o">()</span>
<span class="o">}</span>



<span class="cm">/*
 * 配置依赖项
 * 
 */</span>
<span class="n">configurations</span> <span class="o">{</span> <span class="c1">//配置依赖分组信息</span>
	<span class="c1">//compile.exclude module: 'commons'</span>
    <span class="c1">//all*.exclude group: 'org.gradle.test.excludes', module: 'reports'</span>
	
	<span class="c1">//all.resolutionStrategy {  //发生冲突时,使用开发者指定的版本 //与 force:true 配合使用</span>
		<span class="c1">//failOnVersionConflict() </span>
	<span class="c1">//}	</span>
<span class="o">}</span>

<span class="n">dependencies</span> <span class="o">{</span> 	<span class="c1">//配置具体的依赖项</span>
	<span class="c1">//test</span>
	<span class="n">testCompile</span> <span class="s2">"junit:junit:${junitVersion}"</span>
	<span class="n">testCompile</span> <span class="s2">"org.springframework:spring-test:${springframeworkVersion}"</span>

	<span class="c1">//groovy</span>
	<span class="c1">//compile gradleApi() //gradleApi导入的gradle-api包中已经包含了slf4j-log4j12相关类，使用了这个包以后自定义的log4j.properties文件就不会起作用了</span>
	<span class="c1">//compile localGroovy()</span>
	
	<span class="c1">//spring</span>
	<span class="n">compile</span> <span class="s2">"org.springframework:spring-context:${springframeworkVersion}"</span>
	<span class="n">compile</span> <span class="s2">"org.springframework:spring-context-support:${springframeworkVersion}"</span>
	
	<span class="c1">//log4j</span>
	<span class="n">compile</span> <span class="s2">"org.slf4j:slf4j-api:${slf4jVersion}"</span>
	<span class="n">compile</span> <span class="nl">group:</span><span class="s1">'org.slf4j'</span><span class="o">,</span> <span class="nl">name:</span><span class="s1">'slf4j-log4j12'</span><span class="o">,</span> <span class="nl">version:</span><span class="s1">'${slf4jVersion}'</span>
	<span class="n">compile</span> <span class="s2">"log4j:log4j:${log4jVersion}"</span>
	
	
	<span class="cm">/*
	 * 一些依赖配置示例
	 */</span>
	<span class="c1">//compile project(':library') //依赖内部其他项目</span>
	
	<span class="c1">//compile files('spring-core.jar', 'spring-aap.jar') //依赖文件系统的jar文件</span>
	<span class="c1">//compile fileTree(dir: 'deps', include: '*.jar')</span>
	<span class="c1">//compile fileTree(dir: 'libs', include: ['*.jar'])</span>
	
	<span class="c1">//compile('log4j:log4j:1.2.17') { //排除所有的传递性依赖</span>
		<span class="c1">//transitive = false //transitive 属性默认为 true</span>
	<span class="c1">//}</span>
	
	<span class="c1">//compile ('commons-httpclient:commons-httpclient:3.1'){ //排除部分依赖</span>
		<span class="c1">//exclude group:'commons-codec' //排除该group的依赖  //group是必选项,module可选</span>
		<span class="c1">//exclude group:'commons-codec',module:'commons-codec'</span>
	<span class="c1">//}</span>
	
	<span class="c1">//compile group:'b',name:'b',version:'1.1',force:true  //强制使用某个版本</span>
<span class="o">}</span>
</code></pre>
</div>

<p><br /></p>

<p>buildSrc/src/main/groovy/version/ProjectVersion.groovy</p>

<div class="language-groovy highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">version</span>

<span class="kd">class</span> <span class="nc">ProjectVersion</span> <span class="o">{</span>
	<span class="kt">def</span> <span class="n">major</span>
	<span class="kt">def</span> <span class="n">minor</span>
	<span class="kt">def</span> <span class="n">release</span>
	<span class="kt">def</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
		<span class="s2">"$major.$minor${release ? '-RELEASE' : '-SNAPSHOT'}"</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<p><br /></p>

<p>buildSrc/src/main/groovy/version/ReleaseVersionTask.groovy</p>

<div class="language-groovy highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">version</span>

<span class="kn">import</span> <span class="nn">org.gradle.api.DefaultTask</span>
<span class="kn">import</span> <span class="nn">org.gradle.api.tasks.*</span>

<span class="cm">/**
 * 自定义任务：发布版本
 * @author zhangqingli
 *
 */</span>
<span class="kd">class</span> <span class="nc">ReleaseVersionTask</span> <span class="kd">extends</span> <span class="n">DefaultTask</span> <span class="o">{</span>
	<span class="nd">@Input</span> 	  <span class="c1">//通过注解声明 task的输入/输出</span>
	<span class="nd">@Optional</span> <span class="c1">//允许输入值为null</span>
	<span class="n">Boolean</span> <span class="n">release</span>
	<span class="nd">@OutputFile</span>
	<span class="n">File</span> <span class="n">destFile</span>
	
	<span class="nf">ReleaseVersionTask</span><span class="o">()</span> <span class="o">{</span> <span class="c1">//在构造器中设置task的属性</span>
		<span class="n">group</span> <span class="o">=</span> <span class="s1">'other'</span>
		<span class="n">description</span> <span class="o">=</span> <span class="s1">'this is ReleaseVersionTask, extends from DefaultTask'</span>
	<span class="o">}</span>
	
	<span class="nd">@TaskAction</span>
	<span class="kt">void</span> <span class="nf">start</span><span class="o">()</span> <span class="o">{</span>
		<span class="n">project</span><span class="o">.</span><span class="na">version</span><span class="o">.</span><span class="na">release</span> <span class="o">=</span> <span class="kc">true</span>
		<span class="n">ant</span><span class="o">.</span><span class="na">propertyfile</span><span class="o">(</span><span class="nl">file:</span><span class="n">destFile</span><span class="o">)</span> <span class="o">{</span>
			<span class="n">entry</span><span class="o">(</span><span class="nl">key:</span><span class="s1">'release'</span><span class="o">,</span> <span class="nl">type:</span><span class="s1">'string'</span><span class="o">,</span> <span class="nl">operation:</span> <span class="s1">'='</span><span class="o">,</span> <span class="nl">value:</span><span class="s1">'true'</span><span class="o">)</span>
		<span class="o">}</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<p><br /></p>

<p>buildSrc/src/main/groovy/version/ReleaseVersionListener.groovy</p>

<div class="language-groovy highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">version</span>

<span class="kn">import</span> <span class="nn">org.gradle.api.Project</span>
<span class="kn">import</span> <span class="nn">org.gradle.api.Task</span>
<span class="kn">import</span> <span class="nn">org.gradle.api.execution.TaskExecutionGraph</span>
<span class="kn">import</span> <span class="nn">org.gradle.api.execution.TaskExecutionGraphListener</span>

<span class="cm">/**
 * 通过生命周期监听器实现版本发布功能
 * @author zhangqingli
 *
 */</span>
<span class="kd">class</span> <span class="nc">ReleaseVersionListener</span> <span class="kd">implements</span> <span class="n">TaskExecutionGraphListener</span> <span class="o">{</span>
	<span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">releaseTaskPath</span> <span class="o">=</span> <span class="s2">":release"</span>
	
	
	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">graphPopulated</span><span class="o">(</span><span class="n">TaskExecutionGraph</span> <span class="n">taskExecutionGraph</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">if</span> <span class="o">(</span><span class="n">taskExecutionGraph</span><span class="o">.</span><span class="na">hasTask</span><span class="o">(</span><span class="n">releaseTaskPath</span><span class="o">))</span> <span class="o">{</span> <span class="c1">//确定 release task 任务包含在执行图中</span>
			<span class="n">println</span> <span class="s2">"&gt; releaseVersionListener"</span>
			<span class="n">List</span><span class="o">&lt;</span><span class="n">Task</span><span class="o">&gt;</span> <span class="n">allTasks</span> <span class="o">=</span> <span class="n">taskExecutionGraph</span><span class="o">.</span><span class="na">allTasks</span><span class="o">;</span>
			
			<span class="n">Task</span> <span class="n">releaseTask</span> <span class="o">=</span> <span class="n">allTasks</span><span class="o">.</span><span class="na">find</span> <span class="o">{</span>
				<span class="n">it</span><span class="o">.</span><span class="na">path</span> <span class="o">==</span> <span class="n">releaseTaskPath</span>
			<span class="o">}</span>
			<span class="n">Project</span> <span class="n">project</span> <span class="o">=</span> <span class="n">releaseTask</span><span class="o">.</span><span class="na">project</span> <span class="c1">//每个task都知道自己所属的project</span>
			
			<span class="n">project</span><span class="o">.</span><span class="na">version</span><span class="o">.</span><span class="na">release</span> <span class="o">=</span> <span class="kc">true</span>
			<span class="n">project</span><span class="o">.</span><span class="na">ant</span><span class="o">.</span><span class="na">propertyfile</span><span class="o">(</span><span class="nl">file:</span><span class="n">project</span><span class="o">.</span><span class="na">versionFile</span><span class="o">)</span> <span class="o">{</span>
				<span class="n">entry</span><span class="o">(</span><span class="nl">key:</span><span class="s1">'release'</span><span class="o">,</span> <span class="nl">type:</span><span class="s1">'string'</span><span class="o">,</span> <span class="nl">operation:</span><span class="s1">'='</span><span class="o">,</span> <span class="nl">value:</span><span class="s1">'true'</span><span class="o">)</span>
			<span class="o">}</span>	
		<span class="o">}</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<p><br /></p>

<p>src/main/java/spring01/hello/User.java</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">spring01</span><span class="o">.</span><span class="na">hello</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">User</span> <span class="o">{</span>
	
	<span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
	<span class="kd">private</span> <span class="kt">int</span> <span class="n">age</span><span class="o">;</span>
	
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">getName</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">name</span><span class="o">;</span>
	<span class="o">}</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setName</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
	<span class="o">}</span>
	<span class="kd">public</span> <span class="kt">int</span> <span class="nf">getAge</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">age</span><span class="o">;</span>
	<span class="o">}</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setAge</span><span class="o">(</span><span class="kt">int</span> <span class="n">age</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">age</span> <span class="o">=</span> <span class="n">age</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="s">"HelloWorld [name="</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s">", age="</span> <span class="o">+</span> <span class="n">age</span> <span class="o">+</span> <span class="s">"]"</span><span class="o">;</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<p><br /></p>

<p>src/main/resources/spring01.xml</p>

<div class="language-xml highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">"http://www.springframework.org/schema/beans"</span>
	<span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
	<span class="na">xmlns:context=</span><span class="s">"http://www.springframework.org/schema/context"</span>
	<span class="na">xsi:schemaLocation=</span><span class="s">"http://www.springframework.org/schema/beans</span> <span class="err">http://www.springframework.org/schema/beans/spring-beans.xsd</span>
		<span class="err">http://www.springframework.org/schema/context</span> <span class="err">http://www.springframework.org/schema/context/spring-context-4.3.xsd"</span><span class="nt">&gt;</span>

	<span class="c">&lt;!-- 引入外部配置文件 --&gt;</span>
	<span class="nt">&lt;context:property-placeholder</span> <span class="na">location=</span><span class="s">"db.properties"</span><span class="nt">/&gt;</span>
	
	<span class="c">&lt;!-- 装配beans --&gt;</span>
	<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"user01"</span> <span class="na">class=</span><span class="s">"spring01.hello.User"</span><span class="nt">&gt;</span>
		<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"name"</span> <span class="na">value=</span><span class="s">"${user01.name}"</span><span class="nt">/&gt;</span>
		<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"age"</span> <span class="na">value=</span><span class="s">"${user01.age}"</span><span class="nt">/&gt;</span>
	<span class="nt">&lt;/bean&gt;</span>
<span class="nt">&lt;/beans&gt;</span>
</code></pre>
</div>

<p><br /></p>

<p>src/main/resources/db.properties</p>

<div class="language-properties highlighter-rouge"><pre class="highlight"><code><span class="py">user01.name</span><span class="p">=</span><span class="s">zhangsan</span>
<span class="py">user01.age</span><span class="p">=</span><span class="s">23</span>
</code></pre>
</div>

<p>src/main/resources/log4j.properties</p>

<div class="language-properties highlighter-rouge"><pre class="highlight"><code><span class="py">project.name</span><span class="p">=</span><span class="s">zdemo-gradle-simple</span>
<span class="py">fileout.path</span><span class="p">=</span><span class="s">/tmp/mytmp/logs</span>
<span class="c">#
</span><span class="py">log4j.rootLogger</span><span class="p">=</span><span class="s">info, STDOUT, FILEOUT</span>
<span class="py">log4j.logger.org.springframework.data.mongodb.core</span><span class="p">=</span><span class="s">MONGODB </span>

<span class="py">log4j.appender.STDOUT</span><span class="p">=</span><span class="s">org.apache.log4j.ConsoleAppender</span>
<span class="py">log4j.appender.STDOUT.encoding</span><span class="p">=</span><span class="s">UTF-8</span>
<span class="py">log4j.appender.STDOUT.layout</span><span class="p">=</span><span class="s">org.apache.log4j.PatternLayout</span>
<span class="py">log4j.appender.STDOUT.layout.ConversionPattern</span><span class="p">=</span><span class="s">[${project.name}] [%-5p] [%d] [%-3r] %l [%t,%x] %n  - %m%n</span>

<span class="py">log4j.appender.FILEOUT</span><span class="p">=</span><span class="s">org.apache.log4j.DailyRollingFileAppender   </span>
<span class="py">log4j.appender.FILEOUT.File</span><span class="p">=</span><span class="s">${fileout.path}/${project.name}.log</span>
<span class="py">log4j.appender.FILEOUT.encoding</span><span class="p">=</span><span class="s">UTF-8</span>
<span class="py">log4j.appender.FILEOUT.layout</span><span class="p">=</span><span class="s">org.apache.log4j.PatternLayout</span>
<span class="py">log4j.appender.FILEOUT.layout.ConversionPattern</span><span class="p">=</span><span class="s">[${project.name}] [%-5p] [%d] [%-3r] %l [%t,%x] %n %m%n</span>
</code></pre>
</div>

<p><br /></p>

<p>src/test/java/spring01/UserTest.java</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">spring01</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.time.LocalDate</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.time.LocalTime</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.junit.Test</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.junit.runner.RunWith</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.slf4j.Logger</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.slf4j.LoggerFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Qualifier</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.test.context.ContextConfiguration</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.test.context.junit4.SpringJUnit4ClassRunner</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">spring01.hello.User</span><span class="o">;</span>

<span class="nd">@RunWith</span><span class="o">(</span><span class="n">SpringJUnit4ClassRunner</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="nd">@ContextConfiguration</span><span class="o">(</span><span class="n">locations</span><span class="o">={</span>
		<span class="s">"classpath:/spring01.xml"</span>
<span class="o">})</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserTest</span> <span class="o">{</span>
	<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Logger</span> <span class="n">LOGGER</span> <span class="o">=</span> <span class="n">LoggerFactory</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="n">UserTest</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
	
	<span class="nd">@Autowired</span>
	<span class="nd">@Qualifier</span><span class="o">(</span><span class="s">"user01"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="n">User</span> <span class="n">user01</span><span class="o">;</span>
	
	
	<span class="nd">@Test</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">test01</span><span class="o">()</span> <span class="o">{</span>
		<span class="n">LOGGER</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"test01&gt;&gt;"</span><span class="o">);</span>
		<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">user01</span><span class="o">.</span><span class="na">getName</span><span class="o">()</span> <span class="o">+</span> <span class="s">"--"</span> <span class="o">+</span> <span class="n">user01</span><span class="o">.</span><span class="na">getAge</span><span class="o">());</span>
	<span class="o">}</span>
	
	<span class="nd">@Test</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">test02</span><span class="o">()</span> <span class="o">{</span>
		<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">LocalDate</span><span class="o">.</span><span class="na">now</span><span class="o">()</span> <span class="o">+</span> <span class="s">"--"</span> <span class="o">+</span> <span class="n">LocalTime</span><span class="o">.</span><span class="na">now</span><span class="o">());</span>
		<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">Integer</span><span class="o">.</span><span class="na">toBinaryString</span><span class="o">(</span><span class="mi">0</span><span class="n">B0101</span> <span class="o">+</span> <span class="mi">0</span><span class="n">B0010</span><span class="o">));</span>
		<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="mi">0</span><span class="n">B001</span> <span class="o">&amp;</span> <span class="mi">0</span><span class="n">B1011</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<p><br /><br /></p>

<h3 id="然后我们开始来构建多模块项目首先初始化多模块项目">然后我们开始来构建多模块项目，首先初始化多模块项目</h3>

<div class="language-groovy highlighter-rouge"><pre class="highlight"><code><span class="o">&gt;</span> <span class="n">mkdir</span> <span class="n">zdemo</span><span class="o">-</span><span class="n">gradle</span><span class="o">-</span><span class="n">parent</span> <span class="o">&amp;&amp;</span> <span class="n">cd</span> <span class="n">zdemo</span><span class="o">-</span><span class="n">gradle</span><span class="o">-</span><span class="n">parent</span>
<span class="o">&gt;</span> <span class="n">gradle</span> <span class="n">init</span>

<span class="o">&gt;</span> <span class="n">tree</span>
<span class="o">.</span>
<span class="err">├──</span> <span class="n">build</span><span class="o">.</span><span class="na">gradle</span>
<span class="err">├──</span> <span class="n">gradle</span>
<span class="err">│  </span> <span class="err">└──</span> <span class="n">wrapper</span>
<span class="err">│  </span>     <span class="err">├──</span> <span class="n">gradle</span><span class="o">-</span><span class="n">wrapper</span><span class="o">.</span><span class="na">jar</span>
<span class="err">│  </span>     <span class="err">└──</span> <span class="n">gradle</span><span class="o">-</span><span class="n">wrapper</span><span class="o">.</span><span class="na">properties</span>
<span class="err">├──</span> <span class="n">gradlew</span>
<span class="err">├──</span> <span class="n">gradlew</span><span class="o">.</span><span class="na">bat</span>
<span class="err">└──</span> <span class="n">settings</span><span class="o">.</span><span class="na">gradle</span>
</code></pre>
</div>

<p><br /></p>

<h3 id="初始化子项目">初始化子项目</h3>

<p>编写 ${rootProject.projectDir}/settings.gradle</p>

<div class="highlighter-rouge"><pre class="highlight"><code>rootProject.name = 'zdemo-gradle-parent'

include 'zdemo-gradle-model'
include 'zdemo-gradle-dao'
include 'zdemo-gradle-biz'
include 'zdemo-gradle-app'
</code></pre>
</div>

<p>编写${rootProject.projectDir}/build.gradle 公共配置：</p>

<ul>
  <li>allprojects：allprojects是父Project的一个属性，该属性会返回该Project对象以及其所有子项目。在父项目的build.gradle脚本里，可以通过给allprojects传一个包含配置信息的闭包，来配置所有项目（包括父项目）的共同设置。通常可以在这里配置IDE的插件，group和version等信息</li>
  <li>subprojects：subprojects和allprojects一样，也是父Project的一个属性，该属性会返回所有子项目。在父项目的build.gradle脚本里，给 subprojects传一个包含配置信息的闭包，可以配置所有子项目共有的设置，比如共同的插件、repositories、依赖版本以及依赖配置</li>
  <li>configure：在项目中，并不是所有的子项目都会具有相同的配置，但是会有部分子项目具有相同的配置，比如在我所在的项目里除了cis-war和admin-war是web项目之外，其他子项目都不是。所以需要给这两个子项目添加war插件。Gradle的configure可以传入子项目数组，并为这些子项目设置相关配置。</li>
</ul>

<div class="language-groovy highlighter-rouge"><pre class="highlight"><code><span class="cm">/*
* 全部项目公共配置
*/</span>
<span class="n">allprojects</span> <span class="o">{</span>
	<span class="c1">//公共属性</span>
  	<span class="n">group</span> <span class="s1">'com.keyllo.demo'</span>
  	<span class="n">version</span> <span class="s1">'0.0.1-SNAPSHOT'</span>
  
  	<span class="c1">//公共任务</span>
  	<span class="c1">//..</span>
<span class="o">}</span>

<span class="cm">/*
* 子项目公共配置
*/</span>
<span class="n">subprojects</span> <span class="o">{</span>
  	<span class="c1">//公共插件</span>
	<span class="n">apply</span> <span class="nl">plugin:</span> <span class="s1">'eclipse'</span>
	<span class="n">apply</span> <span class="nl">plugin:</span> <span class="s1">'java-library'</span>
	<span class="n">apply</span> <span class="nl">plugin:</span> <span class="s1">'groovy'</span>
	<span class="n">apply</span> <span class="nl">plugin:</span> <span class="s1">'maven'</span>
  
  	<span class="c1">//公共参数</span>
 	<span class="n">sourceCompatibility</span> <span class="o">=</span> <span class="mf">1.8</span>
	<span class="n">targetCompatibility</span> <span class="o">=</span> <span class="mf">1.8</span>
	<span class="n">ext</span> <span class="o">{</span>
		<span class="n">junitVersion</span> <span class="o">=</span> <span class="s2">"4.12"</span>
	<span class="o">}</span>
  	
  	<span class="c1">//公共依赖库和依赖包</span>
  	<span class="n">repositories</span> <span class="o">{</span>
      	<span class="n">mavenLocal</span><span class="o">()</span>
		<span class="n">mavenCentral</span><span class="o">()</span>
		<span class="n">jcenter</span><span class="o">()</span>
  	<span class="o">}</span>
  
  	<span class="n">dependencies</span> <span class="o">{</span>
		<span class="n">testCompile</span> <span class="s2">"junit:junit:${junitVersion}"</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<p>编写${rootProject.projectDir}/build.gradle 独享配置：</p>

<p>在项目中，除了设置共同配置之外， 每个子项目还会有其独有的配置。比如每个子项目具有不同的依赖以及每个子项目特殊的task等。Gradle提供了两种方式来分别为每个子项目设置独有的配置。</p>

<ul>
  <li>在父项目的build.gradle文件中通过project(‘:sub-project-name’)来设置对应的子项目的配置。比如在子项目core需要Hibernate的依赖等。</li>
  <li>我们还可以在每个子项目的目录里建立自己的构建脚本。在上例中，可以在子项目core目录下为其建立一个build.gradle文件，并在该构建脚本中配置core子项目所需的所有配置。</li>
</ul>

<div class="language-groovy highlighter-rouge"><pre class="highlight"><code><span class="cm">/*
* 子项目独享配置
*/</span>
<span class="n">Project</span><span class="o">[]</span> <span class="n">projects</span> <span class="o">=</span> <span class="n">subprojects</span><span class="o">.</span><span class="na">findAll</span> <span class="o">{</span><span class="n">it</span><span class="o">.</span><span class="na">name</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="s1">'app'</span><span class="o">)}</span>
<span class="n">configure</span><span class="o">(</span><span class="n">projects</span><span class="o">)</span> <span class="o">{</span>
	<span class="n">apply</span> <span class="nl">plugin:</span> <span class="s1">'war'</span>
<span class="o">}</span>

<span class="n">project</span><span class="o">(</span><span class="s1">':zdemo-gradle-model'</span><span class="o">)</span> <span class="o">{</span>
 	<span class="c1">//...</span>
<span class="o">}</span>

<span class="n">project</span><span class="o">(</span><span class="s1">':zdemo-gradle-dao'</span><span class="o">)</span> <span class="o">{</span>
	<span class="c1">//...</span>
<span class="o">}</span>

<span class="n">project</span><span class="o">(</span><span class="s1">':zdemo-gradle-biz'</span><span class="o">)</span> <span class="o">{</span>
	<span class="c1">//...</span>
<span class="o">}</span>

<span class="n">project</span><span class="o">(</span><span class="s1">':zdemo-gradle-app'</span><span class="o">)</span> <span class="o">{</span>
	<span class="c1">//...</span>
<span class="o">}</span>
</code></pre>
</div>

<p>根据我对Gradle的使用经验，对于子项目少，配置简单的小型项目，推荐使用第一种方式配置，这样就可以把所有的配置信息放在同一个build.gradle文件里。例如我同事郑晔的开源项目moco。它只有两个子项目，因而就使用了第一种方式配置，在项目根目录下的build.gradle文件中设置项目相关的配置信息。但是，若是对于子项目多，并且配置复杂的大型项目，使用第二种方式对项目进行配置会更好。因为，第二种配置方式将各个项目的配置分别放到单独的build.gradle文件中去，可以方便设置和管理每个子项目的配置信息。<br /></p>

<p>运行 gradle build 编译并测试整个项目，这是后会生成整个项目的目录：</p>

<div class="language-groovy highlighter-rouge"><pre class="highlight"><code><span class="o">&gt;</span> <span class="n">gradle</span> <span class="n">build</span>
<span class="o">&gt;</span> <span class="n">tree</span>
<span class="o">.</span>
<span class="err">├──</span> <span class="n">build</span>
<span class="err">│  </span> <span class="err">├──</span> <span class="n">libs</span>
<span class="err">│  </span> <span class="err">│  </span> <span class="err">└──</span> <span class="n">zdemo</span><span class="o">-</span><span class="n">gradle</span><span class="o">-</span><span class="n">parent</span><span class="o">-</span><span class="mf">0.0</span><span class="o">.</span><span class="mi">1</span><span class="o">-</span><span class="n">SNAPSHOT</span><span class="o">.</span><span class="na">war</span>
<span class="err">│  </span> <span class="err">└──</span> <span class="n">tmp</span>
<span class="err">│  </span>     <span class="err">└──</span> <span class="n">war</span>
<span class="err">│  </span>         <span class="err">└──</span> <span class="n">MANIFEST</span><span class="o">.</span><span class="na">MF</span>
<span class="err">├──</span> <span class="n">build</span><span class="o">.</span><span class="na">gradle</span>
<span class="err">├──</span> <span class="n">gradle</span>
<span class="err">│  </span> <span class="err">└──</span> <span class="n">wrapper</span>
<span class="err">│  </span>     <span class="err">├──</span> <span class="n">gradle</span><span class="o">-</span><span class="n">wrapper</span><span class="o">.</span><span class="na">jar</span>
<span class="err">│  </span>     <span class="err">└──</span> <span class="n">gradle</span><span class="o">-</span><span class="n">wrapper</span><span class="o">.</span><span class="na">properties</span>
<span class="err">├──</span> <span class="n">gradlew</span>
<span class="err">├──</span> <span class="n">gradlew</span><span class="o">.</span><span class="na">bat</span>
<span class="err">├──</span> <span class="n">settings</span><span class="o">.</span><span class="na">gradle</span>
<span class="err">├──</span> <span class="n">zdemo</span><span class="o">-</span><span class="n">gradle</span><span class="o">-</span><span class="n">app</span>
<span class="err">│  </span> <span class="err">└──</span> <span class="n">build</span>
<span class="err">│  </span>     <span class="err">├──</span> <span class="n">libs</span>
<span class="err">│  </span>     <span class="err">│  </span> <span class="err">└──</span> <span class="n">zdemo</span><span class="o">-</span><span class="n">gradle</span><span class="o">-</span><span class="n">app</span><span class="o">-</span><span class="mf">0.0</span><span class="o">.</span><span class="mi">1</span><span class="o">-</span><span class="n">SNAPSHOT</span><span class="o">.</span><span class="na">jar</span>
<span class="err">│  </span>     <span class="err">└──</span> <span class="n">tmp</span>
<span class="err">│  </span>         <span class="err">└──</span> <span class="n">jar</span>
<span class="err">│  </span>             <span class="err">└──</span> <span class="n">MANIFEST</span><span class="o">.</span><span class="na">MF</span>
<span class="err">├──</span> <span class="n">zdemo</span><span class="o">-</span><span class="n">gradle</span><span class="o">-</span><span class="n">biz</span>
<span class="err">│  </span> <span class="err">└──</span> <span class="n">build</span>
<span class="err">│  </span>     <span class="err">├──</span> <span class="n">libs</span>
<span class="err">│  </span>     <span class="err">│  </span> <span class="err">└──</span> <span class="n">zdemo</span><span class="o">-</span><span class="n">gradle</span><span class="o">-</span><span class="n">biz</span><span class="o">-</span><span class="mf">0.0</span><span class="o">.</span><span class="mi">1</span><span class="o">-</span><span class="n">SNAPSHOT</span><span class="o">.</span><span class="na">jar</span>
<span class="err">│  </span>     <span class="err">└──</span> <span class="n">tmp</span>
<span class="err">│  </span>         <span class="err">└──</span> <span class="n">jar</span>
<span class="err">│  </span>             <span class="err">└──</span> <span class="n">MANIFEST</span><span class="o">.</span><span class="na">MF</span>
<span class="err">├──</span> <span class="n">zdemo</span><span class="o">-</span><span class="n">gradle</span><span class="o">-</span><span class="n">dao</span>
<span class="err">│  </span> <span class="err">└──</span> <span class="n">build</span>
<span class="err">│  </span>     <span class="err">├──</span> <span class="n">libs</span>
<span class="err">│  </span>     <span class="err">│  </span> <span class="err">└──</span> <span class="n">zdemo</span><span class="o">-</span><span class="n">gradle</span><span class="o">-</span><span class="n">dao</span><span class="o">-</span><span class="mf">0.0</span><span class="o">.</span><span class="mi">1</span><span class="o">-</span><span class="n">SNAPSHOT</span><span class="o">.</span><span class="na">jar</span>
<span class="err">│  </span>     <span class="err">└──</span> <span class="n">tmp</span>
<span class="err">│  </span>         <span class="err">└──</span> <span class="n">jar</span>
<span class="err">│  </span>             <span class="err">└──</span> <span class="n">MANIFEST</span><span class="o">.</span><span class="na">MF</span>
<span class="err">└──</span> <span class="n">zdemo</span><span class="o">-</span><span class="n">gradle</span><span class="o">-</span><span class="n">model</span>
    <span class="err">└──</span> <span class="n">build</span>
        <span class="err">├──</span> <span class="n">libs</span>
        <span class="err">│  </span> <span class="err">└──</span> <span class="n">zdemo</span><span class="o">-</span><span class="n">gradle</span><span class="o">-</span><span class="n">model</span><span class="o">-</span><span class="mf">0.0</span><span class="o">.</span><span class="mi">1</span><span class="o">-</span><span class="n">SNAPSHOT</span><span class="o">.</span><span class="na">jar</span>
        <span class="err">└──</span> <span class="n">tmp</span>
            <span class="err">└──</span> <span class="n">jar</span>
                <span class="err">└──</span> <span class="n">MANIFEST</span><span class="o">.</span><span class="na">MF</span>
</code></pre>
</div>

<p><br /></p>

<h3 id="使用eclipse或其他集成开发工具打开新创建的gradle项目">使用eclipse或其他集成开发工具打开新创建的gradle项目</h3>

<p>import exsisting gradle project 导入刚刚创建的项目，项目导入后如下： <br /></p>

<p><img src="http://img.blog.csdn.net/20170702135153728?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQva2luZ2x5am4=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" style="width:80%" /></p>

<p><br /></p>

<h3 id="gradle-构建多模块项目示例待完善">gradle 构建多模块项目示例（待完善）</h3>

<h4 id="zdemo-gradle-parent">zdemo-gradle-parent</h4>

<p>settings.gradle</p>

<div class="language-groovy highlighter-rouge"><pre class="highlight"><code>
<span class="n">rootProject</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="s1">'zdemo-gradle-parent'</span>

<span class="cm">/*
//扁平化布局（子项目和父项目处于同一级目录中）
includeFlat 'zdemo-gradle-model'
includeFlat 'zdemo-gradle-dao'
includeFlat 'zdemo-gradle-biz'
includeFlat 'zdemo-gradle-app'
*/</span>


<span class="cm">/*
 * 层次化布局（子项目在父项目目录中）
 */</span>
<span class="n">include</span> <span class="s1">'zdemo-gradle-model'</span>
<span class="n">include</span> <span class="s1">'zdemo-gradle-dao'</span>
<span class="n">include</span> <span class="s1">'zdemo-gradle-biz'</span>
<span class="n">include</span> <span class="s1">'zdemo-gradle-app'</span>
</code></pre>
</div>

<p><br /></p>

<p>build.gradle</p>

<div class="language-groovy highlighter-rouge"><pre class="highlight"><code><span class="cm">/*
 * 引入外部gradle文件
 */</span>
<span class="n">apply</span> <span class="nl">from:</span> <span class="s2">"${rootProject.projectDir}/config/task/hellotask.gradle"</span>
<span class="n">apply</span> <span class="nl">from:</span> <span class="s2">"${rootProject.projectDir}/config/plugin/dateAndTimePlugin.gradle"</span>


<span class="cm">/*
 * 全部项目公共配置
 */</span>
<span class="n">allprojects</span> <span class="o">{</span>
	<span class="c1">// 公共属性</span>
	<span class="n">group</span> <span class="o">=</span> <span class="s1">'com.keyllo.demo'</span>
	<span class="n">version</span> <span class="o">=</span> <span class="s1">'0.0.1-SNAPSHOT'</span>

	<span class="c1">// 公共任务</span>
	<span class="n">task</span> <span class="n">printProjectInfo</span> <span class="o">{</span>
		<span class="n">group</span> <span class="s1">'build setup'</span>
		<span class="n">description</span> <span class="s1">'打印项目名'</span>
		
		<span class="n">doLast</span> <span class="o">{</span>
			<span class="n">println</span> <span class="s2">"porject name: ${project.name}"</span>
			<span class="n">println</span> <span class="s2">"project profile: ${project.profile}"</span>
		<span class="o">}</span>
	<span class="o">}</span>
<span class="o">}</span>


<span class="cm">/*
 * 子项目公共配置
 */</span>
<span class="n">subprojects</span> <span class="o">{</span>
	<span class="c1">// 公共插件</span>
	<span class="n">apply</span> <span class="nl">plugin:</span> <span class="s1">'eclipse'</span>
	<span class="n">apply</span> <span class="nl">plugin:</span> <span class="s1">'java-library'</span>
	<span class="n">apply</span> <span class="nl">plugin:</span> <span class="s1">'groovy'</span>
	<span class="n">apply</span> <span class="nl">plugin:</span> <span class="s1">'maven'</span>
	<span class="n">apply</span> <span class="nl">plugin:</span> <span class="s1">'checkstyle'</span>

	<span class="n">checkstyle</span> <span class="o">{</span>
		<span class="n">configFile</span> <span class="o">=</span> <span class="n">file</span><span class="o">(</span><span class="s2">"${rootProject.projectDir}/config/checkstyle/checkstyle.xml"</span><span class="o">)</span> <span class="c1">//静态代码检查配置</span>
	<span class="o">}</span>
	
	<span class="c1">// 公共参数</span>
	<span class="n">sourceCompatibility</span> <span class="o">=</span> <span class="mf">1.8</span>
	<span class="n">targetCompatibility</span> <span class="o">=</span> <span class="mf">1.8</span>
	<span class="c1">//sourceSets.main.output.classesDir = "${project.rootDir}/bin"</span>
	<span class="c1">//sourceSets.main.output.resourcesDir = "${project.rootDir}/bin"</span>
	
	<span class="n">ext</span> <span class="o">{</span> 
		<span class="n">junitVersion</span> <span class="o">=</span> <span class="s1">'4.12'</span> 
		<span class="n">springframeworkVersion</span> <span class="o">=</span> <span class="s2">"4.3.7.RELEASE"</span>
		<span class="n">slf4Version</span> <span class="o">=</span> <span class="s2">"1.7.24"</span>
		<span class="n">log4jVersion</span> <span class="o">=</span> <span class="s2">"1.2.17"</span>
		<span class="n">springDataMongodbVersion</span> <span class="o">=</span> <span class="s2">"1.10.3.RELEASE"</span>
		<span class="n">hibernateVersion</span> <span class="o">=</span> <span class="s2">"5.2.4.Final"</span>
		<span class="n">jacksonVersion</span> <span class="o">=</span> <span class="s2">"2.8.7"</span>
		<span class="n">fastjsonVersion</span> <span class="o">=</span> <span class="s2">"1.1.36"</span>
	<span class="o">}</span>
	
	
	<span class="c1">// 公共任务</span>
	<span class="n">project</span><span class="o">.</span><span class="na">processResources</span> <span class="o">{</span> <span class="c1">//处理资源文件(占位符使用 @xxx@ 形式)</span>
		<span class="n">from</span><span class="o">(</span><span class="n">sourceSets</span><span class="o">.</span><span class="na">main</span><span class="o">.</span><span class="na">resources</span><span class="o">.</span><span class="na">srcDirs</span><span class="o">)</span> <span class="o">{</span>
			<span class="n">filter</span><span class="o">(</span><span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">tools</span><span class="o">.</span><span class="na">ant</span><span class="o">.</span><span class="na">filters</span><span class="o">.</span><span class="na">ReplaceTokens</span><span class="o">,</span> <span class="nl">tokens:</span><span class="n">loadGroovyForDB</span><span class="o">())</span>
		<span class="o">}</span>
	<span class="o">}</span>
	<span class="n">project</span><span class="o">.</span><span class="na">test</span> <span class="o">{</span> <span class="c1">//打开测试中标准输出和错误流的日志</span>
		 <span class="n">testLogging</span> <span class="o">{</span>
			 <span class="n">events</span> <span class="s1">'started'</span><span class="o">,</span> <span class="s1">'passed'</span><span class="o">,</span> <span class="s1">'skipped'</span><span class="o">,</span> <span class="s1">'failed'</span>
			 <span class="n">showStandardStreams</span> <span class="o">=</span> <span class="kc">true</span>
			 <span class="n">exceptionFormat</span> <span class="o">=</span> <span class="s1">'full'</span>
		 <span class="o">}</span>
	<span class="o">}</span>
	<span class="n">task</span> <span class="nf">copyResourcesToEclipseBin</span><span class="o">(</span><span class="nl">type:</span><span class="n">Copy</span><span class="o">)</span> <span class="o">{</span>
		<span class="n">group</span> <span class="s1">'other'</span>
		<span class="n">description</span> <span class="s1">'拷贝资源文件到eclipse bin目录下'</span>
		
		<span class="n">from</span> <span class="s2">"${buildDir}/resources/main"</span>
		<span class="n">into</span> <span class="s2">"${projectDir}/bin"</span>
		<span class="n">include</span><span class="o">(</span><span class="s1">'**/*.xml'</span><span class="o">,</span> <span class="s1">'**/*.properties'</span><span class="o">)</span>
	<span class="o">}</span>
	<span class="n">test</span><span class="o">.</span><span class="na">dependsOn</span> <span class="n">copyResourcesToEclipseBin</span>
	<span class="c1">//copyResourcesToEclipseBin.enabled = false //跳过任务</span>
	<span class="c1">//copyResourcesToEclipseBin.onlyIf { "dev".equalsIgnoreCase("${profile}") }</span>
	
	
	<span class="c1">//公共仓库和依赖包</span>
	<span class="n">repositories</span> <span class="o">{</span>
		<span class="n">mavenLocal</span><span class="o">()</span>
		<span class="n">mavenCentral</span><span class="o">()</span>
		<span class="n">jcenter</span><span class="o">()</span>
	<span class="o">}</span>

	<span class="n">dependencies</span> <span class="o">{</span> 
		<span class="c1">//test</span>
		<span class="n">testCompile</span> <span class="s2">"junit:junit:${junitVersion}"</span> 
		<span class="n">testCompile</span> <span class="s2">"org.springframework:spring-test:${springframeworkVersion}"</span>
		
		<span class="c1">//groovy</span>
		<span class="n">compile</span> <span class="nf">localGroovy</span><span class="o">()</span>
		
		<span class="c1">//log4j</span>
		<span class="n">compile</span> <span class="s2">"org.slf4j:slf4j-api:${slf4Version}"</span>
		<span class="n">compile</span> <span class="s2">"org.slf4j:slf4j-log4j12:${slf4Version}"</span>
		<span class="n">compile</span> <span class="s2">"log4j:log4j:${log4jVersion}"</span>
	<span class="o">}</span>
<span class="o">}</span>


<span class="cm">/*
 * 子项目独享配置
 */</span>
<span class="n">project</span><span class="o">(</span><span class="s1">':zdemo-gradle-model'</span><span class="o">)</span> <span class="o">{</span>
	<span class="n">archivesBaseName</span> <span class="o">=</span> <span class="s1">'zdemo-gradle-model'</span>
	<span class="n">description</span> <span class="o">=</span> <span class="s1">'Gradle项目模板 之 数据模型模块'</span>
	
	<span class="n">dependencies</span> <span class="o">{</span>
		<span class="c1">//mongodb</span>
		<span class="n">compile</span> <span class="s2">"org.springframework.data:spring-data-mongodb:${springDataMongodbVersion}"</span>
		
		<span class="c1">//hibernate</span>
		<span class="n">compile</span> <span class="s2">"org.hibernate:hibernate-validator:${hibernateVersion}"</span>
		
		<span class="c1">//json</span>
		<span class="n">compile</span> <span class="s2">"com.fasterxml.jackson.core:jackson-databind:${jacksonVersion}"</span>
		<span class="n">compile</span> <span class="s2">"com.fasterxml.jackson.dataformat:jackson-dataformat-xml:${jacksonVersion}"</span>
		<span class="n">compile</span> <span class="s2">"com.alibaba:fastjson:${fastjsonVersion}"</span>
	<span class="o">}</span>
<span class="o">}</span>

<span class="n">project</span><span class="o">(</span><span class="s1">':zdemo-gradle-dao'</span><span class="o">)</span> <span class="o">{</span>
	<span class="n">archivesBaseName</span> <span class="o">=</span> <span class="s1">'zdemo-gradle-dao'</span>
	<span class="n">description</span> <span class="o">=</span> <span class="s1">'Gradle项目模板 之 数据访问模块'</span>
	
	<span class="n">gradle</span><span class="o">.</span><span class="na">beforeProject</span> <span class="o">{</span><span class="n">project</span> <span class="o">-&gt;</span> 		<span class="c1">//初始化阶段以后，配置阶段之前执行的代码</span>
		<span class="k">if</span> <span class="o">(</span><span class="s2">"zdemo-gradle-dao"</span><span class="o">.</span><span class="na">equalsIgnoreCase</span><span class="o">(</span><span class="s2">"${project.name}"</span><span class="o">))</span> <span class="o">{</span>
			<span class="n">println</span> <span class="s2">"=========gradle.beforeProject============"</span>	
			<span class="n">println</span> <span class="s2">"${project.name}"</span>
		<span class="o">}</span>
	<span class="o">}</span>
	<span class="n">gradle</span><span class="o">.</span><span class="na">taskGraph</span><span class="o">.</span><span class="na">whenReady</span> <span class="o">{</span><span class="n">taskGraph</span> <span class="o">-&gt;</span> <span class="c1">//配置阶段之后，执行阶段之前执行的代码</span>
		<span class="k">if</span><span class="o">(</span><span class="n">taskGraph</span><span class="o">.</span><span class="na">hasTask</span><span class="o">(</span><span class="n">test</span><span class="o">))</span> <span class="o">{</span>
			<span class="n">println</span> <span class="s2">"========gradle.taskGraph.whenReady======="</span>
		<span class="o">}</span>
	<span class="o">}</span>
	<span class="n">gradle</span><span class="o">.</span><span class="na">buildFinished</span> <span class="o">{</span><span class="n">result</span> <span class="o">-&gt;</span>			<span class="c1">//执行阶段完成之后执行的代码</span>
		<span class="n">println</span> <span class="s2">"============gradle.buildFinished============="</span>
	<span class="o">}</span>
	
	
	<span class="n">configurations</span><span class="o">.</span><span class="na">all</span> <span class="o">{</span>
		<span class="n">resolutionStrategy</span> <span class="o">{</span>
			<span class="c1">//failOnVersionConflict() 						//依赖版本冲突时构建失败，通常用于查找版本冲突</span>
			<span class="c1">//force "org.slf4j:slf4j-api:${slf4Version}"  	//强制指定一个版本</span>
		<span class="o">}</span>
	<span class="o">}</span>
	<span class="n">dependencies</span> <span class="o">{</span>
		<span class="c1">//inner projects</span>
		<span class="n">compile</span> <span class="nf">project</span><span class="o">(</span><span class="s2">":zdemo-gradle-model"</span><span class="o">)</span>
		
		<span class="c1">//spring</span>
		<span class="n">compile</span> <span class="s2">"org.springframework:spring-context:${springframeworkVersion}"</span>
		<span class="n">compile</span> <span class="s2">"org.springframework:spring-context-support:${springframeworkVersion}"</span>
		<span class="n">compile</span> <span class="s2">"org.springframework.data:spring-data-mongodb:${springDataMongodbVersion}"</span>
	<span class="o">}</span>
<span class="o">}</span>

<span class="n">project</span><span class="o">(</span><span class="s1">':zdemo-gradle-biz'</span><span class="o">)</span> <span class="o">{</span>
	<span class="n">archivesBaseName</span> <span class="o">=</span> <span class="s1">'zdemo-gradle-biz'</span>
	<span class="n">description</span> <span class="o">=</span> <span class="s1">'Gradle项目模板 之 业务模块'</span>
	
	<span class="n">dependencies</span> <span class="o">{</span>
		<span class="c1">//inner projects</span>
		<span class="n">compile</span> <span class="nf">project</span><span class="o">(</span><span class="s2">":zdemo-gradle-dao"</span><span class="o">)</span>
	<span class="o">}</span>
<span class="o">}</span>

<span class="n">project</span><span class="o">(</span><span class="s1">':zdemo-gradle-app'</span><span class="o">)</span> <span class="o">{</span>
	<span class="n">apply</span> <span class="nl">plugin:</span> <span class="s1">'war'</span>
	
  	<span class="n">eclipse</span> <span class="o">{</span>
		<span class="n">wtp</span> <span class="o">{</span>
			<span class="n">facet</span> <span class="o">{</span>
				<span class="n">facet</span> <span class="nl">name:</span> <span class="s1">'jst.web'</span><span class="o">,</span> <span class="nl">version:</span> <span class="s1">'3.0'</span>
				<span class="n">facet</span> <span class="nl">name:</span> <span class="s1">'jst.java'</span><span class="o">,</span> <span class="nl">version:</span> <span class="s1">'1.8'</span>
			<span class="o">}</span>
		<span class="o">}</span>
	<span class="o">}</span>
  
	<span class="n">archivesBaseName</span> <span class="o">=</span> <span class="s1">'zdemo-gradle-app'</span>
	<span class="n">description</span> <span class="o">=</span> <span class="s1">'Gradle项目模板 之 web应用模块'</span>
	
	<span class="n">dependencies</span> <span class="o">{</span>
		<span class="c1">//inner projects</span>
		<span class="n">compile</span> <span class="nf">project</span><span class="o">(</span><span class="s2">":zdemo-gradle-biz"</span><span class="o">)</span>
	<span class="o">}</span>
<span class="o">}</span>



<span class="cm">/*
 * 配置父项目任务
 */</span>
<span class="n">task</span> <span class="nf">wrapper</span><span class="o">(</span><span class="nl">type:</span><span class="n">Wrapper</span><span class="o">)</span> <span class="o">{</span>
	<span class="n">group</span> <span class="s1">'build setup'</span>
	<span class="n">description</span> <span class="s1">'初始化gradle包装器'</span>
	<span class="n">gradleVersion</span> <span class="o">=</span> <span class="s1">'3.5'</span>
<span class="o">}</span>


<span class="cm">/*
 * 配置父项目方法
 */</span>
<span class="kt">def</span> <span class="nf">loadPropertiesForDB</span><span class="o">()</span> <span class="o">{</span>	<span class="c1">//第一种扁平化参数装配方式（两种方式都返回Properties对象）</span>
	<span class="kt">def</span> <span class="n">props</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Properties</span><span class="o">()</span>
	<span class="k">new</span> <span class="nf">File</span><span class="o">(</span><span class="s2">"${rootProject.projectDir}/config/db/${profile}.properties"</span><span class="o">).</span><span class="na">withInputStream</span> <span class="o">{</span> <span class="n">stream</span> <span class="o">-&gt;</span>
		<span class="n">props</span><span class="o">.</span><span class="na">load</span><span class="o">(</span><span class="n">stream</span><span class="o">)</span>
	<span class="o">}</span>
	<span class="k">return</span> <span class="n">props</span>
<span class="o">}</span>

<span class="kt">def</span> <span class="nf">loadGroovyForDB</span><span class="o">()</span> <span class="o">{</span> 	<span class="c1">//第二种结构化参数装配方式（建议采用第二种方式）</span>
	<span class="kt">def</span> <span class="n">file</span> <span class="o">=</span> <span class="n">file</span><span class="o">(</span><span class="s2">"${rootProject.projectDir}/config/db/db.groovy"</span><span class="o">)</span>
	<span class="k">return</span> <span class="k">new</span> <span class="nf">ConfigSlurper</span><span class="o">(</span><span class="s2">"${profile}"</span><span class="o">).</span><span class="na">parse</span><span class="o">(</span><span class="n">file</span><span class="o">.</span><span class="na">toURL</span><span class="o">()).</span><span class="na">toProperties</span><span class="o">()</span>
<span class="o">}</span>
</code></pre>
</div>

<p><br /></p>

<p>config/task/hellotask.gradle</p>

<div class="language-groovy highlighter-rouge"><pre class="highlight"><code><span class="cm">/*
 * 在另一个gradle文件中通过  apply from: '../xxx/xxx.gradle'  的方式引入gradle文件
 */</span>

<span class="kd">class</span> <span class="nc">HelloTask</span> <span class="kd">extends</span> <span class="n">DefaultTask</span> <span class="o">{</span>
	<span class="nd">@Optional</span>
	<span class="n">String</span> <span class="n">message</span> <span class="o">=</span> <span class="s1">'this is message'</span> <span class="c1">//@Optional 表示在配置该Task时，message是可选的</span>
	
	<span class="nd">@TaskAction</span>
	<span class="kt">def</span> <span class="nf">hello</span><span class="o">(){</span> <span class="c1">//@TaskAction表示该Task要执行的动作,即在调用该Task时，hello()方法将被执行</span>
		<span class="n">println</span> <span class="s2">"hello world, $message"</span>
	<span class="o">}</span>
<span class="o">}</span>


<span class="n">task</span> <span class="nf">hello1</span><span class="o">(</span><span class="nl">type:</span><span class="n">HelloTask</span><span class="o">)</span>		<span class="c1">//hello使用了默认的message值</span>

<span class="n">task</span> <span class="nf">hello2</span><span class="o">(</span><span class="nl">type:</span><span class="n">HelloTask</span><span class="o">){</span>	<span class="c1">//重新设置了message的值</span>
	<span class="n">group</span> <span class="s1">'other'</span>
	<span class="n">message</span> <span class="o">=</span><span class="s2">"I am a javaee developer"</span>
<span class="o">}</span>
</code></pre>
</div>

<p><br /></p>

<p>gradle.properties</p>

<div class="language-properties highlighter-rouge"><pre class="highlight"><code><span class="c"># default profile, also -Pprofile=dev
</span><span class="py">profile</span><span class="p">=</span><span class="s">dev</span>
</code></pre>
</div>

<p><br /></p>

<p>config/plugin/dateAndTimePlugin.gradle</p>

<div class="language-groovy highlighter-rouge"><pre class="highlight"><code><span class="cm">/*
 * 自定义插件
 */</span>

<span class="kd">class</span> <span class="nc">DateAndTimePlugin</span> <span class="kd">implements</span> <span class="n">Plugin</span><span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span> <span class="o">{</span>
	
	<span class="kt">void</span> <span class="nf">apply</span><span class="o">(</span><span class="n">Project</span> <span class="n">project</span><span class="o">)</span> <span class="o">{</span>
		<span class="n">project</span><span class="o">.</span><span class="na">extensions</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s2">"dateAndTime"</span><span class="o">,</span> <span class="n">DateAndTimePluginExtension</span><span class="o">)</span> <span class="c1">//每个Gradle的Project都维护了一个ExtenionContainer,可以通过project.extentions进行访问</span>
		
		<span class="n">project</span><span class="o">.</span><span class="na">task</span><span class="o">(</span><span class="s2">"showTime"</span><span class="o">)</span> <span class="o">{</span>
			<span class="n">group</span> <span class="o">=</span> <span class="s2">"other"</span>
			<span class="n">description</span> <span class="o">=</span> <span class="s2">"显示当前时间"</span>
			
			<span class="n">doLast</span> <span class="o">{</span>
				<span class="n">println</span> <span class="s2">"current time:"</span> <span class="o">+</span> <span class="k">new</span> <span class="n">Date</span><span class="o">().</span><span class="na">format</span><span class="o">(</span><span class="n">project</span><span class="o">.</span><span class="na">dateAndTime</span><span class="o">.</span><span class="na">timeFormat</span><span class="o">)</span>
			<span class="o">}</span>
		<span class="o">}</span>
		
		<span class="n">project</span><span class="o">.</span><span class="na">task</span><span class="o">(</span><span class="s2">"showDate"</span><span class="o">)</span> <span class="o">{</span>
			<span class="n">group</span> <span class="o">=</span> <span class="s2">"other"</span>
			<span class="n">description</span> <span class="o">=</span> <span class="s2">"显示当前日期"</span>
			
			<span class="n">doLast</span> <span class="o">{</span>
				<span class="n">println</span> <span class="s2">"current date:"</span> <span class="o">+</span> <span class="k">new</span> <span class="n">Date</span><span class="o">().</span><span class="na">format</span><span class="o">(</span><span class="n">project</span><span class="o">.</span><span class="na">dateAndTime</span><span class="o">.</span><span class="na">dateFormat</span><span class="o">)</span>
			<span class="o">}</span>
		<span class="o">}</span>
	<span class="o">}</span>	
<span class="o">}</span>


<span class="kd">class</span> <span class="nc">DateAndTimePluginExtension</span> <span class="o">{</span>
	<span class="n">String</span> <span class="n">timeFormat</span> <span class="o">=</span> <span class="s2">"yyyy-MM-dd HH:mm:ss.SSS"</span>
	<span class="n">String</span> <span class="n">dateFormat</span> <span class="o">=</span> <span class="s2">"yyyy-MM-dd"</span>
<span class="o">}</span>


<span class="c1">//使用刚刚定义的插件</span>
<span class="n">apply</span> <span class="nl">plugin:</span> <span class="n">DateAndTimePlugin</span>
<span class="n">dateAndTime</span> <span class="o">{</span>
	<span class="n">timeFormat</span> <span class="o">=</span> <span class="s1">'HH:mm:ss.SSS'</span>
	<span class="n">dateFormat</span> <span class="o">=</span> <span class="s1">'MM/dd/yyyy'</span>
<span class="o">}</span>
</code></pre>
</div>

<p><br /></p>

<p>config/checkstyle/checkstyle.xml</p>

<div class="language-xml highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="cp">&lt;!DOCTYPE module PUBLIC "-//Puppy Crawl//DTD Check Configuration 1.2//EN" "http://www.puppycrawl.com/dtds/configuration_1_2.dtd"&gt;</span>

<span class="nt">&lt;module</span> <span class="na">name=</span><span class="s">"Checker"</span><span class="nt">&gt;</span>

	<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"charset"</span> <span class="na">value=</span><span class="s">"UTF-8"</span> <span class="nt">/&gt;</span>
	<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"severity"</span> <span class="na">value=</span><span class="s">"warning"</span> <span class="nt">/&gt;</span>

	<span class="c">&lt;!-- Checks for Size Violations. --&gt;</span>
	<span class="c">&lt;!-- 检查文件的长度（行） default max=2000 --&gt;</span>
	<span class="nt">&lt;module</span> <span class="na">name=</span><span class="s">"FileLength"</span><span class="nt">&gt;</span>
		<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"max"</span> <span class="na">value=</span><span class="s">"2500"</span> <span class="nt">/&gt;</span>
	<span class="nt">&lt;/module&gt;</span>

	<span class="c">&lt;!-- Checks that property files contain the same keys. --&gt;</span>
	<span class="c">&lt;!-- 检查**.properties配置文件 是否有相同的key &lt;module name="Translation"&gt; &lt;/module&gt; --&gt;</span>

	<span class="nt">&lt;module</span> <span class="na">name=</span><span class="s">"TreeWalker"</span><span class="nt">&gt;</span>

		<span class="c">&lt;!-- Checks for imports --&gt;</span>
		<span class="c">&lt;!-- 必须导入类的完整路径，即不能使用*导入所需的类 --&gt;</span>
		<span class="nt">&lt;module</span> <span class="na">name=</span><span class="s">"AvoidStarImport"</span> <span class="nt">/&gt;</span>

		<span class="c">&lt;!-- 检查是否从非法的包中导入了类 illegalPkgs: 定义非法的包名称 --&gt;</span>
		<span class="nt">&lt;module</span> <span class="na">name=</span><span class="s">"IllegalImport"</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- defaults to sun.* packages --&gt;</span>

		<span class="c">&lt;!-- 检查是否导入了不必显示导入的类 --&gt;</span>
		<span class="nt">&lt;module</span> <span class="na">name=</span><span class="s">"RedundantImport"</span> <span class="nt">/&gt;</span>

		<span class="c">&lt;!-- 检查是否导入的包没有使用 --&gt;</span>
		<span class="nt">&lt;module</span> <span class="na">name=</span><span class="s">"UnusedImports"</span> <span class="nt">/&gt;</span>

		<span class="c">&lt;!-- Checks for whitespace &lt;module name="EmptyForIteratorPad"/&gt; &lt;module 
			name="MethodParamPad"/&gt; &lt;module name="NoWhitespaceAfter"/&gt; &lt;module name="NoWhitespaceBefore"/&gt; 
			&lt;module name="OperatorWrap"/&gt; &lt;module name="ParenPad"/&gt; &lt;module name="TypecastParenPad"/&gt; 
			&lt;module name="WhitespaceAfter"/&gt; &lt;module name="WhitespaceAround"/&gt; --&gt;</span>

		<span class="c">&lt;!-- 检查类和接口的javadoc 默认不检查author 和version tags authorFormat: 检查author标签的格式 
			versionFormat: 检查version标签的格式 scope: 可以检查的类的范围，例如：public只能检查public修饰的类，private可以检查所有的类 
			excludeScope: 不能检查的类的范围，例如：public，public的类将不被检查，但访问权限小于public的类仍然会检查，其他的权限以此类推 
			tokens: 该属性适用的类型，例如：CLASS_DEF,INTERFACE_DEF --&gt;</span>
		<span class="nt">&lt;module</span> <span class="na">name=</span><span class="s">"JavadocType"</span><span class="nt">&gt;</span>
			<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"authorFormat"</span> <span class="na">value=</span><span class="s">"\S"</span> <span class="nt">/&gt;</span>
			<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"scope"</span> <span class="na">value=</span><span class="s">"protected"</span> <span class="nt">/&gt;</span>
			<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"tokens"</span> <span class="na">value=</span><span class="s">"CLASS_DEF,INTERFACE_DEF"</span> <span class="nt">/&gt;</span>
		<span class="nt">&lt;/module&gt;</span>

		<span class="c">&lt;!-- 检查方法的javadoc的注释 scope: 可以检查的方法的范围，例如：public只能检查public修饰的方法，private可以检查所有的方法 
			allowMissingParamTags: 是否忽略对参数注释的检查 allowMissingThrowsTags: 是否忽略对throws注释的检查 
			allowMissingReturnTag: 是否忽略对return注释的检查 --&gt;</span>
		<span class="nt">&lt;module</span> <span class="na">name=</span><span class="s">"JavadocMethod"</span><span class="nt">&gt;</span>
			<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"scope"</span> <span class="na">value=</span><span class="s">"private"</span> <span class="nt">/&gt;</span>
			<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"allowMissingParamTags"</span> <span class="na">value=</span><span class="s">"false"</span> <span class="nt">/&gt;</span>
			<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"allowMissingThrowsTags"</span> <span class="na">value=</span><span class="s">"false"</span> <span class="nt">/&gt;</span>
			<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"allowMissingReturnTag"</span> <span class="na">value=</span><span class="s">"false"</span> <span class="nt">/&gt;</span>
			<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"tokens"</span> <span class="na">value=</span><span class="s">"METHOD_DEF"</span> <span class="nt">/&gt;</span>
			<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"allowUndeclaredRTE"</span> <span class="na">value=</span><span class="s">"true"</span> <span class="nt">/&gt;</span>
			<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"allowThrowsTagsForSubclasses"</span> <span class="na">value=</span><span class="s">"true"</span> <span class="nt">/&gt;</span>
			<span class="c">&lt;!--允许get set 方法没有注释 --&gt;</span>
			<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"allowMissingPropertyJavadoc"</span> <span class="na">value=</span><span class="s">"true"</span> <span class="nt">/&gt;</span>
		<span class="nt">&lt;/module&gt;</span>

		<span class="c">&lt;!-- 检查类变量的注释 scope: 检查变量的范围，例如：public只能检查public修饰的变量，private可以检查所有的变量 --&gt;</span>
		<span class="nt">&lt;module</span> <span class="na">name=</span><span class="s">"JavadocVariable"</span><span class="nt">&gt;</span>
			<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"scope"</span> <span class="na">value=</span><span class="s">"private"</span> <span class="nt">/&gt;</span>
		<span class="nt">&lt;/module&gt;</span>

		<span class="c">&lt;!--option: 定义左大括号'{'显示位置，eol在同一行显示，nl在下一行显示 maxLineLength: 大括号'{'所在行行最多容纳的字符数 
			tokens: 该属性适用的类型，例：CLASS_DEF,INTERFACE_DEF,METHOD_DEF,CTOR_DEF --&gt;</span>
		<span class="nt">&lt;module</span> <span class="na">name=</span><span class="s">"LeftCurly"</span><span class="nt">&gt;</span>
			<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"option"</span> <span class="na">value=</span><span class="s">"nl"</span> <span class="nt">/&gt;</span>
		<span class="nt">&lt;/module&gt;</span>

		<span class="c">&lt;!-- NeedBraces 检查是否应该使用括号的地方没有加括号 tokens: 定义检查的类型 --&gt;</span>
		<span class="nt">&lt;module</span> <span class="na">name=</span><span class="s">"NeedBraces"</span> <span class="nt">/&gt;</span>

		<span class="c">&lt;!-- Checks the placement of right curly braces ('}') for else, try, and 
			catch tokens. The policy to verify is specified using property option. option: 
			右大括号是否单独一行显示 tokens: 定义检查的类型 --&gt;</span>
		<span class="nt">&lt;module</span> <span class="na">name=</span><span class="s">"RightCurly"</span><span class="nt">&gt;</span>
			<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"option"</span> <span class="na">value=</span><span class="s">"alone"</span> <span class="nt">/&gt;</span>
		<span class="nt">&lt;/module&gt;</span>

		<span class="c">&lt;!-- 检查在重写了equals方法后是否重写了hashCode方法 --&gt;</span>
		<span class="nt">&lt;module</span> <span class="na">name=</span><span class="s">"EqualsHashCode"</span> <span class="nt">/&gt;</span>

		<span class="c">&lt;!-- Checks for illegal instantiations where a factory method is preferred. 
			Rationale: Depending on the project, for some classes it might be preferable 
			to create instances through factory methods rather than calling the constructor. 
			A simple example is the java.lang.Boolean class. In order to save memory 
			and CPU cycles, it is preferable to use the predefined constants TRUE and 
			FALSE. Constructor invocations should be replaced by calls to Boolean.valueOf(). 
			Some extremely performance sensitive projects may require the use of factory 
			methods for other classes as well, to enforce the usage of number caches 
			or object pools. --&gt;</span>
		<span class="nt">&lt;module</span> <span class="na">name=</span><span class="s">"IllegalInstantiation"</span><span class="nt">&gt;</span>
			<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"classes"</span> <span class="na">value=</span><span class="s">"java.lang.Boolean"</span> <span class="nt">/&gt;</span>
		<span class="nt">&lt;/module&gt;</span>

		<span class="c">&lt;!-- Checks for Naming Conventions. 命名规范 --&gt;</span>
		<span class="c">&lt;!-- local, final variables, including catch parameters --&gt;</span>
		<span class="nt">&lt;module</span> <span class="na">name=</span><span class="s">"LocalFinalVariableName"</span> <span class="nt">/&gt;</span>

		<span class="c">&lt;!-- local, non-final variables, including catch parameters --&gt;</span>
		<span class="nt">&lt;module</span> <span class="na">name=</span><span class="s">"LocalVariableName"</span> <span class="nt">/&gt;</span>

		<span class="c">&lt;!-- static, non-final fields --&gt;</span>
		<span class="nt">&lt;module</span> <span class="na">name=</span><span class="s">"StaticVariableName"</span><span class="nt">&gt;</span>
			<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"format"</span> <span class="na">value=</span><span class="s">"(^[A-Z0-9_]{0,19}$)"</span> <span class="nt">/&gt;</span>
		<span class="nt">&lt;/module&gt;</span>

		<span class="c">&lt;!-- packages --&gt;</span>
		<span class="nt">&lt;module</span> <span class="na">name=</span><span class="s">"PackageName"</span><span class="nt">&gt;</span>
			<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"format"</span> <span class="na">value=</span><span class="s">"^[a-z]+(\.[a-z][a-z0-9]*)*$"</span> <span class="nt">/&gt;</span>
		<span class="nt">&lt;/module&gt;</span>

		<span class="c">&lt;!-- classes and interfaces --&gt;</span>
		<span class="nt">&lt;module</span> <span class="na">name=</span><span class="s">"TypeName"</span><span class="nt">&gt;</span>
			<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"format"</span> <span class="na">value=</span><span class="s">"(^[A-Z][a-zA-Z0-9]{0,19}$)"</span> <span class="nt">/&gt;</span>
		<span class="nt">&lt;/module&gt;</span>

		<span class="c">&lt;!-- methods --&gt;</span>
		<span class="nt">&lt;module</span> <span class="na">name=</span><span class="s">"MethodName"</span><span class="nt">&gt;</span>
			<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"format"</span> <span class="na">value=</span><span class="s">"(^[a-z][a-zA-Z0-9]{0,19}$)"</span> <span class="nt">/&gt;</span>
		<span class="nt">&lt;/module&gt;</span>

		<span class="c">&lt;!-- non-static fields --&gt;</span>
		<span class="nt">&lt;module</span> <span class="na">name=</span><span class="s">"MemberName"</span><span class="nt">&gt;</span>
			<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"format"</span> <span class="na">value=</span><span class="s">"(^[a-z][a-z0-9][a-zA-Z0-9]{0,19}$)"</span> <span class="nt">/&gt;</span>
		<span class="nt">&lt;/module&gt;</span>

		<span class="c">&lt;!-- parameters --&gt;</span>
		<span class="nt">&lt;module</span> <span class="na">name=</span><span class="s">"ParameterName"</span><span class="nt">&gt;</span>
			<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"format"</span> <span class="na">value=</span><span class="s">"(^[a-z][a-zA-Z0-9_]{0,19}$)"</span> <span class="nt">/&gt;</span>
		<span class="nt">&lt;/module&gt;</span>

		<span class="c">&lt;!-- constants (static, final fields) --&gt;</span>
		<span class="nt">&lt;module</span> <span class="na">name=</span><span class="s">"ConstantName"</span><span class="nt">&gt;</span>
			<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"format"</span> <span class="na">value=</span><span class="s">"(^[A-Z0-9_]{0,19}$)"</span> <span class="nt">/&gt;</span>
		<span class="nt">&lt;/module&gt;</span>

		<span class="c">&lt;!-- 代码缩进 --&gt;</span>
		<span class="nt">&lt;module</span> <span class="na">name=</span><span class="s">"Indentation"</span><span class="nt">&gt;</span>
		<span class="nt">&lt;/module&gt;</span>

		<span class="c">&lt;!-- Checks for redundant exceptions declared in throws clause such as 
			duplicates, unchecked exceptions or subclasses of another declared exception. 
			检查是否抛出了多余的异常 &lt;module name="RedundantThrows"&gt; &lt;property name="logLoadErrors" 
			value="true"/&gt; &lt;property name="suppressLoadErrors" value="true"/&gt; &lt;/module&gt; --&gt;</span>

		<span class="c">&lt;!-- Checks for overly complicated boolean expressions. Currently finds 
			code like if (b == true), b || true, !false, etc. 检查boolean值是否冗余的地方 Rationale: 
			Complex boolean logic makes code hard to understand and maintain. --&gt;</span>
		<span class="nt">&lt;module</span> <span class="na">name=</span><span class="s">"SimplifyBooleanExpression"</span> <span class="nt">/&gt;</span>

		<span class="c">&lt;!-- Checks for overly complicated boolean return statements. For example 
			the following code 检查是否存在过度复杂的boolean返回值 if (valid()) return false; else 
			return true; could be written as return !valid(); The Idea for this Check 
			has been shamelessly stolen from the equivalent PMD rule. --&gt;</span>
		<span class="nt">&lt;module</span> <span class="na">name=</span><span class="s">"SimplifyBooleanReturn"</span> <span class="nt">/&gt;</span>

		<span class="c">&lt;!-- Checks that a class which has only private constructors is declared 
			as final.只有私有构造器的类必须声明为final --&gt;</span>
		<span class="nt">&lt;module</span> <span class="na">name=</span><span class="s">"FinalClass"</span> <span class="nt">/&gt;</span>

		<span class="c">&lt;!-- Make sure that utility classes (classes that contain only static methods 
			or fields in their API) do not have a public constructor. 确保Utils类（只提供static方法和属性的类）没有public构造器。 
			Rationale: Instantiating utility classes does not make sense. Hence the constructors 
			should either be private or (if you want to allow subclassing) protected. 
			A common mistake is forgetting to hide the default constructor. If you make 
			the constructor protected you may want to consider the following constructor 
			implementation technique to disallow instantiating subclasses: public class 
			StringUtils // not final to allow subclassing { protected StringUtils() { 
			throw new UnsupportedOperationException(); // prevents calls from subclass 
			} public static int count(char c, String s) { // ... } } &lt;module name="HideUtilityClassConstructor"/&gt; --&gt;</span>

		<span class="c">&lt;!-- Checks visibility of class members. Only static final members may 
			be public; other class members must be private unless property protectedAllowed 
			or packageAllowed is set. 检查class成员属性可见性。只有static final 修饰的成员是可以public的。其他的成员属性必需是private的，除非属性protectedAllowed或者packageAllowed设置了true. 
			Public members are not flagged if the name matches the public member regular 
			expression (contains "^serialVersionUID$" by default). Note: Checkstyle 2 
			used to include "^f[A-Z][a-zA-Z0-9]*$" in the default pattern to allow CMP 
			for EJB 1.1 with the default settings. With EJB 2.0 it is not longer necessary 
			to have public access for persistent fields, hence the default has been changed. 
			Rationale: Enforce encapsulation. 强制封装 --&gt;</span>
		<span class="nt">&lt;module</span> <span class="na">name=</span><span class="s">"VisibilityModifier"</span> <span class="nt">/&gt;</span>

		<span class="c">&lt;!-- 每一行只能定义一个变量 --&gt;</span>
		<span class="nt">&lt;module</span> <span class="na">name=</span><span class="s">"MultipleVariableDeclarations"</span><span class="nt">&gt;</span>
		<span class="nt">&lt;/module&gt;</span>

		<span class="c">&lt;!-- Checks the style of array type definitions. Some like Java-style: 
			public static void main(String[] args) and some like C-style: public static 
			void main(String args[]) 检查再定义数组时，采用java风格还是c风格，例如：int[] num是java风格，int num[]是c风格。默认是java风格 --&gt;</span>
		<span class="nt">&lt;module</span> <span class="na">name=</span><span class="s">"ArrayTypeStyle"</span><span class="nt">&gt;</span>
		<span class="nt">&lt;/module&gt;</span>

		<span class="c">&lt;!-- Checks that there are no "magic numbers", where a magic number is 
			a numeric literal that is not defined as a constant. By default, -1, 0, 1, 
			and 2 are not considered to be magic numbers. &lt;module name="MagicNumber"&gt; 
			&lt;/module&gt; --&gt;</span>

		<span class="c">&lt;!-- A check for TODO: comments. Actually it is a generic regular expression 
			matcher on Java comments. To check for other patterns in Java comments, set 
			property format. 检查是否存在TODO（待处理） TODO是javaIDE自动生成的。一般代码写完后要去掉。 --&gt;</span>
		<span class="nt">&lt;module</span> <span class="na">name=</span><span class="s">"TodoComment"</span> <span class="nt">/&gt;</span>

		<span class="c">&lt;!-- Checks that long constants are defined with an upper ell. That is 
			' L' and not 'l'. This is in accordance to the Java Language Specification, 
			Section 3.10.1. 检查是否在long类型是否定义了大写的L.字母小写l和数字1（一）很相似。 looks a lot like 1. --&gt;</span>
		<span class="nt">&lt;module</span> <span class="na">name=</span><span class="s">"UpperEll"</span> <span class="nt">/&gt;</span>

		<span class="c">&lt;!-- Checks that switch statement has "default" clause. 检查switch语句是否有‘default’从句 
			Rationale: It's usually a good idea to introduce a default case in every 
			switch statement. Even if the developer is sure that all currently possible 
			cases are covered, this should be expressed in the default branch, e.g. by 
			using an assertion. This way the code is protected aginst later changes, 
			e.g. introduction of new types in an enumeration type. --&gt;</span>
		<span class="nt">&lt;module</span> <span class="na">name=</span><span class="s">"MissingSwitchDefault"</span> <span class="nt">/&gt;</span>

		<span class="c">&lt;!--检查switch中case后是否加入了跳出语句，例如：return、break、throw、continue --&gt;</span>
		<span class="nt">&lt;module</span> <span class="na">name=</span><span class="s">"FallThrough"</span> <span class="nt">/&gt;</span>

		<span class="c">&lt;!-- Checks the number of parameters of a method or constructor. max default 
			7个. --&gt;</span>
		<span class="nt">&lt;module</span> <span class="na">name=</span><span class="s">"ParameterNumber"</span><span class="nt">&gt;</span>
			<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"max"</span> <span class="na">value=</span><span class="s">"5"</span> <span class="nt">/&gt;</span>
		<span class="nt">&lt;/module&gt;</span>

		<span class="c">&lt;!-- 每行字符数 --&gt;</span>
		<span class="nt">&lt;module</span> <span class="na">name=</span><span class="s">"LineLength"</span><span class="nt">&gt;</span>
			<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"max"</span> <span class="na">value=</span><span class="s">"200"</span> <span class="nt">/&gt;</span>
		<span class="nt">&lt;/module&gt;</span>

		<span class="c">&lt;!-- Checks for long methods and constructors. max default 150行. max=300 
			设置长度300 --&gt;</span>
		<span class="nt">&lt;module</span> <span class="na">name=</span><span class="s">"MethodLength"</span><span class="nt">&gt;</span>
			<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"max"</span> <span class="na">value=</span><span class="s">"300"</span> <span class="nt">/&gt;</span>
		<span class="nt">&lt;/module&gt;</span>

		<span class="c">&lt;!-- ModifierOrder 检查修饰符的顺序，默认是 public,protected,private,abstract,static,final,transient,volatile,synchronized,native --&gt;</span>
		<span class="nt">&lt;module</span> <span class="na">name=</span><span class="s">"ModifierOrder"</span><span class="nt">&gt;</span>
		<span class="nt">&lt;/module&gt;</span>

		<span class="c">&lt;!-- 检查是否有多余的修饰符，例如：接口中的方法不必使用public、abstract修饰 --&gt;</span>
		<span class="nt">&lt;module</span> <span class="na">name=</span><span class="s">"RedundantModifier"</span><span class="nt">&gt;</span>
		<span class="nt">&lt;/module&gt;</span>

		<span class="c">&lt;!--- 字符串比较必须使用 equals() --&gt;</span>
		<span class="nt">&lt;module</span> <span class="na">name=</span><span class="s">"StringLiteralEquality"</span><span class="nt">&gt;</span>
		<span class="nt">&lt;/module&gt;</span>

		<span class="c">&lt;!-- if-else嵌套语句个数 最多4层 --&gt;</span>
		<span class="nt">&lt;module</span> <span class="na">name=</span><span class="s">"NestedIfDepth"</span><span class="nt">&gt;</span>
			<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"max"</span> <span class="na">value=</span><span class="s">"3"</span> <span class="nt">/&gt;</span>
		<span class="nt">&lt;/module&gt;</span>

		<span class="c">&lt;!-- try-catch 嵌套语句个数 最多2层 --&gt;</span>
		<span class="nt">&lt;module</span> <span class="na">name=</span><span class="s">"NestedTryDepth"</span><span class="nt">&gt;</span>
			<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"max"</span> <span class="na">value=</span><span class="s">"2"</span> <span class="nt">/&gt;</span>
		<span class="nt">&lt;/module&gt;</span>

		<span class="c">&lt;!-- 返回个数 --&gt;</span>
		<span class="nt">&lt;module</span> <span class="na">name=</span><span class="s">"ReturnCount"</span><span class="nt">&gt;</span>
			<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"max"</span> <span class="na">value=</span><span class="s">"5"</span> <span class="nt">/&gt;</span>
			<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"format"</span> <span class="na">value=</span><span class="s">"^$"</span> <span class="nt">/&gt;</span>
		<span class="nt">&lt;/module&gt;</span>

	<span class="nt">&lt;/module&gt;</span>
<span class="nt">&lt;/module&gt;</span>
</code></pre>
</div>

<p><br /></p>

<p>config/db/db.groovy</p>

<div class="language-groovy highlighter-rouge"><pre class="highlight"><code><span class="n">environments</span> <span class="o">{</span>
	<span class="n">dev</span> <span class="o">{</span>
		<span class="n">mongodb</span> <span class="o">{</span>
			<span class="n">replicaSet</span> <span class="o">=</span> <span class="s1">'dbserver:27017'</span>
			<span class="n">demo</span><span class="o">.</span><span class="na">username</span> <span class="o">=</span> <span class="s1">'demo'</span>
			<span class="n">demo</span><span class="o">.</span><span class="na">password</span> <span class="o">=</span> <span class="s1">'23wesdxc'</span>
		<span class="o">}</span>
	<span class="o">}</span>
 
	<span class="n">test</span> <span class="o">{</span>
		<span class="n">mongodb</span> <span class="o">{</span>
			<span class="n">replicaSet</span> <span class="o">=</span> <span class="s1">'dbserver:27017'</span>
			<span class="n">demo</span><span class="o">.</span><span class="na">username</span> <span class="o">=</span> <span class="s1">'demo'</span>
			<span class="n">demo</span><span class="o">.</span><span class="na">password</span> <span class="o">=</span> <span class="s1">'23wesdxc'</span>
		<span class="o">}</span>
	<span class="o">}</span>
 
	<span class="n">prod</span> <span class="o">{</span>
		<span class="n">mongodb</span> <span class="o">{</span>
			<span class="n">replicaSet</span> <span class="o">=</span> <span class="s1">'dbserver:27017'</span>
			<span class="n">demo</span><span class="o">.</span><span class="na">username</span> <span class="o">=</span> <span class="s1">'demo'</span>
			<span class="n">demo</span><span class="o">.</span><span class="na">password</span> <span class="o">=</span> <span class="s1">'23wesdxc'</span>
		<span class="o">}</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<p>config/db/dev.properties</p>

<div class="language-properties highlighter-rouge"><pre class="highlight"><code><span class="py">mongodb.replicaSet</span> <span class="p">=</span> <span class="s">[dev]jdbc.url111</span>
<span class="py">mongodb.demo.username</span> <span class="p">=</span> <span class="s">[dev]jdbc.user</span>
<span class="py">mongodb.demo.password</span> <span class="p">=</span> <span class="s">[dev]jdbc.password</span>
</code></pre>
</div>

<p>config/db/test.properties</p>

<div class="language-properties highlighter-rouge"><pre class="highlight"><code><span class="py">mongodb.replicaSet</span> <span class="p">=</span> <span class="s">[test]jdbc.url111</span>
<span class="py">mongodb.demo.username</span> <span class="p">=</span> <span class="s">[test]jdbc.user</span>
<span class="py">mongodb.demo.password</span> <span class="p">=</span> <span class="s">[test]jdbc.password</span>
</code></pre>
</div>

<p>config/db/prod.properties</p>

<div class="language-properties highlighter-rouge"><pre class="highlight"><code><span class="py">mongodb.replicaSet</span> <span class="p">=</span> <span class="s">[prod]jdbc.url111</span>
<span class="py">mongodb.demo.username</span> <span class="p">=</span> <span class="s">[prod]jdbc.user</span>
<span class="py">mongodb.demo.password</span> <span class="p">=</span> <span class="s">[prod]jdbc.password</span>
</code></pre>
</div>

<p><br /></p>

<h4 id="zdemo-gradle-model">zdemo-gradle-model</h4>

<p>src/main/java/com/keyllo/model/mongo/demo/Demopo.java</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">keyllo</span><span class="o">.</span><span class="na">model</span><span class="o">.</span><span class="na">mongo</span><span class="o">.</span><span class="na">demo</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.data.annotation.Id</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.annotation.Transient</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.mongodb.core.index.CompoundIndex</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.mongodb.core.index.CompoundIndexes</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.mongodb.core.index.Indexed</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.mongodb.core.index.TextIndexed</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.mongodb.core.mapping.Document</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.mongodb.core.mapping.TextScore</span><span class="o">;</span>

<span class="cm">/**
 * mongodb持久化模板对象
 * @author zhangqingli
 *
 * @param &lt;T&gt;
 */</span>
<span class="nd">@Document</span><span class="o">(</span><span class="n">collection</span><span class="o">=</span><span class="s">"demopo"</span><span class="o">)</span>
<span class="nd">@CompoundIndexes</span><span class="o">({</span>
	<span class="nd">@CompoundIndex</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">"name_nickname_index"</span><span class="o">,</span> <span class="n">def</span><span class="o">=</span><span class="s">"{name:1, nickname:-1}"</span><span class="o">)</span>
<span class="o">})</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Demopo</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">{</span>
	<span class="cm">/*
	 * fields
	 */</span>
	<span class="nd">@Id</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">id</span><span class="o">;</span>
   
	<span class="nd">@Indexed</span><span class="o">(</span><span class="n">unique</span><span class="o">=</span><span class="kc">false</span><span class="o">)</span>
	<span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
    <span class="nd">@Transient</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">nickname</span><span class="o">;</span>
    
    <span class="nd">@TextIndexed</span><span class="o">(</span><span class="n">weight</span><span class="o">=</span><span class="mi">2</span><span class="o">)</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">title</span><span class="o">;</span>
    <span class="nd">@TextIndexed</span> 
    <span class="kd">private</span> <span class="n">String</span> <span class="n">content</span><span class="o">;</span>
    <span class="nd">@TextScore</span>
    <span class="kd">private</span> <span class="n">Float</span> <span class="n">score</span><span class="o">;</span>
    
    <span class="kd">private</span> <span class="n">T</span> <span class="n">unknownTypeData</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">Date</span> <span class="n">createTime</span><span class="o">;</span>

    
    <span class="cm">/*
     * getter &amp; setter
     */</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">getId</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">id</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setId</span><span class="o">(</span><span class="n">String</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="n">String</span> <span class="nf">getName</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">name</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setName</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="n">String</span> <span class="nf">getNickname</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">nickname</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setNickname</span><span class="o">(</span><span class="n">String</span> <span class="n">nickname</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">nickname</span> <span class="o">=</span> <span class="n">nickname</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="n">String</span> <span class="nf">getTitle</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">title</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setTitle</span><span class="o">(</span><span class="n">String</span> <span class="n">title</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">title</span> <span class="o">=</span> <span class="n">title</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="n">String</span> <span class="nf">getContent</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">content</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setContent</span><span class="o">(</span><span class="n">String</span> <span class="n">content</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">content</span> <span class="o">=</span> <span class="n">content</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="n">Float</span> <span class="nf">getScore</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">score</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setScore</span><span class="o">(</span><span class="n">Float</span> <span class="n">score</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">score</span> <span class="o">=</span> <span class="n">score</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="n">T</span> <span class="nf">getUnknownTypeData</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">unknownTypeData</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setUnknownTypeData</span><span class="o">(</span><span class="n">T</span> <span class="n">unknownTypeData</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">unknownTypeData</span> <span class="o">=</span> <span class="n">unknownTypeData</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="n">Date</span> <span class="nf">getCreateTime</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">createTime</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setCreateTime</span><span class="o">(</span><span class="n">Date</span> <span class="n">createTime</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">createTime</span> <span class="o">=</span> <span class="n">createTime</span><span class="o">;</span>
	<span class="o">}</span>

	
	<span class="cm">/*
	 * override methods
	 */</span>
	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="s">"DemoMogoPo [id="</span> <span class="o">+</span> <span class="n">id</span> <span class="o">+</span> <span class="s">", name="</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s">", nickname="</span>
				<span class="o">+</span> <span class="n">nickname</span> <span class="o">+</span> <span class="s">", title="</span> <span class="o">+</span> <span class="n">title</span> <span class="o">+</span> <span class="s">", content="</span> <span class="o">+</span> <span class="n">content</span>
				<span class="o">+</span> <span class="s">", score="</span> <span class="o">+</span> <span class="n">score</span> <span class="o">+</span> <span class="s">", unknownTypeData="</span> <span class="o">+</span> <span class="n">unknownTypeData</span>
				<span class="o">+</span> <span class="s">", createTime="</span> <span class="o">+</span> <span class="n">createTime</span> <span class="o">+</span> <span class="s">"]"</span><span class="o">;</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<p><br /></p>

<p>src/main/java/com/keyllo/model/mongo/demo/TypeData.java</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">keyllo</span><span class="o">.</span><span class="na">model</span><span class="o">.</span><span class="na">mongo</span><span class="o">.</span><span class="na">demo</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.Arrays</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Set</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.data.mongodb.core.index.Indexed</span><span class="o">;</span>

<span class="cm">/**
 * T
 * @author zhangqingli
 *
 */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TypeData</span> <span class="o">{</span>
	<span class="nd">@Indexed</span>
	<span class="kd">private</span> <span class="n">Date</span> <span class="n">date</span><span class="o">;</span>
	<span class="kd">private</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">map</span><span class="o">;</span>
	<span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">;</span>
	<span class="kd">private</span> <span class="n">Set</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">set</span><span class="o">;</span>
	<span class="kd">private</span> <span class="n">Integer</span><span class="o">[]</span> <span class="n">array</span><span class="o">;</span>
	
	
	<span class="kd">public</span> <span class="n">Date</span> <span class="nf">getDate</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">date</span><span class="o">;</span>
	<span class="o">}</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setDate</span><span class="o">(</span><span class="n">Date</span> <span class="n">date</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">date</span> <span class="o">=</span> <span class="n">date</span><span class="o">;</span>
	<span class="o">}</span>
	<span class="kd">public</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="nf">getMap</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">map</span><span class="o">;</span>
	<span class="o">}</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setMap</span><span class="o">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">map</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">map</span> <span class="o">=</span> <span class="n">map</span><span class="o">;</span>
	<span class="o">}</span>
	<span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="nf">getList</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">list</span><span class="o">;</span>
	<span class="o">}</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setList</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">list</span> <span class="o">=</span> <span class="n">list</span><span class="o">;</span>
	<span class="o">}</span>
	<span class="kd">public</span> <span class="n">Set</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">getSet</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">set</span><span class="o">;</span>
	<span class="o">}</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setSet</span><span class="o">(</span><span class="n">Set</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">set</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">set</span> <span class="o">=</span> <span class="n">set</span><span class="o">;</span>
	<span class="o">}</span>
	<span class="kd">public</span> <span class="n">Integer</span><span class="o">[]</span> <span class="nf">getArray</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">array</span><span class="o">;</span>
	<span class="o">}</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setArray</span><span class="o">(</span><span class="n">Integer</span><span class="o">[]</span> <span class="n">array</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">array</span> <span class="o">=</span> <span class="n">array</span><span class="o">;</span>
	<span class="o">}</span>

	
	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="s">"TypeData [date="</span> <span class="o">+</span> <span class="n">date</span> <span class="o">+</span> <span class="s">", map="</span> <span class="o">+</span> <span class="n">map</span> <span class="o">+</span> <span class="s">", list="</span> <span class="o">+</span> <span class="n">list</span>
				<span class="o">+</span> <span class="s">", set="</span> <span class="o">+</span> <span class="n">set</span> <span class="o">+</span> <span class="s">", array="</span> <span class="o">+</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">array</span><span class="o">)</span> <span class="o">+</span> <span class="s">"]"</span><span class="o">;</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<p><br /></p>

<h4 id="zdemo-gradle-dao">zdemo-gradle-dao</h4>

<p>src/main/java/com/keyllo/dao/mongo/demo/DemopoRepository.java</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">keyllo</span><span class="o">.</span><span class="na">dao</span><span class="o">.</span><span class="na">mongo</span><span class="o">.</span><span class="na">demo</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.data.domain.Page</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.domain.Pageable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.mongodb.repository.MongoRepository</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.mongodb.repository.Query</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.keyllo.model.mongo.demo.Demopo</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.keyllo.model.mongo.demo.TypeData</span><span class="o">;</span>

<span class="cm">/**
 * DemopoRepository
 * @author zhangqingli
 *
 */</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">DemopoRepository</span> <span class="kd">extends</span> <span class="n">MongoRepository</span><span class="o">&lt;</span><span class="n">Demopo</span><span class="o">&lt;</span><span class="n">TypeData</span><span class="o">&gt;,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="o">{</span>
	
	<span class="n">List</span><span class="o">&lt;</span><span class="n">Demopo</span><span class="o">&lt;</span><span class="n">TypeData</span><span class="o">&gt;&gt;</span> <span class="nf">findByName</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">);</span>
	<span class="n">List</span><span class="o">&lt;</span><span class="n">Demopo</span><span class="o">&lt;</span><span class="n">TypeData</span><span class="o">&gt;&gt;</span> <span class="nf">findByNameAndNickname</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="n">String</span> <span class="n">nickname</span><span class="o">);</span>
    <span class="n">Page</span><span class="o">&lt;</span><span class="n">Demopo</span><span class="o">&lt;</span><span class="n">TypeData</span><span class="o">&gt;&gt;</span> <span class="nf">findByName</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="n">Pageable</span> <span class="n">pageable</span><span class="o">);</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">Demopo</span><span class="o">&lt;</span><span class="n">TypeData</span><span class="o">&gt;&gt;</span> <span class="nf">findByCreateTimeAfter</span><span class="o">(</span><span class="n">Date</span> <span class="n">date</span><span class="o">);</span>
   
    
    <span class="nd">@Query</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">"{createTime:{$gt: ?0}}"</span><span class="o">)</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">Demopo</span><span class="o">&lt;</span><span class="n">TypeData</span><span class="o">&gt;&gt;</span> <span class="nf">findByCreateTimeAfter2</span><span class="o">(</span><span class="n">Date</span> <span class="n">date</span><span class="o">);</span>
    
    <span class="nd">@Query</span><span class="o">(</span><span class="s">"{$or:[{name: ?0}, {name: ?1}]}"</span><span class="o">)</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">Demopo</span><span class="o">&lt;</span><span class="n">TypeData</span><span class="o">&gt;&gt;</span> <span class="nf">customFind1</span><span class="o">(</span><span class="n">String</span> <span class="n">name1</span><span class="o">,</span> <span class="n">String</span> <span class="n">name2</span><span class="o">);</span>
    
    
    <span class="n">List</span><span class="o">&lt;</span><span class="n">Demopo</span><span class="o">&lt;</span><span class="n">TypeData</span><span class="o">&gt;&gt;</span> <span class="nf">textSearch</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">keywords</span><span class="o">,</span> <span class="kt">int</span> <span class="n">pageNum</span><span class="o">,</span> <span class="kt">int</span> <span class="n">pageSize</span><span class="o">);</span>
<span class="o">}</span>
</code></pre>
</div>

<p><br /></p>

<p>src/main/java/com/keyllo/dao/mongo/demo/DemopoRepositoryImpl.java</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">keyllo</span><span class="o">.</span><span class="na">dao</span><span class="o">.</span><span class="na">mongo</span><span class="o">.</span><span class="na">demo</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Qualifier</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.domain.PageRequest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.mongodb.core.MongoTemplate</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.mongodb.core.query.Query</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.mongodb.core.query.TextCriteria</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.mongodb.core.query.TextQuery</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.keyllo.model.mongo.demo.Demopo</span><span class="o">;</span>

<span class="cm">/**
 * DemopoRepositoryImpl
 * repository-impl-postfix="Impl"
 * @author zhangqingli
 *
 */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DemopoRepositoryImpl</span> <span class="o">{</span>

	<span class="nd">@Autowired</span>
	<span class="nd">@Qualifier</span><span class="o">(</span><span class="s">"demoMongoTemplate"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="n">MongoTemplate</span> <span class="n">mongoTemplate</span><span class="o">;</span>
	
	
	<span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">"rawtypes"</span><span class="o">)</span>
	<span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Demopo</span><span class="o">&gt;</span> <span class="nf">textSearch</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">keywords</span><span class="o">,</span> <span class="kt">int</span> <span class="n">pageNum</span><span class="o">,</span> <span class="kt">int</span> <span class="n">pageSize</span><span class="o">)</span> <span class="o">{</span>
		<span class="n">TextCriteria</span> <span class="n">textCriteria</span> <span class="o">=</span> <span class="n">TextCriteria</span><span class="o">.</span><span class="na">forDefaultLanguage</span><span class="o">().</span><span class="na">matchingAny</span><span class="o">(</span><span class="n">keywords</span><span class="o">);</span>
		<span class="n">Query</span> <span class="n">query</span> <span class="o">=</span> <span class="n">TextQuery</span><span class="o">.</span><span class="na">queryText</span><span class="o">(</span><span class="n">textCriteria</span><span class="o">).</span><span class="na">sortByScore</span><span class="o">().</span><span class="na">with</span><span class="o">(</span> <span class="k">new</span> <span class="n">PageRequest</span><span class="o">(</span><span class="n">pageNum</span><span class="o">-</span><span class="mi">1</span><span class="o">,</span> <span class="n">pageSize</span><span class="o">));</span>
		<span class="k">return</span> <span class="n">mongoTemplate</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="n">query</span><span class="o">,</span> <span class="n">Demopo</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<p><br /></p>

<p>src/main/resources/applicationContext-dao.xml</p>

<div class="language-xml highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">"http://www.springframework.org/schema/beans"</span>
	<span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
	<span class="na">xmlns:aop=</span><span class="s">"http://www.springframework.org/schema/aop"</span>
	<span class="na">xmlns:context=</span><span class="s">"http://www.springframework.org/schema/context"</span>
	<span class="na">xmlns:mybatis-spring=</span><span class="s">"http://mybatis.org/schema/mybatis-spring"</span>
	<span class="na">xmlns:p=</span><span class="s">"http://www.springframework.org/schema/p"</span>
	<span class="na">xmlns:tx=</span><span class="s">"http://www.springframework.org/schema/tx"</span>
	<span class="na">xmlns:mongo=</span><span class="s">"http://www.springframework.org/schema/data/mongo"</span>
	<span class="na">xsi:schemaLocation=</span><span class="s">"http://www.springframework.org/schema/data/mongo</span> <span class="err">http://www.springframework.org/schema/data/mongo/spring-mongo-1.10.2.xsd</span>
		<span class="err">http://www.springframework.org/schema/aop</span> <span class="err">http://www.springframework.org/schema/aop/spring-aop-4.3.xsd</span>
		<span class="err">http://www.springframework.org/schema/beans</span> <span class="err">http://www.springframework.org/schema/beans/spring-beans.xsd</span>
		<span class="err">http://mybatis.org/schema/mybatis-spring</span> <span class="err">http://mybatis.org/schema/mybatis-spring-1.2.xsd</span>
		<span class="err">http://www.springframework.org/schema/tx</span> <span class="err">http://www.springframework.org/schema/tx/spring-tx-4.3.xsd</span>
		<span class="err">http://www.springframework.org/schema/context</span> <span class="err">http://www.springframework.org/schema/context/spring-context-4.3.xsd"</span><span class="nt">&gt;</span>
	
	<span class="c">&lt;!-- 引入外部配置参数 --&gt;</span>
	<span class="nt">&lt;context:property-placeholder</span> <span class="na">location=</span><span class="s">"classpath:db.properties"</span><span class="nt">/&gt;</span>


	<span class="c">&lt;!-- 配置扫描组件包 --&gt;</span>
	<span class="nt">&lt;context:component-scan</span> <span class="na">base-package=</span><span class="s">"com.keyllo.dao,com.keyllo.model"</span><span class="nt">&gt;</span>
		<span class="nt">&lt;context:exclude-filter</span> <span class="na">type=</span><span class="s">"annotation"</span> <span class="na">expression=</span><span class="s">"org.springframework.stereotype.Controller"</span> <span class="nt">/&gt;</span>
	<span class="nt">&lt;/context:component-scan&gt;</span>
	
	
	
	<span class="c">&lt;!-- mongodb --&gt;</span>
	<span class="c">&lt;!-- ========================================================== --&gt;</span>
	<span class="c">&lt;!-- mongodb datasource --&gt;</span>
	<span class="nt">&lt;mongo:mongo</span> <span class="na">id=</span><span class="s">"mongo"</span> <span class="na">replica-set=</span><span class="s">"${mongo.replicaSet}"</span><span class="nt">&gt;</span>
         <span class="nt">&lt;mongo:options</span>  
	        <span class="na">connections-per-host=</span><span class="s">"${mongo.connectionsPerHost}"</span>  
	        <span class="na">threads-allowed-to-block-for-connection-multiplier=</span><span class="s">"${mongo.threadsAllowedToBlockForConnectionMultiplier}"</span>  
	        <span class="na">connect-timeout=</span><span class="s">"${mongo.connectTimeout}"</span>   
	        <span class="na">max-wait-time=</span><span class="s">"${mongo.maxWaitTime}"</span>  
	        <span class="na">auto-connect-retry=</span><span class="s">"${mongo.autoConnectRetry}"</span>   
	        <span class="na">socket-keep-alive=</span><span class="s">"${mongo.socketKeepAlive}"</span>  
	        <span class="na">socket-timeout=</span><span class="s">"${mongo.socketTimeout}"</span>  
	        <span class="na">slave-ok=</span><span class="s">"${mongo.slaveOk}"</span>  
	        <span class="na">write-number=</span><span class="s">"${mongo.writeNumber}"</span>  
	        <span class="na">write-timeout=</span><span class="s">"${mongo.riteTimeout}"</span>  
	        <span class="na">write-fsync=</span><span class="s">"${mongo.writeFsync}"</span><span class="nt">/&gt;</span>
	<span class="nt">&lt;/mongo:mongo&gt;</span>
	
	<span class="c">&lt;!-- response_info库 --&gt;</span>
	<span class="nt">&lt;mongo:db-factory</span> <span class="na">id=</span><span class="s">"demoMongoDbFactory"</span> <span class="na">dbname=</span><span class="s">"demo"</span> <span class="na">mongo-ref=</span><span class="s">"mongo"</span> <span class="na">username=</span><span class="s">"${demo.username}"</span> <span class="na">password=</span><span class="s">"${demo.password}"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;mongo:template</span> <span class="na">id=</span><span class="s">"demoMongoTemplate"</span> <span class="na">db-factory-ref=</span><span class="s">"demoMongoDbFactory"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;mongo:repositories</span> 
    	<span class="na">base-package=</span><span class="s">"com.keyllo.dao.mongo.demo"</span> 
    	<span class="na">mongo-template-ref=</span><span class="s">"demoMongoTemplate"</span> 
    	<span class="na">repository-impl-postfix=</span><span class="s">"Impl"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/beans&gt;</span>
</code></pre>
</div>

<p><br /></p>

<p>src/main/resources/db.properties</p>

<div class="language-properties highlighter-rouge"><pre class="highlight"><code><span class="c"># mongodb
</span><span class="py">mongo.replicaSet</span><span class="p">=</span><span class="s">@mongodb.replicaSet@</span>
<span class="py">mongo.connectionsPerHost</span><span class="p">=</span><span class="s">8 </span>
<span class="py">mongo.threadsAllowedToBlockForConnectionMultiplier</span><span class="p">=</span><span class="s">4</span>
<span class="py">mongo.connectTimeout</span><span class="p">=</span><span class="s">1000</span>
<span class="py">mongo.maxWaitTime</span><span class="p">=</span><span class="s">1500</span>
<span class="py">mongo.autoConnectRetry</span><span class="p">=</span><span class="s">true</span>
<span class="py">mongo.socketKeepAlive</span><span class="p">=</span><span class="s">true </span>
<span class="py">mongo.socketTimeout</span><span class="p">=</span><span class="s">1500</span>
<span class="py">mongo.slaveOk</span><span class="p">=</span><span class="s">true</span>
<span class="py">mongo.writeNumber</span><span class="p">=</span><span class="s">1</span>
<span class="py">mongo.riteTimeout</span><span class="p">=</span><span class="s">0</span>
<span class="py">mongo.writeFsync</span><span class="p">=</span><span class="s">true</span>

<span class="c"># demo database
</span><span class="py">demo.username</span><span class="p">=</span><span class="s">@mongodb.demo.username@</span>
<span class="py">demo.password</span><span class="p">=</span><span class="s">@mongodb.demo.password@</span>
</code></pre>
</div>

<p><br /></p>

<p>src/main/resources/log4j.properties</p>

<div class="language-properties highlighter-rouge"><pre class="highlight"><code><span class="c">#
</span><span class="py">project.name</span><span class="p">=</span><span class="s">zdemo-gradle-dao</span>
<span class="py">fileout.path</span><span class="p">=</span><span class="s">/tmp/mytmp/logs</span>
<span class="c">#
</span><span class="py">log4j.rootLogger</span><span class="p">=</span><span class="s">info, STDOUT, FILEOUT</span>
<span class="py">log4j.logger.org.springframework.data.mongodb.core</span><span class="p">=</span><span class="s">MONGODB </span>

<span class="py">log4j.appender.STDOUT</span><span class="p">=</span><span class="s">org.apache.log4j.ConsoleAppender</span>
<span class="py">log4j.appender.STDOUT.encoding</span><span class="p">=</span><span class="s">UTF-8</span>
<span class="py">log4j.appender.STDOUT.layout</span><span class="p">=</span><span class="s">org.apache.log4j.PatternLayout</span>
<span class="py">log4j.appender.STDOUT.layout.ConversionPattern</span><span class="p">=</span><span class="s">[${project.name}] [%-5p] [%d] [%-3r] %l [%t,%x] %n  - %m%n</span>

<span class="py">log4j.appender.FILEOUT</span><span class="p">=</span><span class="s">org.apache.log4j.DailyRollingFileAppender   </span>
<span class="py">log4j.appender.FILEOUT.File</span><span class="p">=</span><span class="s">${fileout.path}/${project.name}.log</span>
<span class="py">log4j.appender.FILEOUT.encoding</span><span class="p">=</span><span class="s">UTF-8</span>
<span class="py">log4j.appender.FILEOUT.layout</span><span class="p">=</span><span class="s">org.apache.log4j.PatternLayout</span>
<span class="py">log4j.appender.FILEOUT.layout.ConversionPattern</span><span class="p">=</span><span class="s">[${project.name}] [%-5p] [%d] [%-3r] %l [%t,%x] %n %m%n</span>

<span class="c">#log4j.appender.FILEOUT=org.apache.log4j.RollingFileAppender
#log4j.appender.FILEOUT.File=${fileout.path}/${project.name}.log
#log4j.appender.FILEOUT.MaxFileSize=5MB
#log4j.appender.FILEOUT.MaxBackupIndex=10
#log4j.appender.FILEOUT.encoding=UTF-8
#log4j.appender.FILEOUT.layout=org.apache.log4j.PatternLayout
#log4j.appender.FILEOUT.layout.ConversionPattern=[${project.name}] [%-5p] [%d] [%-3r] %l [%t,%x] %n %m%n
</span>

<span class="c">#----------------------------------------
#org.apache.log4j.ConsoleAppender
#org.apache.log4j.FileAppender
#org.apache.log4j.DailyRollingFileAppender
#org.apache.log4j.RollingFileAppender
#org.apache.log4j.WriterAppender
</span>
<span class="c">#log4j.appender.FILEOUT.MaxFileSize=5MB    the maxFileSize is 5M
#log4j.appender.FILEOUT.MaxBackupIndex=10  save the lastest 10 files
</span>
<span class="c"># %m  the logger.info msg
# %p  DEBUG INFO WARN ERROR FATAL
# %r  time from app starting milliseconds 
# %c  log's location class
# %t  log's thread name
# %n  enter char
# %d  log's date and time
# %l  log's location class, thread name and the line number in code
</span></code></pre>
</div>

<p><br /></p>

<p>src/test/java/test01/mongodemo/DomopoTest.java</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">test01</span><span class="o">.</span><span class="na">mongodemo</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.Arrays</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.HashMap</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.HashSet</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.junit.Test</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.junit.runner.RunWith</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.test.context.ContextConfiguration</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.test.context.junit4.SpringJUnit4ClassRunner</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.keyllo.dao.mongo.demo.DemopoRepository</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.keyllo.model.mongo.demo.Demopo</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.keyllo.model.mongo.demo.TypeData</span><span class="o">;</span>

<span class="cm">/**
 * DomopoTest
 * @author zhangqingli
 *
 * 1. 对于gradle测试，gradle加载测试资源默认从 build/resources 目录中进行加载，
 *    优先从 test 目录下进行加载资源，若test目录中不存在则再从main目录下进行加载
 *    
 * 2. 对于eclipse来说，src/main和src/test都是源码目录，因此代码和资源的编译路径都是bin目录，
 * 	  加载的资源到底是src/main资源还是src/test资源，取决于最后编译的到底是哪个环境的资源，所以
 *    若果想要在eclipse中直接运行 @Test 注释的测试方法，需要保证src/test测试资源被编译到bin目录，
 *    而不是带 占位符@ 的src/main源码资源被最后编译到bin目录下
 * 
 * 		task copyResourcesToEclipseBin(type:Copy) {
 *			group 'other'
 *			description '拷贝资源文件到eclipse bin目录下'
 *		
 *			from "${buildDir}/resources/main"
 *			into "${projectDir}/bin"
 *			include('** / *.xml', '** /*.properties')
 *		}
 *
 * 那么gradle是如何发现测试代码的呢？
 * 以下条件只要满足其中之一，就会被gradle当成测试代码：
 * 1. 继承junit.framework.TestCase 或 groovy.util.GroovyTestCase的类
 * 2. 任何被 @RunWith 注解的类
 * 3. 任何至少包含一个被 @Test 注解的类
 * 
 */</span>
<span class="nd">@RunWith</span><span class="o">(</span><span class="n">SpringJUnit4ClassRunner</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="nd">@ContextConfiguration</span><span class="o">(</span><span class="n">locations</span><span class="o">={</span> 
		<span class="s">"classpath:/applicationContext-dao.xml"</span><span class="o">,</span>
		<span class="c1">//"file:build/resources/main/applicationContext-dao.xml"</span>
<span class="o">})</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DomopoTest</span> <span class="o">{</span>
	
	<span class="nd">@Autowired</span>
	<span class="kd">private</span> <span class="n">DemopoRepository</span> <span class="n">demopoRepository</span><span class="o">;</span>
	
	
	<span class="nd">@Test</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">init</span><span class="o">()</span> <span class="o">{</span>
		<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"=========================init================================="</span><span class="o">);</span>
	<span class="o">}</span>
	
	<span class="nd">@Test</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">testSave</span><span class="o">()</span> <span class="o">{</span>
		<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"=========================testSave================================="</span><span class="o">);</span>
		<span class="n">Demopo</span><span class="o">&lt;</span><span class="n">TypeData</span><span class="o">&gt;</span> <span class="n">demopo</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Demopo</span><span class="o">&lt;</span><span class="n">TypeData</span><span class="o">&gt;();</span>
		<span class="n">demopo</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">"张三"</span><span class="o">);</span>
		<span class="n">demopo</span><span class="o">.</span><span class="na">setNickname</span><span class="o">(</span><span class="s">"阿三"</span><span class="o">);</span>
		<span class="n">demopo</span><span class="o">.</span><span class="na">setTitle</span><span class="o">(</span><span class="s">"gradle 学习指南一"</span><span class="o">);</span>
		<span class="n">demopo</span><span class="o">.</span><span class="na">setContent</span><span class="o">(</span><span class="s">"this is demo01 of gradle!"</span><span class="o">);</span>
		<span class="n">demopo</span><span class="o">.</span><span class="na">setScore</span><span class="o">(</span><span class="mf">98.7f</span><span class="o">);</span>
		<span class="n">demopo</span><span class="o">.</span><span class="na">setCreateTime</span><span class="o">(</span><span class="k">new</span> <span class="n">Date</span><span class="o">());</span>
		
		<span class="n">TypeData</span> <span class="n">unknownTypeData</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TypeData</span><span class="o">();</span>
		<span class="n">demopo</span><span class="o">.</span><span class="na">setUnknownTypeData</span><span class="o">(</span><span class="n">unknownTypeData</span><span class="o">);</span>
		<span class="n">unknownTypeData</span><span class="o">.</span><span class="na">setDate</span><span class="o">(</span><span class="k">new</span> <span class="n">Date</span><span class="o">());</span>
		<span class="n">unknownTypeData</span><span class="o">.</span><span class="na">setArray</span><span class="o">(</span><span class="k">new</span> <span class="n">Integer</span><span class="o">[]{</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">3</span><span class="o">});</span>
		<span class="n">unknownTypeData</span><span class="o">.</span><span class="na">setList</span><span class="o">(</span><span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="k">new</span> <span class="n">Integer</span><span class="o">[]{</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">3</span><span class="o">}));</span>
		<span class="n">unknownTypeData</span><span class="o">.</span><span class="na">setSet</span><span class="o">(</span><span class="k">new</span> <span class="n">HashSet</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;(</span><span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="k">new</span> <span class="n">String</span><span class="o">[]{</span><span class="s">"张三"</span><span class="o">,</span><span class="s">"李四"</span><span class="o">,</span><span class="s">"王五"</span><span class="o">})));</span>
		<span class="n">unknownTypeData</span><span class="o">.</span><span class="na">setMap</span><span class="o">(</span><span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;(){</span>
			<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialVersionUID</span> <span class="o">=</span> <span class="mi">1L</span><span class="o">;</span>
			<span class="o">{</span>
				<span class="k">this</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"name1"</span><span class="o">,</span> <span class="s">"zhangsan"</span><span class="o">);</span>
				<span class="k">this</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"name2"</span><span class="o">,</span> <span class="s">"lisi"</span><span class="o">);</span>
				<span class="k">this</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"name3"</span><span class="o">,</span> <span class="s">"wangwu"</span><span class="o">);</span>
			<span class="o">}</span>
		<span class="o">});</span>
		
		<span class="n">demopoRepository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">demopo</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<p><br /></p>

<p>src/test/resources/applicationContext-dao.xml</p>

<p>src/test/resources/db.properties</p>

<p>src/test/resources/log4j.properties</p>

<p>build.gradle</p>

<p><br /></p>

<h4 id="zdemo-gradle-biz">zdemo-gradle-biz</h4>

<p>(略)</p>

<p><br /></p>

<h4 id="zdemo-gradle-app">zdemo-gradle-app</h4>

<p>(略)</p>


                    <hr>
                    <div class="row">
                        <div class="col-md-6">
                                <h5 style="display: inline;">Tags:</h5>
                                
                                    <button class="btn btn-white btn-xs" type="button">java</button>
                                
                        </div>
                        
                        <!--
                        <div class="col-md-6">
                            <div class="small text-right">
                                <div>    
                                    <i class="fa fa-comments-o"> </i> 
                                    <span class="ds-comments">0</span>条评论
                                </div>
                                <div>
                                    <i class="fa fa-share-alt"> </i> 
                                    <span class="ds-shares">0</span>条转发
                                </div>  
                            </div>
                        </div>
                        -->
                    </div>
                    <br>
                    <div class="row">
                        <div class="col-lg-12">
                            <!-- donate -->
                            
                                <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#myModal2">
    Donate
</button>
<div class="modal inmodal" id="myModal2" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content animated flipInY">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title">Donate Me</h4>
                <small class="font-bold">Thanks for your support!</small>
            </div>
            <div class="modal-body">
                <div class="tabbable" id="tabs-960227">
                    <ul class="nav nav-tabs">
                        <li class="active">
                            <a href="#panel-405278" data-toggle="tab">Alipay</a>
                        </li>
                        <li>
                            <a href="#panel-874705" data-toggle="tab">Wechat</a>
                        </li>
                    </ul>
                    <div class="tab-content">
                        <div class="tab-pane active" id="panel-405278">
                            <div class="text-center">
                                <img src="/static/img/pay/alipay.png"" height="250" width="250">
                            </div>    
                        </div>
                        <div class="tab-pane" id="panel-874705">
                            <div class="text-center">
                                <img src="/static/img/pay/wechat.png"" height="250" width="250">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-white" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

                            
                            <br>
                            <!-- share -->
                            
                                
<!--分享-->
<div class="row" style="margin-top:30px;">
	<h2>Share:</h2>
    <div class="social-share" style="margin-left:-5px;"data-sites="wechat,qq,qzone,weibo"></div> 
</div>
<link rel="stylesheet" href="/static/css/share.min.css">
<script src="/static/js/jquery.share.min.js"></script>
<script src="/static/js/embed.js"></script>

<script>
  var url = 'http://localhost:4000/java/2017/06/27/gradle-multi-project.html';
  var source = 'http://localhost:4000/java/2017/06/27/gradle-multi-project.html';
  var title = 'Gradle构建多模块项目';
  var excerpt = $("p:eq(0)").text();
  
  var imageUrl = 'http://localhost:4000/static/img/landing/header_one.jpg';
  var imgEle = $(".content_img:eq(0)");
  if (imgEle) {
    imageUrl = imgEle.attr("src");
  }

  var $config = {
      url: url, // 网址，默认使用 window.location.href
      source: source, // 来源（QQ空间会用到）, 默认读取head标签：<meta name="site" content="http://overtrue" />
      title: title, // 标题，默认读取 document.title 或者 <meta name="title" content="share.js" />
      description: excerpt, // 描述, 默认读取head标签：<meta name="description" content="PHP弱类型的实现原理分析" />
      image: imageUrl, // 图片, 默认取网页中第一个img标签
      sites: ['qzone', 'qq', 'weibo','wechat','douban'], // 启用的站点
      //disabled: ['google', 'facebook', 'twitter'], // 禁用的站点
      wechatQrcodeTitle: "微信扫一扫：分享", // 微信二维码提示文字
      wechatQrcodeHelper: '<p style="font-size:10px;">微信里点“发现”，扫一下</p><p style="font-size:10px;">二维码便可将本文分享至朋友圈。</p>',
   };
  $('.social-share').share($config);
</script>




                            
                            <br>
                            <!-- comment -->
                            <!--



-->

<!-- 多说评论框 start -->
<div class="row" style="margin-top:25px;"></div>
<div class="ds-thread" data-thread-key="/java/2017/06/27/gradle-multi-project.html" data-title="Gradle构建多模块项目" data-url="http://localhost:4000/java/2017/06/27/gradle-multi-project.html"></div>
<!-- 多说评论框 end -->
<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
<script type="text/javascript">
	var duoshuoQuery = {short_name:"kinglyjn"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		 || document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
</script>
<!-- 多说公共JS代码 end -->



                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>

</div>



	
	    <script src="/static/js/scroll.js"></script>

<!-- Baidu analytics -->


<!-- Google analytics -->

  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-73784599-1', 'auto');
    ga('send', 'pageview');

  </script>


<!--

-->

<!--

-->

<script async src="/static/js/count_page.js"></script>

	

</body>
</html>